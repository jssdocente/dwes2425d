
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://jssdocente.github.io/dwes2425/05herramientas.html">
      
      
        <link rel="prev" href="04web.html">
      
      
        <link rel="next" href="06accesoDatos.html">
      
      
      <link rel="icon" href="imagenes/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>5.- Herramientas Web - 2º DAW - Desarrollo Web en Entorno Servidor - Curso 24/25</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      

  
  
  
  
  <style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 13h-4v4h-2v-4H7v-2h4V7h2v4h4m-5-9A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2"/></svg>');}</style>


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="Teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#herramientas" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="index.html" title="2º DAW - Desarrollo Web en Entorno Servidor - Curso 24/25" class="md-header__button md-logo" aria-label="2º DAW - Desarrollo Web en Entorno Servidor - Curso 24/25" data-md-component="logo">
      
  <img src="imagenes/logofp.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            2º DAW - Desarrollo Web en Entorno Servidor - Curso 24/25
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              5.- Herramientas Web
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="Teal"  aria-label="Cambiar a modo noche"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo noche" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="light-blue" data-md-color-accent="Teal"  aria-label="Cambiar a modo día"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo día" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="2º DAW - Desarrollo Web en Entorno Servidor - Curso 24/25" class="md-nav__button md-logo" aria-label="2º DAW - Desarrollo Web en Entorno Servidor - Curso 24/25" data-md-component="logo">
      
  <img src="imagenes/logofp.png" alt="logo">

    </a>
    2º DAW - Desarrollo Web en Entorno Servidor - Curso 24/25
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inicio
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="01arquitecturas.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.- Arquitecturas Web
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    2.- El lenguaje PHP
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            2.- El lenguaje PHP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="02_index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introducción
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="02.1_php_basico.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PHP Básico
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="02.2_php_avanzado.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PHP Avanzado
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="02.3_php_versiones_evolucion.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PHP evolución
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="03phpoo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. PHP Orientado a Objetos
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="04web.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.- Programación Web
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    5.- Herramientas Web
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="05herramientas.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    5.- Herramientas Web
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#composer" class="md-nav__link">
    <span class="md-ellipsis">
      Composer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Composer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#instalacion" class="md-nav__link">
    <span class="md-ellipsis">
      Instalación
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primeros-pasos" class="md-nav__link">
    <span class="md-ellipsis">
      Primeros pasos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#actualizar-librerias" class="md-nav__link">
    <span class="md-ellipsis">
      Actualizar librerías
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoloadphp" class="md-nav__link">
    <span class="md-ellipsis">
      autoload.php
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monolog" class="md-nav__link">
    <span class="md-ellipsis">
      Monolog
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Monolog">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#niveles" class="md-nav__link">
    <span class="md-ellipsis">
      Niveles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hola-monolog" class="md-nav__link">
    <span class="md-ellipsis">
      Hola Monolog
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#funcionamiento" class="md-nav__link">
    <span class="md-ellipsis">
      Funcionamiento
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manejadores" class="md-nav__link">
    <span class="md-ellipsis">
      Manejadores
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#canales" class="md-nav__link">
    <span class="md-ellipsis">
      Canales
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#procesadores" class="md-nav__link">
    <span class="md-ellipsis">
      Procesadores
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formateadores" class="md-nav__link">
    <span class="md-ellipsis">
      Formateadores
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uso-de-factorias" class="md-nav__link">
    <span class="md-ellipsis">
      Uso de Factorías
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#documentacion-con-phpdocumentor" class="md-nav__link">
    <span class="md-ellipsis">
      Documentación con phpDocumentor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Documentación con phpDocumentor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#instalacion-como-binario" class="md-nav__link">
    <span class="md-ellipsis">
      Instalación como binario
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uso-en-docker" class="md-nav__link">
    <span class="md-ellipsis">
      Uso en Docker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docblock" class="md-nav__link">
    <span class="md-ellipsis">
      DocBlock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#documentando-el-codigo" class="md-nav__link">
    <span class="md-ellipsis">
      Documentando el código
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pruebas-con-phpunit" class="md-nav__link">
    <span class="md-ellipsis">
      Pruebas con PHPUnit
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pruebas con PHPUnit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#puesta-en-marcha" class="md-nav__link">
    <span class="md-ellipsis">
      Puesta en marcha
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disenando-pruebas" class="md-nav__link">
    <span class="md-ellipsis">
      Diseñando pruebas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aserciones" class="md-nav__link">
    <span class="md-ellipsis">
      Aserciones
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comparando-la-salida" class="md-nav__link">
    <span class="md-ellipsis">
      Comparando la salida
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proveedores-de-datos" class="md-nav__link">
    <span class="md-ellipsis">
      Proveedores de datos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#probando-excepciones" class="md-nav__link">
    <span class="md-ellipsis">
      Probando excepciones
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cobertura-de-codigo" class="md-nav__link">
    <span class="md-ellipsis">
      Cobertura de código
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    <span class="md-ellipsis">
      Referencias
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="06accesoDatos.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.- Acceso a Datos
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Anexo
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Anexo
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="extra/ArquitecturasWebExtendido.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Anexo I. Arquitecturas Web
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Guias
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Guias
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="extra/guias/02.config_devenv_laravel_herd.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuración entorno desarrollo PHP con Laravel Herd
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="herramientas">Herramientas<a class="headerlink" href="#herramientas" title="Permanent link">&para;</a></h1>
<details class="abstract">
<summary>Duración y criterios de evaluación</summary>
<p>Duración estimada: 16 sesiones</p>
<hr />
<table>
<thead>
<tr>
<th>Resultado de aprendizaje</th>
<th>Criterios de evaluación</th>
</tr>
</thead>
<tbody>
<tr>
<td>4.- Desarrolla aplicaciones Web embebidas en lenguajes de marcas analizando e incorporando funcionalidades según especificaciones.</td>
<td>g) Se han utilizado herramientas y entornos para facilitar la programación, prueba y depuración del código.</td>
</tr>
</tbody>
</table>
</details>
<p>En esta unidad vamos a estudiar algunas de las herramientas más utilizadas en PHP.</p>
<h2 id="composer">Composer<a class="headerlink" href="#composer" title="Permanent link">&para;</a></h2>
<figure style="float: right;">
    <a class="glightbox" href="imagenes/05/logo-composer.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img src="imagenes/05/logo-composer.png" width="200"></a>
    <figcaption>Logo Composer</figcaption>
</figure>

<p>Herramienta por excelencia en PHP para la gestión de librerías y dependencias, de manera que instala y las actualiza asegurando que todo el equipo de desarrollo tiene el mismo entorno y versiones. Además, ofrece <em>autoloading</em> de nuestro código, de manera que no tengamos que hacerlo nosotros "a mano".</p>
<p>Está escrito en PHP, y podéis consultar toda su documentación en <a href="https://getcomposer.org/">https://getcomposer.org/</a>.</p>
<p>Utiliza <a href="https://packagist.org/"><em>Packagist</em></a> como repositorio de librerías.</p>
<p>Funcionalmente, es similar a Maven (Java) / npm (JS).</p>
<h3 id="instalacion">Instalación<a class="headerlink" href="#instalacion" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Si estamos usando XAMPP, hemos de instalar <em>Composer</em> en el propio sistema operativo. Se recomienda seguir las <a href="https://getcomposer.org/doc/00-intro.md">instrucciones oficiales</a> según el sistema operativo a emplear.</p>
</li>
<li>
<p>si usamos <em>Docker</em>, necesitamos modificar la configuración de nuestro contenedor. En nuestro caso, hemos decidido modificar el archivo <code>Dockerfile</code> y añadir el siguiente comando:</p>
<div class="language-docker highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><a href="#__codelineno-0-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>composer:2.0<span class="w"> </span>/usr/bin/composer<span class="w"> </span>/usr/local/bin/composer
</span></code></pre></div>
<p>Es importante que dentro del contenedor comprobemos que tenemos la v2:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><a href="#__codelineno-1-1"><span class="linenos" data-linenos="1 "></span></a>composer<span class="w"> </span>-V
</span></code></pre></div>
</li>
<li>
<p>Si usamos <em>Laravel Herd</em> ya viene instalado por defecto.</p>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Ver capítulo: Composer y PSR-4</p>
<p>En este <a href="https://drive.google.com/file/d/1dADn_w8VDr4NOvUav7P0Npj_nJYCIoTz/view?usp=sharing">capítulo</a> del curso "Crear aplicación Web" se explica el concepto de Composer y cómo utilizarlo para el autoload de clases.</p>
</div>
<h3 id="primeros-pasos">Primeros pasos<a class="headerlink" href="#primeros-pasos" title="Permanent link">&para;</a></h3>
<p>Cuando creemos un proyecto por primera vez, hemos de inicializar el repositorio. Para ello, ejecutaremos el comando <code>composer init</code> donde:</p>
<ul>
<li>Configuramos el nombre del paquete, descripción, autor (nombre <email>), tipo de paquete (project), etc...</li>
<li>Definimos las dependencias del proyecto (<code>require</code>) y las de desarrollo (<code>require-dev</code>) de manera interactiva.<ul>
<li>En las de desarrollo se indica aquellas que no se instalarán en el entorno de producción, por ejemplo, las librerías de pruebas.</li>
</ul>
</li>
</ul>
<p>Tras su configuración, se creará automáticamente el archivo <code>composer.json</code> con los datos introducidos y descarga las librerías en la carpeta <code>vendor</code>. La instalación de las librerías siempre se realiza de manera local para cada proyecto.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a><a href="#__codelineno-2-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="p">{</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a><a href="#__codelineno-2-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dwes/log&quot;</span><span class="p">,</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a><a href="#__codelineno-2-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Pruebas con Monolog&quot;</span><span class="p">,</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4"></a><a href="#__codelineno-2-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;project&quot;</span><span class="p">,</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5"></a><a href="#__codelineno-2-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span><span class="nt">&quot;require&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6"></a><a href="#__codelineno-2-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">        </span><span class="nt">&quot;monolog/monolog&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^2.1&quot;</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7"></a><a href="#__codelineno-2-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8"></a><a href="#__codelineno-2-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">    </span><span class="nt">&quot;license&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MIT&quot;</span><span class="p">,</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9"></a><a href="#__codelineno-2-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w">    </span><span class="nt">&quot;authors&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10"></a><a href="#__codelineno-2-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11"></a><a href="#__codelineno-2-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Aitor Medrano&quot;</span><span class="p">,</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12"></a><a href="#__codelineno-2-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">            </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a.medrano@edu.gva.es&quot;</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13"></a><a href="#__codelineno-2-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14"></a><a href="#__codelineno-2-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15"></a><a href="#__codelineno-2-15"><span class="linenos" data-linenos="15 "></span></a><span class="p">}</span>
</span></code></pre></div>
<p>A la hora de indicar cada librería introduciremos:</p>
<ul>
<li>el nombre de la librería, compuesta tanto por el creador o "vendor", como por el nombre del proyecto. Ejemplos: <code>monolog/monolog</code> o <code>laravel/installer</code>.</li>
<li>
<p>la versión de cada librería. Tenemos diversas opciones para indicarla:</p>
<ul>
<li>Directamente: 1.4.2</li>
<li>Con comodines: 1.*</li>
<li>A partir de: &gt;= 2.0.3</li>
<li>Sin rotura de cambios: ^1.3.2 // &gt;=1.3.2 &lt;2.0.0</li>
</ul>
</li>
</ul>
<h3 id="actualizar-librerias">Actualizar librerías<a class="headerlink" href="#actualizar-librerias" title="Permanent link">&para;</a></h3>
<p>Podemos definir las dependencias via el archivo <code>composer.json</code> o mediante comandos con el formato <code>composer require vendor/package:version</code>. Por ejemplo, si queremos añadir phpUnit como librería de desarrollo, haremos:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a><a href="#__codelineno-3-1"><span class="linenos" data-linenos="1 "></span></a>composer<span class="w"> </span>require<span class="w"> </span>phpunit/phpunit<span class="w"> </span>–dev
</span></code></pre></div>
<p>Tras añadir nuevas librerías, hemos de actualizar nuestro proyecto:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a><a href="#__codelineno-4-1"><span class="linenos" data-linenos="1 "></span></a>composer<span class="w"> </span>update
</span></code></pre></div>
<p>Si creamos el archivo <code>composer.json</code> nosotros directamente sin inicializar el repositorio, hemos de instalar las dependencias:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a><a href="#__codelineno-5-1"><span class="linenos" data-linenos="1 "></span></a>composer<span class="w"> </span>install
</span></code></pre></div>
<p>Al hacer este paso (tanto instalar como actualizar), como ya hemos comentado, se descargan las librerías en dentro de la carpeta <code>vendor</code>. Es muy importante añadir esta carpeta al archivo <code>.gitignore</code> para no subirlas a GitHub.</p>
<p>Además se crea el archivo <code>composer.lock</code>, que almacena la versión exacta que se ha instalado de cada librería (este archivo no se toca).</p>
<h3 id="autoloadphp"><code>autoload.php</code><a class="headerlink" href="#autoloadphp" title="Permanent link">&para;</a></h3>
<p><em>Composer</em> crea de forma automática en <code>vendor/autoload.php</code> el código para incluir de forma automática todas las librerías que tengamos configuradas en <code>composer.json</code>.</p>
<p>Para utilizarlo, en la cabecera de nuestro archivos pondremos:</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a><a href="#__codelineno-6-1"><span class="linenos" data-linenos="1 "></span></a><span class="o">&lt;?</span><span class="nx">php</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a><a href="#__codelineno-6-2"><span class="linenos" data-linenos="2 "></span></a><span class="k">require</span> <span class="s1">&#39;vendor/autoload.php&#39;</span><span class="p">;</span>
</span></code></pre></div>
<p>En nuestro caso, de momento sólo lo podremos en los archivos donde probamos las clases</p>
<p>Si queremos que Composer también se encargue de cargar de forma automática nuestras clases de dominio, dentro del archivo <code>composer.json</code>, definiremos la propiedad <code>autoload</code>:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a><a href="#__codelineno-7-1"><span class="linenos" data-linenos="1 "></span></a><span class="nt">&quot;autoload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2"></a><a href="#__codelineno-7-2"><span class="linenos" data-linenos="2 "></span></a><span class="w">    </span><span class="nt">&quot;psr-4&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;Dwes\\&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;app/Dwes&quot;</span><span class="p">}</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3"></a><a href="#__codelineno-7-3"><span class="linenos" data-linenos="3 "></span></a><span class="p">},</span>
</span></code></pre></div>
<p>Posteriormente, hemos de volver a generar el <em>autoload</em> de <em>Composer</em> mediante la opción <code>dump-autoload</code> (o <code>du</code>):</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a><a href="#__codelineno-8-1"><span class="linenos" data-linenos="1 "></span></a>composer<span class="w"> </span>dump-autoload
</span></code></pre></div>
<h2 id="monolog">Monolog<a class="headerlink" href="#monolog" title="Permanent link">&para;</a></h2>
<p>Vamos a probar <em>Composer</em> añadiendo la librería de <a href="https://github.com/Seldaek/monolog"><em>Monolog</em></a> a nuestro proyecto. Se trata de un librería para la gestión de logs de nuestras aplicaciones, soportando diferentes niveles (info, warning, etc...), salidas (ficheros, sockets, BBDD, Web Services, email, etc) y formatos (texto plano, HTML, JSON, etc...).</p>
<p>Para ello, incluiremos la librería en nuestro proyecto con:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1"></a><a href="#__codelineno-9-1"><span class="linenos" data-linenos="1 "></span></a>composer<span class="w"> </span>require<span class="w"> </span>monolog/monolog
</span></code></pre></div>
<p>Monolog 2 requiere al menos PHP 7.2, cumple con el estandar de logging PSR-3, y es la librería empleada por <em>Laravel</em> y <em>Symfony</em> para la gestión de logs.</p>
<div class="admonition info">
<p class="admonition-title">Cuando usar un log</p>
<ul>
<li>Seguir las acciones/movimientos de los usuarios</li>
<li>Registrar las transacciones</li>
<li>Rastrear los errores de usuario</li>
<li>Fallos/avisos a nivel de sistema</li>
<li>Interpretar y coleccionar datos para posterior investigación de patrones</li>
</ul>
</div>
<h3 id="niveles">Niveles<a class="headerlink" href="#niveles" title="Permanent link">&para;</a></h3>
<p>A continuación mostramos los diferentes niveles de menos a más restrictivo:</p>
<ul>
<li><em>debug -100</em>: Información detallada con propósitos de debug. No usar en entornos de producción.</li>
<li><em>info - 200</em>: Eventos interesantes como el inicio de sesión de usuarios.</li>
<li><em>notice - 250</em>: Eventos normales pero significativos.</li>
<li><em>warning - 300</em>: Ocurrencias excepcionales que no llegan a ser error.</li>
<li><em>error - 400</em>: Errores de ejecución que permiten continuar con la ejecución de la aplicación pero que deben ser monitorizados.</li>
<li><em>critical - 500</em>: Situaciones importantes donde se generan excepciones no esperadas o no hay disponible un componente.</li>
<li><em>alert - 550</em>: Se deben tomar medidas inmediatamente.
Caída completa de la web, base de datos no disponible, etc... Además, se suelen enviar mensajes por email.</li>
<li><em>emergency - 600</em>: Es el error más grave e indica que todo el sistema está inutilizable.</li>
</ul>
<h3 id="hola-monolog">Hola Monolog<a class="headerlink" href="#hola-monolog" title="Permanent link">&para;</a></h3>
<p>Por ejemplo, en el archivo <code>pruebaLog.php</code> que colocaríamos en el raíz, primero incluimos el <em>autoload</em>, importamos las clases a utilizar para finalmente usar los métodos de <em>Monolog</em>:</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a><a href="#__codelineno-10-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="o">&lt;?</span><span class="nx">php</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2"></a><a href="#__codelineno-10-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="k">include</span> <span class="no">__DIR__</span> <span class="o">.</span><span class="s2">&quot;/vendor/autoload.php&quot;</span><span class="p">;</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3"></a><a href="#__codelineno-10-3"><span class="linenos" data-linenos=" 3 "></span></a>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4"></a><a href="#__codelineno-10-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">use</span> <span class="nx">Monolog\Logger</span><span class="p">;</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5"></a><a href="#__codelineno-10-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">use</span> <span class="nx">Monolog\Handler\StreamHandler</span><span class="p">;</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6"></a><a href="#__codelineno-10-6"><span class="linenos" data-linenos=" 6 "></span></a>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7"></a><a href="#__codelineno-10-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s2">&quot;MiLogger&quot;</span><span class="p">);</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8"></a><a href="#__codelineno-10-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s2">&quot;logs/milog.log&quot;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">));</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9"></a><a href="#__codelineno-10-9"><span class="linenos" data-linenos=" 9 "></span></a>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10"></a><a href="#__codelineno-10-10"><span class="linenos" data-linenos="10 "></span></a><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">debug</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de DEBUG&quot;</span><span class="p">);</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11"></a><a href="#__codelineno-10-11"><span class="linenos" data-linenos="11 "></span></a><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">info</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de INFO&quot;</span><span class="p">);</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12"></a><a href="#__codelineno-10-12"><span class="linenos" data-linenos="12 "></span></a><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">warning</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de WARNING&quot;</span><span class="p">);</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13"></a><a href="#__codelineno-10-13"><span class="linenos" data-linenos="13 "></span></a><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de ERROR&quot;</span><span class="p">);</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14"></a><a href="#__codelineno-10-14"><span class="linenos" data-linenos="14 "></span></a><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">critical</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de CRITICAL&quot;</span><span class="p">);</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15"></a><a href="#__codelineno-10-15"><span class="linenos" data-linenos="15 "></span></a><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">alert</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de ALERT&quot;</span><span class="p">);</span>
</span></code></pre></div>
<p>En todos los métodos de registro de mensajes (<code>debug</code>, <code>info</code>, ...), además del propio mensaje, le podemos pasar información como el contenido de alguna variable, usuario de la aplicación, etc.. como segundo parámetro dentro de un array, el cual se conoce como <strong>array de contexto</strong>. Es conveniente hacerlo mediante un array asociativo para facilitar la lectura del log.</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1"></a><a href="#__codelineno-11-1"><span class="linenos" data-linenos="1 "></span></a><span class="o">&lt;?</span><span class="nx">php</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2"></a><a href="#__codelineno-11-2"><span class="linenos" data-linenos="2 "></span></a><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">warning</span><span class="p">(</span><span class="s2">&quot;Producto no encontrado&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nv">$producto</span><span class="p">]);</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3"></a><a href="#__codelineno-11-3"><span class="linenos" data-linenos="3 "></span></a><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">warning</span><span class="p">(</span><span class="s2">&quot;Producto no encontrado&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;datos&quot;</span> <span class="o">=&gt;</span> <span class="nv">$producto</span><span class="p">]);</span>
</span></code></pre></div>
<h3 id="funcionamiento">Funcionamiento<a class="headerlink" href="#funcionamiento" title="Permanent link">&para;</a></h3>
<p>Cada instancia <code>Logger</code> tiene un nombre de canal y una pila de manejadores (<em>handler</em>).
Cada mensaje que mandamos al log atraviesa la pila de manejadores, y cada uno decide si debe registrar la información, y si se da el caso, finalizar la propagación.
Por ejemplo, un <code>StreamHandler</code> en el fondo de la pila que lo escriba todo en disco, y en el tope añade un <code>MailHandler</code> que envíe un mail sólo cuando haya un error.</p>
<h3 id="manejadores">Manejadores<a class="headerlink" href="#manejadores" title="Permanent link">&para;</a></h3>
<p>Cada manejador tambien tiene un formateador (<code>Formatter</code>). Si no se indica ninguno, se le asigna uno por defecto. El último manejador insertado será el primero en ejecutarse.
Luego se <em>van ejecutando</em> conforme a la pila.</p>
<p>Los manejadores más utilizados son:</p>
<ul>
<li><code>StreamHandler(ruta, nivel)</code></li>
<li><code>RotatingFileHandler(ruta, maxFiles, nivel)</code></li>
<li><code>NativeMailerHandler(para, asunto, desde, nivel)</code></li>
<li><code>FirePHPHandler(nivel)</code></li>
</ul>
<p>Si queremos que los mensajes de la aplicación salgan por el log del servidor, 
en nuestro caso el archivo <code>error.log</code> de <em>Apache</em> utilizaremos como ruta la salida de error:</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1"></a><a href="#__codelineno-12-1"><span class="linenos" data-linenos="1 "></span></a><span class="o">&lt;?</span><span class="nx">php</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2"></a><a href="#__codelineno-12-2"><span class="linenos" data-linenos="2 "></span></a><span class="c1">// error.log</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3"></a><a href="#__codelineno-12-3"><span class="linenos" data-linenos="3 "></span></a><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s2">&quot;php://stderr&quot;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">));</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4"></a><a href="#__codelineno-12-4"><span class="linenos" data-linenos="4 "></span></a><span class="c1">//Consola</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5"></a><a href="#__codelineno-12-5"><span class="linenos" data-linenos="5 "></span></a><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s2">&quot;php://stdout&quot;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">));</span>
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">FirePHP</p>
<p>Por ejemplo, mediante <code>FirePHPHandler</code>, podemos utilizar <code>FirePHP</code>, la cual es una herramienta para hacer debug en la consola de <em>Firefox</em>.
Tras instalar la extensión en Firefox, habilitar las opciones y configurar el <em>Handler</em>, podemos ver los mensajes coloreados con sus datos:</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1"></a><a href="#__codelineno-13-1"><span class="linenos" data-linenos="1 "></span></a><span class="o">&lt;?</span><span class="nx">php</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2"></a><a href="#__codelineno-13-2"><span class="linenos" data-linenos="2 "></span></a><span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s2">&quot;MiFirePHPLogger&quot;</span><span class="p">);</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3"></a><a href="#__codelineno-13-3"><span class="linenos" data-linenos="3 "></span></a><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">FirePHPHandler</span><span class="p">(</span><span class="nx">Logger</span><span class="o">::</span><span class="na">INFO</span><span class="p">));</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4"></a><a href="#__codelineno-13-4"><span class="linenos" data-linenos="4 "></span></a>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5"></a><a href="#__codelineno-13-5"><span class="linenos" data-linenos="5 "></span></a><span class="nv">$datos</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;real&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Bruce Wayne&quot;</span><span class="p">,</span> <span class="s2">&quot;personaje&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Batman&quot;</span><span class="p">];</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6"></a><a href="#__codelineno-13-6"><span class="linenos" data-linenos="6 "></span></a><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">debug</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de DEBUG&quot;</span><span class="p">,</span> <span class="nv">$datos</span><span class="p">);</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7"></a><a href="#__codelineno-13-7"><span class="linenos" data-linenos="7 "></span></a><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">info</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de INFO&quot;</span><span class="p">,</span> <span class="nv">$datos</span><span class="p">);</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8"></a><a href="#__codelineno-13-8"><span class="linenos" data-linenos="8 "></span></a><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">warning</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de WARNING&quot;</span><span class="p">,</span> <span class="nv">$datos</span><span class="p">);</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9"></a><a href="#__codelineno-13-9"><span class="linenos" data-linenos="9 "></span></a><span class="c1">// ...</span>
</span></code></pre></div>
<p><figure style="align: center;">
    <a class="glightbox" href="imagenes/05/firePhp.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img src="imagenes/05/firePhp.png"></a>
    <figcaption>Ejemplo de uso de FirePHP</figcaption>
</figure></p>
</div>
<h3 id="canales">Canales<a class="headerlink" href="#canales" title="Permanent link">&para;</a></h3>
<p>Se les asigna al crear el <code>Logger</code>. En grandes aplicaciones, se crea un canal por cada subsistema: ventas, contabilidad, almacén.
No es una buena práctica usar el nombre de la clase como canal, esto se hace con un <em>procesador</em>.</p>
<p>Para su uso, es recomiendo asignar el log a una propiedad privada a Logger, y posteriormente, en el constructor de la clase, asignar el canal, manejadores y formato.</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1"></a><a href="#__codelineno-14-1"><span class="linenos" data-linenos="1 "></span></a><span class="o">&lt;?</span><span class="nx">php</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2"></a><a href="#__codelineno-14-2"><span class="linenos" data-linenos="2 "></span></a><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s2">&quot;MiApp&quot;</span><span class="p">);</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3"></a><a href="#__codelineno-14-3"><span class="linenos" data-linenos="3 "></span></a><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s2">&quot;logs/milog.log&quot;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">));</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4"></a><a href="#__codelineno-14-4"><span class="linenos" data-linenos="4 "></span></a><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">FirePHPHandler</span><span class="p">(</span><span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">));</span>
</span></code></pre></div>
<p>Y dentro de los métodos para escribir en el log:</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1"></a><a href="#__codelineno-15-1"><span class="linenos" data-linenos="1 "></span></a><span class="o">&lt;?</span><span class="nx">php</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2"></a><a href="#__codelineno-15-2"><span class="linenos" data-linenos="2 "></span></a><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">log</span><span class="o">-&gt;</span><span class="na">warning</span><span class="p">(</span><span class="s2">&quot;Producto no encontrado&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nv">$producto</span><span class="p">]);</span>
</span></code></pre></div>
<h3 id="procesadores">Procesadores<a class="headerlink" href="#procesadores" title="Permanent link">&para;</a></h3>
<p>Los procesadores permiten añadir información a los mensajes. Para ello, se apilan después de cada manejador mediante el método <code>pushProcessor($procesador)</code>.</p>
<p>Algunos procesadores conocidos son <code>IntrospectionProcessor</code> (muestran la linea, fichero, clase y metodo desde el que se invoca el log), <code>WebProcessor</code> (añade la URI, método e IP) o <code>GitProcessor</code> (añade la rama y el commit).</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">PHP</label><label for="__tabbed_1_2">Consola en formato texto</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-php highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1"></a><a href="#__codelineno-16-1"><span class="linenos" data-linenos="1 "></span></a><span class="o">&lt;?</span><span class="nx">php</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2"></a><a href="#__codelineno-16-2"><span class="linenos" data-linenos="2 "></span></a><span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s2">&quot;MiLogger&quot;</span><span class="p">);</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3"></a><a href="#__codelineno-16-3"><span class="linenos" data-linenos="3 "></span></a><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">RotatingFileHandler</span><span class="p">(</span><span class="s2">&quot;logs/milog.log&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">));</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4"></a><a href="#__codelineno-16-4"><span class="linenos" data-linenos="4 "></span></a><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushProcessor</span><span class="p">(</span><span class="k">new</span> <span class="nx">IntrospectionProcessor</span><span class="p">());</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5"></a><a href="#__codelineno-16-5"><span class="linenos" data-linenos="5 "></span></a><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s2">&quot;php://stderr&quot;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">WARNING</span><span class="p">));</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6"></a><a href="#__codelineno-16-6"><span class="linenos" data-linenos="6 "></span></a><span class="c1">// no usa Introspection pq lo hemos apilado después, le asigno otro</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7"></a><a href="#__codelineno-16-7"><span class="linenos" data-linenos="7 "></span></a><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushProcessor</span><span class="p">(</span><span class="k">new</span> <span class="nx">WebProcessor</span><span class="p">());</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1"></a><a href="#__codelineno-17-1"><span class="linenos" data-linenos="1 "></span></a>[2020-11-26T13:35:31.076138+01:00] MiLogger.DEBUG: Esto es un mensaje de DEBUG [] {&quot;file&quot;:&quot;C:\\xampp\\htdocs\\log\\procesador.php&quot;,&quot;line&quot;:12,&quot;class&quot;:null,&quot;function&quot;:null}
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2"></a><a href="#__codelineno-17-2"><span class="linenos" data-linenos="2 "></span></a>[2020-11-26T13:35:31.078344+01:00] MiLogger.INFO: Esto es un mensaje de INFO [] {&quot;file&quot;:&quot;C:\\xampp\\htdocs\\log\\procesador.php&quot;,&quot;line&quot;:13,&quot;class&quot;:null,&quot;function&quot;:null}
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="formateadores">Formateadores<a class="headerlink" href="#formateadores" title="Permanent link">&para;</a></h3>
<p>Se asocian a los manejadores con <code>setFormatter</code>. Los formateadores más utilizados son <code>LineFormatter</code>, <code>HtmlFormatter</code> o <code>JsonFormatter</code>.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">PHP</label><label for="__tabbed_2_2">Consola en JSON</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-php highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1"></a><a href="#__codelineno-18-1"><span class="linenos" data-linenos="1 "></span></a><span class="o">&lt;?</span><span class="nx">php</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2"></a><a href="#__codelineno-18-2"><span class="linenos" data-linenos="2 "></span></a><span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s2">&quot;MiLogger&quot;</span><span class="p">);</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3"></a><a href="#__codelineno-18-3"><span class="linenos" data-linenos="3 "></span></a><span class="nv">$rfh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RotatingFileHandler</span><span class="p">(</span><span class="s2">&quot;logs/milog.log&quot;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">);</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4"></a><a href="#__codelineno-18-4"><span class="linenos" data-linenos="4 "></span></a><span class="nv">$rfh</span><span class="o">-&gt;</span><span class="na">setFormatter</span><span class="p">(</span><span class="k">new</span> <span class="nx">JsonFormatter</span><span class="p">());</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5"></a><a href="#__codelineno-18-5"><span class="linenos" data-linenos="5 "></span></a><span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="nv">$rfh</span><span class="p">);</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1"></a><a href="#__codelineno-19-1"><span class="linenos" data-linenos="1 "></span></a><span class="p">{</span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="s2">&quot;Esto es un mensaje de DEBUG&quot;</span><span class="p">,</span><span class="nt">&quot;context&quot;</span><span class="p">:{},</span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="nt">&quot;level_name&quot;</span><span class="p">:</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span><span class="nt">&quot;channel&quot;</span><span class="p">:</span><span class="s2">&quot;MiLogger&quot;</span><span class="p">,</span><span class="nt">&quot;datetime&quot;</span><span class="p">:</span><span class="s2">&quot;2020-11-27T15:36:52.747211+01:00&quot;</span><span class="p">,</span><span class="nt">&quot;extra&quot;</span><span class="p">:{}}</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2"></a><a href="#__codelineno-19-2"><span class="linenos" data-linenos="2 "></span></a><span class="p">{</span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="s2">&quot;Esto es un mensaje de INFO&quot;</span><span class="p">,</span><span class="nt">&quot;context&quot;</span><span class="p">:{},</span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span><span class="nt">&quot;level_name&quot;</span><span class="p">:</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span><span class="nt">&quot;channel&quot;</span><span class="p">:</span><span class="s2">&quot;MiLogger&quot;</span><span class="p">,</span><span class="nt">&quot;datetime&quot;</span><span class="p">:</span><span class="s2">&quot;2020-11-27T15:36:52.747538+01:00&quot;</span><span class="p">,</span><span class="nt">&quot;extra&quot;</span><span class="p">:{}}</span>
</span></code></pre></div>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Más información</p>
<p>Más información sobre manejadores, formateadores y procesadores en <a href="https://github.com/Seldaek/monolog/blob/master/doc/02-handlers-formatters-processors.md">https://github.com/Seldaek/monolog/blob/master/doc/02-handlers-formatters-processors.md</a></p>
</div>
<h3 id="uso-de-factorias">Uso de Factorías<a class="headerlink" href="#uso-de-factorias" title="Permanent link">&para;</a></h3>
<p>En vez de instanciar un log en cada clase, es conveniente crear una factoría (por ejemplo, siguiendo la idea del patrón de diseño <a href="https://refactoring.guru/es/design-patterns/factory-method"><em>Factory Method</em></a>).</p>
<p>Para el siguiente ejemplo, vamos a suponer que creamos la factoría en el <em>namespace</em> <code>Dwes\Ejemplos\Util</code>.</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1"></a><a href="#__codelineno-20-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="o">&lt;?</span><span class="nx">php</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2"></a><a href="#__codelineno-20-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="k">namespace</span> <span class="nx">Dwes\Ejemplos\Util</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3"></a><a href="#__codelineno-20-3"><span class="linenos" data-linenos=" 3 "></span></a>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4"></a><a href="#__codelineno-20-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">use</span> <span class="nx">Monolog\Logger</span><span class="p">;</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5"></a><a href="#__codelineno-20-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">use</span> <span class="nx">Monolog\Handler\StreamHandler</span><span class="p">;</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6"></a><a href="#__codelineno-20-6"><span class="linenos" data-linenos=" 6 "></span></a>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7"></a><a href="#__codelineno-20-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="k">class</span> <span class="nc">LogFactory</span> <span class="p">{</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8"></a><a href="#__codelineno-20-8"><span class="linenos" data-linenos=" 8 "></span></a>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9"></a><a href="#__codelineno-20-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getLogger</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$canal</span> <span class="o">=</span> <span class="s2">&quot;miApp&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="nx">Logger</span> <span class="p">{</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10"></a><a href="#__codelineno-20-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="nv">$canal</span><span class="p">);</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11"></a><a href="#__codelineno-20-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s2">&quot;logs/miApp.log&quot;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">));</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12"></a><a href="#__codelineno-20-12"><span class="linenos" data-linenos="12 "></span></a>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13"></a><a href="#__codelineno-20-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="k">return</span> <span class="nv">$log</span><span class="p">;</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14"></a><a href="#__codelineno-20-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="p">}</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15"></a><a href="#__codelineno-20-15"><span class="linenos" data-linenos="15 "></span></a><span class="p">}</span>
</span></code></pre></div>
<p>Si en vez de devolver un <code>Monolog\Logger</code> utilizamos el interfaz de PSR, si en el futuro cambiamos la implementación del log, no tendremos que modificar nuestro codigo. Así pues, la factoría ahora devolverá <code>Psr\Log\LoggerInterface</code>:</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1"></a><a href="#__codelineno-21-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="o">&lt;?</span><span class="nx">php</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2"></a><a href="#__codelineno-21-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="k">namespace</span> <span class="nx">Dwes\Ejemplos\Util</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3"></a><a href="#__codelineno-21-3"><span class="linenos" data-linenos=" 3 "></span></a>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4"></a><a href="#__codelineno-21-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">use</span> <span class="nx">Monolog\Handler\StreamHandler</span><span class="p">;</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5"></a><a href="#__codelineno-21-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">use</span> <span class="nx">Monolog\Logger</span><span class="p">;</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6"></a><a href="#__codelineno-21-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="k">use</span> <span class="nx">Psr\Log\LoggerInterface</span><span class="p">;</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7"></a><a href="#__codelineno-21-7"><span class="linenos" data-linenos=" 7 "></span></a>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8"></a><a href="#__codelineno-21-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="k">class</span> <span class="nc">LogFactory</span> <span class="p">{</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9"></a><a href="#__codelineno-21-9"><span class="linenos" data-linenos=" 9 "></span></a>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10"></a><a href="#__codelineno-21-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getLogger</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$canal</span> <span class="o">=</span> <span class="s2">&quot;miApp&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="nx">LoggerInterface</span> <span class="p">{</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11"></a><a href="#__codelineno-21-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="nv">$canal</span><span class="p">);</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12"></a><a href="#__codelineno-21-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="no">__DIR__</span> <span class="o">.</span> <span class="s2">&quot;/log/miApp.log&quot;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">));</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13"></a><a href="#__codelineno-21-13"><span class="linenos" data-linenos="13 "></span></a>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14"></a><a href="#__codelineno-21-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="k">return</span> <span class="nv">$log</span><span class="p">;</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15"></a><a href="#__codelineno-21-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="p">}</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16"></a><a href="#__codelineno-21-16"><span class="linenos" data-linenos="16 "></span></a><span class="p">}</span>
</span></code></pre></div>
<p>Finalmente, para utilizar la factoría, sólo cambiamos el código que teníamos en el constructor de las clases que usan el log, quedando algo asi:</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1"></a><a href="#__codelineno-22-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="o">&lt;?</span><span class="nx">php</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2"></a><a href="#__codelineno-22-2"><span class="linenos" data-linenos=" 2 "></span></a>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3"></a><a href="#__codelineno-22-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="k">namespace</span> <span class="nx">Dwes\Ejemplos\Model</span><span class="p">;</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4"></a><a href="#__codelineno-22-4"><span class="linenos" data-linenos=" 4 "></span></a>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5"></a><a href="#__codelineno-22-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">use</span> <span class="nx">Dwes\Ejemplos\Util\LogFactory</span><span class="p">;</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6"></a><a href="#__codelineno-22-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="k">use</span> <span class="nx">Monolog\Logger</span><span class="p">;</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7"></a><a href="#__codelineno-22-7"><span class="linenos" data-linenos=" 7 "></span></a>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8"></a><a href="#__codelineno-22-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="k">class</span> <span class="nc">Cliente</span> <span class="p">{</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9"></a><a href="#__codelineno-22-9"><span class="linenos" data-linenos=" 9 "></span></a>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10"></a><a href="#__codelineno-22-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="k">private</span> <span class="nv">$codigo</span><span class="p">;</span> 
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11"></a><a href="#__codelineno-22-11"><span class="linenos" data-linenos="11 "></span></a>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12"></a><a href="#__codelineno-22-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="k">private</span> <span class="nx">Logger</span> <span class="nv">$log</span><span class="p">;</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13"></a><a href="#__codelineno-22-13"><span class="linenos" data-linenos="13 "></span></a>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14"></a><a href="#__codelineno-22-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$codigo</span><span class="p">){</span> 
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15"></a><a href="#__codelineno-22-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">codigo</span><span class="o">=</span><span class="nv">$codigo</span><span class="p">;</span> 
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16"></a><a href="#__codelineno-22-16"><span class="linenos" data-linenos="16 "></span></a>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17"></a><a href="#__codelineno-22-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">log</span> <span class="o">=</span> <span class="nx">LogFactory</span><span class="o">::</span><span class="na">getLogger</span><span class="p">();</span>
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18"></a><a href="#__codelineno-22-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="p">}</span>
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19"></a><a href="#__codelineno-22-19"><span class="linenos" data-linenos="19 "></span></a>
</span><span id="__span-22-20"><a id="__codelineno-22-20" name="__codelineno-22-20"></a><a href="#__codelineno-22-20"><span class="linenos" data-linenos="20 "></span></a>    <span class="c1">/// ... resto del código</span>
</span><span id="__span-22-21"><a id="__codelineno-22-21" name="__codelineno-22-21"></a><a href="#__codelineno-22-21"><span class="linenos" data-linenos="21 "></span></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Rotando ficheros de log</strong></p>
<p>El principal problema con logging en un archivo es que, con el tiempo, el archivo puede volverse demasiado grande y complicado de administrar, además de ocupar una gran cantidad de almacenamiento. Este problema se resuelve tradicionalmente mediante la rotación de archivos.</p>
<p>Monolog también ofrece una solución integrada para rotar registros, aunque no está pensada para su uso en entornos de producción. </p>
<p>En el siguiente ejemplo, se ha utilizado un <code>RotatingFileHandler</code> que rotará el archivo de log si el fichero es más antiguo de 30 días. También es posible especificar otros criterios de rotación, para ello consulta la documentación de Monolog.</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1"></a><a href="#__codelineno-23-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="o">&lt;?</span><span class="nx">php</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2"></a><a href="#__codelineno-23-2"><span class="linenos" data-linenos=" 2 "></span></a>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3"></a><a href="#__codelineno-23-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="o">.</span> <span class="o">.</span> <span class="o">.</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4"></a><a href="#__codelineno-23-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">use</span> <span class="nx">Monolog\Handler\RotatingFileHandler</span><span class="p">;</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5"></a><a href="#__codelineno-23-5"><span class="linenos" data-linenos=" 5 "></span></a>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6"></a><a href="#__codelineno-23-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="nv">$rotating_handler</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RotatingFileHandler</span><span class="p">(</span><span class="no">__DIR__</span> <span class="o">.</span> <span class="s2">&quot;/log/debug.log&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="nx">Level</span><span class="o">::</span><span class="na">Debug</span><span class="p">);</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7"></a><a href="#__codelineno-23-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="nv">$rotating_handler</span><span class="p">);</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8"></a><a href="#__codelineno-23-8"><span class="linenos" data-linenos=" 8 "></span></a>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9"></a><a href="#__codelineno-23-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">info</span><span class="p">(</span><span class="s2">&quot;This file has been executed.&quot;</span><span class="p">);</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10"></a><a href="#__codelineno-23-10"><span class="linenos" data-linenos="10 "></span></a><span class="cp">?&gt;</span>
</span></code></pre></div>
<p><strong>Captura y logando excepciones</strong></p>
<p>En PHP las excepciones son controladoras por <code>try, catch, finally</code>. Si queremos logar una excepción, podemos hacerlo de la siguiente manera:</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1"></a><a href="#__codelineno-24-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="nv">$logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s2">&quot;exceptions&quot;</span><span class="p">);</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2"></a><a href="#__codelineno-24-2"><span class="linenos" data-linenos=" 2 "></span></a>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3"></a><a href="#__codelineno-24-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="nv">$stream_handler</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="no">__DIR__</span> <span class="o">.</span> <span class="s2">&quot;/log/exception.log&quot;</span><span class="p">,</span> <span class="nx">Level</span><span class="o">::</span><span class="na">Debug</span><span class="p">);</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4"></a><a href="#__codelineno-24-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="nv">$stream_handler</span><span class="o">-&gt;</span><span class="na">setFormatter</span><span class="p">(</span><span class="k">new</span> <span class="nx">JsonFormatter</span><span class="p">());</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5"></a><a href="#__codelineno-24-5"><span class="linenos" data-linenos=" 5 "></span></a>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6"></a><a href="#__codelineno-24-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="nv">$stream_handler</span><span class="p">);</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7"></a><a href="#__codelineno-24-7"><span class="linenos" data-linenos=" 7 "></span></a>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8"></a><a href="#__codelineno-24-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="k">try</span> <span class="p">{</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9"></a><a href="#__codelineno-24-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="nv">$username</span> <span class="o">=</span> <span class="nb">readline</span><span class="p">(</span><span class="s2">&quot;Choose your username: &quot;</span><span class="p">);</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10"></a><a href="#__codelineno-24-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$username</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11"></a><a href="#__codelineno-24-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s2">&quot;The username </span><span class="si">$username</span><span class="s2"> is too short.&quot;</span><span class="p">);</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12"></a><a href="#__codelineno-24-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="p">}</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13"></a><a href="#__codelineno-24-13"><span class="linenos" data-linenos="13 "></span></a><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14"></a><a href="#__codelineno-24-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="c1">// Log el mensaje de la excepción</span>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15"></a><a href="#__codelineno-24-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">());</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16"></a><a href="#__codelineno-24-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="c1">//Si queremos logar todo el objeto de la excepción</span>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17"></a><a href="#__codelineno-24-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="nv">$e</span><span class="p">);</span>
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18"></a><a href="#__codelineno-24-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="c1">//También es posible combinar las 2 opciones, logar el mensaje y el objeto de la excepción.</span>
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19"></a><a href="#__codelineno-24-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="c1">// array(&#39;exception&#39; =&gt; $e) es un contexto adicional que se añade al log.</span>
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20"></a><a href="#__codelineno-24-20"><span class="linenos" data-linenos="20 "></span></a>    <span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">(),</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;exception&#39;</span> <span class="o">=&gt;</span> <span class="nv">$e</span><span class="p">));</span>
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21"></a><a href="#__codelineno-24-21"><span class="linenos" data-linenos="21 "></span></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Tratando con excepciones no capturadas</strong></p>
<p>Si una excepción no es capturada por un bloque <code>try, catch</code>, la excepción "burbujeará" hasta el script principal y si no existe un <code>block</code> en este nivel, PHP terminará la ejecución del script inmediatamente con un error "Fatal".</p>
<p>Podemos manejar este tipo de errores utilizando una función anónima y el método <code>set_exception_handler</code> de PHP.
<div class="language-php highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1"></a><a href="#__codelineno-25-1"><span class="linenos" data-linenos="1 "></span></a><span class="o">&lt;?</span><span class="nx">php</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2"></a><a href="#__codelineno-25-2"><span class="linenos" data-linenos="2 "></span></a><span class="o">...</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3"></a><a href="#__codelineno-25-3"><span class="linenos" data-linenos="3 "></span></a>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4"></a><a href="#__codelineno-25-4"><span class="linenos" data-linenos="4 "></span></a><span class="nb">set_exception_handler</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$ex</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5"></a><a href="#__codelineno-25-5"><span class="linenos" data-linenos="5 "></span></a>  <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="s2">&quot;Fatal error ocurred: &quot;</span> <span class="o">.</span> <span class="nv">$ex</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">(),</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;exception&#39;</span> <span class="o">=&gt;</span> <span class="nv">$ex</span><span class="p">));</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6"></a><a href="#__codelineno-25-6"><span class="linenos" data-linenos="6 "></span></a><span class="p">})</span>
</span></code></pre></div></p>
<p><strong>Enviar logs a múltiples destinos</strong></p>
<p>Monolog permite enviar logs a múltiples destinos, normalmente a través del tipo de severidad, podemos indicar un destino u otro. En el siguiente ejemplo, se envían los logs de nivel <code>DEBUG</code> a un fichero, los de nivel <code>NOTICE</code> a otro fichero y los de nivel <code>ALERT</code> a una base de datos.</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1"></a><a href="#__codelineno-26-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="o">&lt;?</span><span class="nx">php</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2"></a><a href="#__codelineno-26-2"><span class="linenos" data-linenos=" 2 "></span></a>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3"></a><a href="#__codelineno-26-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="k">require</span> <span class="no">__DIR__</span> <span class="o">.</span> <span class="s2">&quot;/vendor/autoload.php&quot;</span><span class="p">;</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4"></a><a href="#__codelineno-26-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">require</span> <span class="s2">&quot;./DBHandler.php&quot;</span><span class="p">;</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5"></a><a href="#__codelineno-26-5"><span class="linenos" data-linenos=" 5 "></span></a>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6"></a><a href="#__codelineno-26-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="k">use</span> <span class="nx">Monolog\Level</span><span class="p">;</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7"></a><a href="#__codelineno-26-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="k">use</span> <span class="nx">Monolog\Logger</span><span class="p">;</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8"></a><a href="#__codelineno-26-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="k">use</span> <span class="nx">Monolog\Formatter\JsonFormatter</span><span class="p">;</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9"></a><a href="#__codelineno-26-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="k">use</span> <span class="nx">Monolog\Handler\StreamHandler</span><span class="p">;</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10"></a><a href="#__codelineno-26-10"><span class="linenos" data-linenos="10 "></span></a><span class="k">use</span> <span class="nx">Monolog\Handler\RotatingFileHandler</span><span class="p">;</span>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11"></a><a href="#__codelineno-26-11"><span class="linenos" data-linenos="11 "></span></a>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12"></a><a href="#__codelineno-26-12"><span class="linenos" data-linenos="12 "></span></a><span class="c1">// New Logger instance</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13"></a><a href="#__codelineno-26-13"><span class="linenos" data-linenos="13 "></span></a><span class="nv">$logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s2">&quot;my_logger&quot;</span><span class="p">);</span>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14"></a><a href="#__codelineno-26-14"><span class="linenos" data-linenos="14 "></span></a><span class="nv">$formatter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">JsonFormatter</span><span class="p">();</span>
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15"></a><a href="#__codelineno-26-15"><span class="linenos" data-linenos="15 "></span></a>
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16"></a><a href="#__codelineno-26-16"><span class="linenos" data-linenos="16 "></span></a><span class="c1">// Create new handler</span>
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17"></a><a href="#__codelineno-26-17"><span class="linenos" data-linenos="17 "></span></a><span class="nv">$rotating_handler</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RotatingFileHandler</span><span class="p">(</span><span class="no">__DIR__</span> <span class="o">.</span> <span class="s2">&quot;/log/debug.log&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="nx">Level</span><span class="o">::</span><span class="na">Debug</span><span class="p">);</span>
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18"></a><a href="#__codelineno-26-18"><span class="linenos" data-linenos="18 "></span></a><span class="nv">$stream_handler</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="no">__DIR__</span> <span class="o">.</span> <span class="s2">&quot;/log/notice.log&quot;</span><span class="p">,</span> <span class="nx">Level</span><span class="o">::</span><span class="na">Notice</span><span class="p">);</span>
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19"></a><a href="#__codelineno-26-19"><span class="linenos" data-linenos="19 "></span></a><span class="nv">$db_handler</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DBHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;sqlite:alert.sqlite&#39;</span><span class="p">),</span> <span class="nx">Level</span><span class="o">::</span><span class="na">Alert</span><span class="p">);</span>
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20"></a><a href="#__codelineno-26-20"><span class="linenos" data-linenos="20 "></span></a>
</span><span id="__span-26-21"><a id="__codelineno-26-21" name="__codelineno-26-21"></a><a href="#__codelineno-26-21"><span class="linenos" data-linenos="21 "></span></a><span class="nv">$stream_handler</span><span class="o">-&gt;</span><span class="na">setFormatter</span><span class="p">(</span><span class="nv">$formatter</span><span class="p">);</span>
</span><span id="__span-26-22"><a id="__codelineno-26-22" name="__codelineno-26-22"></a><a href="#__codelineno-26-22"><span class="linenos" data-linenos="22 "></span></a><span class="nv">$db_handler</span><span class="o">-&gt;</span><span class="na">setFormatter</span><span class="p">(</span><span class="nv">$formatter</span><span class="p">);</span>
</span><span id="__span-26-23"><a id="__codelineno-26-23" name="__codelineno-26-23"></a><a href="#__codelineno-26-23"><span class="linenos" data-linenos="23 "></span></a><span class="nv">$rotating_handler</span><span class="o">-&gt;</span><span class="na">setFormatter</span><span class="p">(</span><span class="nv">$formatter</span><span class="p">);</span>
</span><span id="__span-26-24"><a id="__codelineno-26-24" name="__codelineno-26-24"></a><a href="#__codelineno-26-24"><span class="linenos" data-linenos="24 "></span></a>
</span><span id="__span-26-25"><a id="__codelineno-26-25" name="__codelineno-26-25"></a><a href="#__codelineno-26-25"><span class="linenos" data-linenos="25 "></span></a><span class="c1">// Push the handler to the log channel</span>
</span><span id="__span-26-26"><a id="__codelineno-26-26" name="__codelineno-26-26"></a><a href="#__codelineno-26-26"><span class="linenos" data-linenos="26 "></span></a><span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="nv">$stream_handler</span><span class="p">);</span>
</span><span id="__span-26-27"><a id="__codelineno-26-27" name="__codelineno-26-27"></a><a href="#__codelineno-26-27"><span class="linenos" data-linenos="27 "></span></a><span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="nv">$rotating_handler</span><span class="p">);</span>
</span><span id="__span-26-28"><a id="__codelineno-26-28" name="__codelineno-26-28"></a><a href="#__codelineno-26-28"><span class="linenos" data-linenos="28 "></span></a><span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="nv">$db_handler</span><span class="p">);</span>
</span><span id="__span-26-29"><a id="__codelineno-26-29" name="__codelineno-26-29"></a><a href="#__codelineno-26-29"><span class="linenos" data-linenos="29 "></span></a>
</span><span id="__span-26-30"><a id="__codelineno-26-30" name="__codelineno-26-30"></a><a href="#__codelineno-26-30"><span class="linenos" data-linenos="30 "></span></a><span class="c1">// Log the message</span>
</span><span id="__span-26-31"><a id="__codelineno-26-31" name="__codelineno-26-31"></a><a href="#__codelineno-26-31"><span class="linenos" data-linenos="31 "></span></a><span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">info</span><span class="p">(</span><span class="s2">&quot;This file has been executed.&quot;</span><span class="p">);</span>
</span><span id="__span-26-32"><a id="__codelineno-26-32" name="__codelineno-26-32"></a><a href="#__codelineno-26-32"><span class="linenos" data-linenos="32 "></span></a><span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="s2">&quot;An error occurred.&quot;</span><span class="p">);</span>
</span><span id="__span-26-33"><a id="__codelineno-26-33" name="__codelineno-26-33"></a><a href="#__codelineno-26-33"><span class="linenos" data-linenos="33 "></span></a><span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">critical</span><span class="p">(</span><span class="s2">&quot;This application is in critical condition!!&quot;</span><span class="p">);</span>
</span><span id="__span-26-34"><a id="__codelineno-26-34" name="__codelineno-26-34"></a><a href="#__codelineno-26-34"><span class="linenos" data-linenos="34 "></span></a><span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">emergency</span><span class="p">(</span><span class="s2">&quot;This is an EMERGENCY!!!&quot;</span><span class="p">);</span>
</span><span id="__span-26-35"><a id="__codelineno-26-35" name="__codelineno-26-35"></a><a href="#__codelineno-26-35"><span class="linenos" data-linenos="35 "></span></a><span class="cp">?&gt;</span>
</span></code></pre></div>
<p>Aunque esta aproximación está bien, en un sistema medianamente complejo puede ser muy complicado tener que monitorizar tantos lugares. En estos casos, es recomendable utilizar un sistema de monitorización de logs, como <em>BetterStack</em>, <em>Loggly</em>, <em>Papertrail</em> o <em>Logstash</em>.</p>
<p>En este ejemplo, vamos a utilizar la plataforma <em>BetterStack</em> para enviar los logs de nuestra aplicación. Para ello, sigue los siguientes pasos:</p>
<ol>
<li>
<p>Instalar la librería cliente de BetterStack en tu proyecto:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1"></a><a href="#__codelineno-27-1"><span class="linenos" data-linenos="1 "></span></a>composer<span class="w"> </span>require<span class="w"> </span>logtail/monolog-logtail
</span></code></pre></div>
</li>
<li>
<p>Configurar el logger de Monolog con BetterStack.</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1"></a><a href="#__codelineno-28-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">use</span> <span class="nx">Monolog\Logger</span><span class="p">;</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2"></a><a href="#__codelineno-28-2"><span class="linenos" data-linenos="2 "></span></a><span class="k">use</span> <span class="nx">Logtail\Monolog\LogtailHandlerBuilder</span><span class="p">;</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3"></a><a href="#__codelineno-28-3"><span class="linenos" data-linenos="3 "></span></a>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4"></a><a href="#__codelineno-28-4"><span class="linenos" data-linenos="4 "></span></a><span class="nv">$logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s2">&quot;example-app&quot;</span><span class="p">);</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5"></a><a href="#__codelineno-28-5"><span class="linenos" data-linenos="5 "></span></a><span class="c1">//Reempalzar $SOURCE_TOKEN por el token de tu proyecto en BetterStack</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6"></a><a href="#__codelineno-28-6"><span class="linenos" data-linenos="6 "></span></a><span class="nv">$handler</span> <span class="o">=</span> <span class="nx">LogtailHandlerBuilder</span><span class="o">::</span><span class="na">withSourceToken</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$SOURCE_TOKEN</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7"></a><a href="#__codelineno-28-7"><span class="linenos" data-linenos="7 "></span></a><span class="o">-&gt;</span><span class="na">build</span><span class="p">();</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8"></a><a href="#__codelineno-28-8"><span class="linenos" data-linenos="8 "></span></a><span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="nv">$handler</span><span class="p">);</span>
</span></code></pre></div>
</li>
<li>
<p>Utilizar el logger de Monolog como de costumbre.</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1"></a><a href="#__codelineno-29-1"><span class="linenos" data-linenos="1 "></span></a><span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">info</span><span class="p">(</span><span class="s2">&quot;This file has been executed.&quot;</span><span class="p">);</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2"></a><a href="#__codelineno-29-2"><span class="linenos" data-linenos="2 "></span></a><span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="s2">&quot;An error occurred.&quot;</span><span class="p">);</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3"></a><a href="#__codelineno-29-3"><span class="linenos" data-linenos="3 "></span></a><span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">critical</span><span class="p">(</span><span class="s2">&quot;This application is in critical condition!!&quot;</span><span class="p">);</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4"></a><a href="#__codelineno-29-4"><span class="linenos" data-linenos="4 "></span></a><span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">emergency</span><span class="p">(</span><span class="s2">&quot;This is an EMERGENCY!!!&quot;</span><span class="p">);</span>
</span></code></pre></div>
</li>
</ol>
<p>Para obtener un <code>token</code> de BetterStack, simplemente registrar una cuenta (tienen un plan gratuito) y obteneer un token para tu proyecto desde el siguiente <a href="https://telemetry.betterstack.com/team/0/sources?_gl=1*po1zew*_gcl_au*MjEwOTk2Mzg4My4xNzMyNTU5MzE5*_ga*MTkwMDUwNTQwNy4xNzMyNTU5MzE4*_ga_9FLKD0MQYY*MTczMjU2MjgyNC4yLjEuMTczMjU2MzIwNC4wLjAuMA..">enlace</a>.</p>
<div class="admonition tip">
<p class="admonition-title">Ver capítulo: Configurando un logger con Monolog</p>
<p>En este <a href="https://drive.google.com/file/d/1CHFCWle9ozwxoxZdsBOmyNetz5aU_ERv/view?usp=sharing">capítulo</a> del curso "Crear aplicación Web" vemos como configurar un logger en nuestra aplicación y como enviar los logs a un servidor de logs.</p>
</div>
<h2 id="documentacion-con-phpdocumentor">Documentación con <em>phpDocumentor</em><a class="headerlink" href="#documentacion-con-phpdocumentor" title="Permanent link">&para;</a></h2>
<p><a href="https://www.phpdoc.org/">phpDocumentor</a> es la herramienta <em>de facto</em> para documentar el código PHP. Es similar en propósito y funcionamiento a <em>Javadoc</em>.</p>
<p>Así pues, es un herramienta que facilita la documentación del código PHP, creando un sitio web con el API de la aplicación.</p>
<p>Se basa en el uso de anotaciones sobre los docblocks. Para ponerlo en marcha, en nuestro caso nos decantaremos por utilizar la imagen que ya existe de Docker.</p>
<h3 id="instalacion-como-binario">Instalación como binario<a class="headerlink" href="#instalacion-como-binario" title="Permanent link">&para;</a></h3>
<p>Otra opción es seguir los pasos que recomienda la <a href="https://www.phpdoc.org">documentación oficial</a> para instalarlo como un ejecutable, que son descargar el archivo <code>phpDocumentor.phar</code> y darles permisos de ejecución:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1"></a><a href="#__codelineno-30-1"><span class="linenos" data-linenos="1 "></span></a>wget<span class="w"> </span>https://phpdoc.org/phpDocumentor.phar
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2"></a><a href="#__codelineno-30-2"><span class="linenos" data-linenos="2 "></span></a>chmod<span class="w"> </span>+x<span class="w"> </span>phpDocumentor.phar
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3"></a><a href="#__codelineno-30-3"><span class="linenos" data-linenos="3 "></span></a>mv<span class="w"> </span>phpDocumentor.phar<span class="w"> </span>/usr/local/bin/phpdoc
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4"></a><a href="#__codelineno-30-4"><span class="linenos" data-linenos="4 "></span></a>phpdoc<span class="w"> </span>--version
</span></code></pre></div>
<p>Una vez instalado, desde el raíz del proyecto, suponiendo que tenemos nuestro código dentro de <code>app</code> y que queremos la documentación dentro de <code>docs/api</code> ejecutamos:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1"></a><a href="#__codelineno-31-1"><span class="linenos" data-linenos="1 "></span></a>phpdoc<span class="w"> </span>-d<span class="w"> </span>./app<span class="w"> </span>-t<span class="w"> </span>docs/api
</span></code></pre></div>
<h3 id="uso-en-docker">Uso en Docker<a class="headerlink" href="#uso-en-docker" title="Permanent link">&para;</a></h3>
<p>En el caso de usar <em>Docker</em>, usaremos el siguiente comando para ejecutarlo (crea el contenedor, ejecuta el comando que le pidamos, y automáticamente lo borra):</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1"></a><a href="#__codelineno-32-1"><span class="linenos" data-linenos="1 "></span></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">&quot;</span>:/data<span class="w"> </span>phpdoc/phpdoc:3
</span></code></pre></div>
<p>A dicho comando, le adjuntaremos los diferentes parámetros que admite phpDocumentor, por ejemplo:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1"></a><a href="#__codelineno-33-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># Muestra la versión</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2"></a><a href="#__codelineno-33-2"><span class="linenos" data-linenos="2 "></span></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">&quot;</span>:/data<span class="w"> </span>phpdoc/phpdoc:3<span class="w"> </span>--version
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3"></a><a href="#__codelineno-33-3"><span class="linenos" data-linenos="3 "></span></a><span class="c1"># Mediante -d se indica el origen a parsear</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4"></a><a href="#__codelineno-33-4"><span class="linenos" data-linenos="4 "></span></a><span class="c1"># Mediante -t se indica el destino donde generar la documentación</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5"></a><a href="#__codelineno-33-5"><span class="linenos" data-linenos="5 "></span></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">&quot;</span>:/data<span class="w"> </span>phpdoc/phpdoc:3<span class="w"> </span>-d<span class="w"> </span>./src/app<span class="w"> </span>-t<span class="w"> </span>./docs/api
</span></code></pre></div>
<h3 id="docblock">DocBlock<a class="headerlink" href="#docblock" title="Permanent link">&para;</a></h3>
<p>Un <em>docblock</em> es el bloque de código que se coloca encima de un recurso. Su formato es:</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1"></a><a href="#__codelineno-34-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="o">&lt;?</span><span class="nx">php</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2"></a><a href="#__codelineno-34-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="sd">/**</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3"></a><a href="#__codelineno-34-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="sd">* *Sumario*, una sola línea</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4"></a><a href="#__codelineno-34-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="sd">*</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5"></a><a href="#__codelineno-34-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="sd">* *Descripción* que puede utilizar varias líneas</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6"></a><a href="#__codelineno-34-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="sd">* y que ofrece detalles del elemento o referencias</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7"></a><a href="#__codelineno-34-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="sd">* para ampliar la información</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8"></a><a href="#__codelineno-34-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="sd">*</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9"></a><a href="#__codelineno-34-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="sd">* @param string $miArgumento con una *descripción* del argumento</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10"></a><a href="#__codelineno-34-10"><span class="linenos" data-linenos="10 "></span></a><span class="sd">* que puede usar varias líneas.</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11"></a><a href="#__codelineno-34-11"><span class="linenos" data-linenos="11 "></span></a><span class="sd">*</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12"></a><a href="#__codelineno-34-12"><span class="linenos" data-linenos="12 "></span></a><span class="sd">* @return void</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13"></a><a href="#__codelineno-34-13"><span class="linenos" data-linenos="13 "></span></a><span class="sd">*/</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14"></a><a href="#__codelineno-34-14"><span class="linenos" data-linenos="14 "></span></a><span class="k">function</span> <span class="nf">miFuncion</span><span class="p">(</span><span class="nx">tipo</span> <span class="nv">$miArgumento</span><span class="p">)</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15"></a><a href="#__codelineno-34-15"><span class="linenos" data-linenos="15 "></span></a><span class="p">{</span>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16"></a><a href="#__codelineno-34-16"><span class="linenos" data-linenos="16 "></span></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="documentando-el-codigo">Documentando el código<a class="headerlink" href="#documentando-el-codigo" title="Permanent link">&para;</a></h3>
<p>En todos los elementos, ademas del sumario y/o descripción, pondremos:</p>
<ul>
<li>En las clases:<ul>
<li><code>@author</code> nombre <email></li>
<li><code>@package</code> ruta del namespace</li>
</ul>
</li>
<li>En las propiedades:<ul>
<li><code>@var</code> tipo descripción</li>
</ul>
</li>
<li>En los métodos:<ul>
<li><code>@param</code> tipo $nombre descripción</li>
<li><code>@throws</code> ClaseException descripción</li>
<li><code>@return</code> tipo descripción</li>
</ul>
</li>
</ul>
<p>Veámoslo con un ejemplo. Supongamos que tenemos una clase que representa un cliente:</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1"></a><a href="#__codelineno-35-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="o">&lt;?</span><span class="nx">php</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2"></a><a href="#__codelineno-35-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="sd">/**</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3"></a><a href="#__codelineno-35-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="sd">* Clase que representa un cliente</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4"></a><a href="#__codelineno-35-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="sd">* </span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5"></a><a href="#__codelineno-35-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="sd">* El cliente se encarga de almacenar los soportes que tiene alquilado,</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6"></a><a href="#__codelineno-35-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="sd">* de manera que podemos alquilar y devolver productos mediante las operaciones</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7"></a><a href="#__codelineno-35-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="sd">* homónimas.</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8"></a><a href="#__codelineno-35-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="sd">* </span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9"></a><a href="#__codelineno-35-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="sd">* @package Dwes\Videoclub\Model</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10"></a><a href="#__codelineno-35-10"><span class="linenos" data-linenos="10 "></span></a><span class="sd">* @author Aitor Medrano &lt;a.medrano@edu.gva.es&gt;</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11"></a><a href="#__codelineno-35-11"><span class="linenos" data-linenos="11 "></span></a><span class="sd">*/</span>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12"></a><a href="#__codelineno-35-12"><span class="linenos" data-linenos="12 "></span></a><span class="k">class</span> <span class="nc">Cliente</span> <span class="p">{</span>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13"></a><a href="#__codelineno-35-13"><span class="linenos" data-linenos="13 "></span></a>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14"></a><a href="#__codelineno-35-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="k">public</span> <span class="nx">string</span> <span class="nv">$nombre</span><span class="p">;</span> 
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15"></a><a href="#__codelineno-35-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$numero</span><span class="p">;</span>
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16"></a><a href="#__codelineno-35-16"><span class="linenos" data-linenos="16 "></span></a>
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17"></a><a href="#__codelineno-35-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="sd">/**</span>
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18"></a><a href="#__codelineno-35-18"><span class="linenos" data-linenos="18 "></span></a><span class="sd">    * Colección de soportes alquilados</span>
</span><span id="__span-35-19"><a id="__codelineno-35-19" name="__codelineno-35-19"></a><a href="#__codelineno-35-19"><span class="linenos" data-linenos="19 "></span></a><span class="sd">    * @var array&lt;Soporte&gt; </span>
</span><span id="__span-35-20"><a id="__codelineno-35-20" name="__codelineno-35-20"></a><a href="#__codelineno-35-20"><span class="linenos" data-linenos="20 "></span></a><span class="sd">    */</span>
</span><span id="__span-35-21"><a id="__codelineno-35-21" name="__codelineno-35-21"></a><a href="#__codelineno-35-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="k">private</span> <span class="nv">$soportesAlquilados</span><span class="p">[];</span>
</span><span id="__span-35-22"><a id="__codelineno-35-22" name="__codelineno-35-22"></a><a href="#__codelineno-35-22"><span class="linenos" data-linenos="22 "></span></a>
</span><span id="__span-35-23"><a id="__codelineno-35-23" name="__codelineno-35-23"></a><a href="#__codelineno-35-23"><span class="linenos" data-linenos="23 "></span></a>    <span class="sd">/**</span>
</span><span id="__span-35-24"><a id="__codelineno-35-24" name="__codelineno-35-24"></a><a href="#__codelineno-35-24"><span class="linenos" data-linenos="24 "></span></a><span class="sd">    * Comprueba si el soporte recibido ya lo tiene alquilado el cliente</span>
</span><span id="__span-35-25"><a id="__codelineno-35-25" name="__codelineno-35-25"></a><a href="#__codelineno-35-25"><span class="linenos" data-linenos="25 "></span></a><span class="sd">    * @param Soporte $soporte Soporte a comprobar</span>
</span><span id="__span-35-26"><a id="__codelineno-35-26" name="__codelineno-35-26"></a><a href="#__codelineno-35-26"><span class="linenos" data-linenos="26 "></span></a><span class="sd">    * @return bool true si lo tiene alquilado</span>
</span><span id="__span-35-27"><a id="__codelineno-35-27" name="__codelineno-35-27"></a><a href="#__codelineno-35-27"><span class="linenos" data-linenos="27 "></span></a><span class="sd">    */</span>
</span><span id="__span-35-28"><a id="__codelineno-35-28" name="__codelineno-35-28"></a><a href="#__codelineno-35-28"><span class="linenos" data-linenos="28 "></span></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">tieneAlquilado</span><span class="p">(</span><span class="nx">Soporte</span> <span class="nv">$soporte</span><span class="p">)</span> <span class="o">:</span> <span class="nx">bool</span> <span class="p">{</span> 
</span><span id="__span-35-29"><a id="__codelineno-35-29" name="__codelineno-35-29"></a><a href="#__codelineno-35-29"><span class="linenos" data-linenos="29 "></span></a>        <span class="c1">// ...</span>
</span><span id="__span-35-30"><a id="__codelineno-35-30" name="__codelineno-35-30"></a><a href="#__codelineno-35-30"><span class="linenos" data-linenos="30 "></span></a>    <span class="p">}</span>
</span></code></pre></div>
<p>Si generamos la documentación y abrimos con un navegador el archivo <code>docs/api/index.html</code> podremos navegar hasta la clase `Cliente:</p>
<figure style="align: center;">
    <a class="glightbox" href="imagenes/05/phpdoc.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img src="imagenes/05/phpdoc.png"></a>
    <figcaption>phpDocumentor de Cliente</figcaption>
</figure>

<h2 id="pruebas-con-phpunit">Pruebas con PHPUnit<a class="headerlink" href="#pruebas-con-phpunit" title="Permanent link">&para;</a></h2>
<p>El curso pasado, dentro del módulo de <em>Entornos de Desarrollo</em>, estudiamos la importancia de la realización de pruebas, así como las pruebas unitarias mediante <a href="https://junit.org/junit5/">JUnit</a>.</p>
<figure style="float: right;">
    <a class="glightbox" href="imagenes/05/tdd.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img src="imagenes/05/tdd.png" width="300"></a>
    <figcaption>Test Driven Development</figcaption>
</figure>

<p>A día de hoy es de gran importancia seguir una buena metodología de pruebas, siendo el desarrollo dirigido por las pruebas (<em>Test Driven Development</em> / TDD) uno de los enfoques más empleados, el cual consiste en:</p>
<ol>
<li>Escribir el test, y como no hay código implementado, la prueba falle (rojo).</li>
<li>Escribir el código de aplicación para que la prueba funcione (verde).</li>
<li>Refactorizar el código de la aplicación con la ayuda de la prueba para comprobar que no rompemos nada (refactor).</li>
</ol>
<p>En el caso de PHP, la herramienta que se utiliza es <em>PHPUnit</em> (<a href="https://phpunit.de/">https://phpunit.de/</a>), que como su nombre indica, está basada en JUnit. </p>
<p>Aunque hay una nueva utilidad llamada <strong><a href="https://pestphp.com/">Pest</a></strong> que está ganando popularidad. Pest es una alternativa a PHPUnit que ofrece una sintaxis más limpia y moderna. Está inspirado en Jest, el popular marco de pruebas de JavaScript.</p>
<div class="admonition info">
<p class="admonition-title">PHPUnit / Pest</p>
<ul>
<li>documentación <a href="https://phpunit.de/documentation.html">PHPUnit</a></li>
<li>documentación <a href="https://pestphp.com/docs/overview">Pest</a></li>
</ul>
</div>
<h3 id="puesta-en-marcha">Puesta en marcha<a class="headerlink" href="#puesta-en-marcha" title="Permanent link">&para;</a></h3>
<p>Vamos a colocar todas las pruebas en una carpeta <code>tests</code> en el raíz de nuestro proyecto.</p>
<p>En el archivo <code>composer.json</code>, añadimos:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1"></a><a href="#__codelineno-36-1"><span class="linenos" data-linenos="1 "></span></a><span class="nt">&quot;require-dev&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2"></a><a href="#__codelineno-36-2"><span class="linenos" data-linenos="2 "></span></a><span class="w">    </span><span class="nt">&quot;phpunit/phpunit&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^9&quot;</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3"></a><a href="#__codelineno-36-3"><span class="linenos" data-linenos="3 "></span></a><span class="p">},</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4"></a><a href="#__codelineno-36-4"><span class="linenos" data-linenos="4 "></span></a><span class="nt">&quot;scripts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5"></a><a href="#__codelineno-36-5"><span class="linenos" data-linenos="5 "></span></a><span class="w">    </span><span class="nt">&quot;test&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;phpunit --testdox --colors tests&quot;</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6"></a><a href="#__codelineno-36-6"><span class="linenos" data-linenos="6 "></span></a><span class="p">}</span>
</span></code></pre></div>
<p>Si quisiéramos añadir la librería desde un comando del terminal, también podríamos ejecutar:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1"></a><a href="#__codelineno-37-1"><span class="linenos" data-linenos="1 "></span></a>composer<span class="w"> </span>require<span class="w"> </span>--dev<span class="w"> </span>phpunit/phpunit<span class="w"> </span>^9
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Librerías de desarrollo</p>
<p>Las librerías que se colocan en <code>require-dev</code> son las de desarrollo y <em>testing</em>, de manera que no se instalarán en un entorno de producción.</p>
</div>
<p>Como hemos creado un <em>script</em>, podemos lanzar las pruebas mediante:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1"></a><a href="#__codelineno-38-1"><span class="linenos" data-linenos="1 "></span></a>composer<span class="w"> </span><span class="nb">test</span>
</span></code></pre></div>
<p>Vasmos a realizar nuestra primera prueba:</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1"></a><a href="#__codelineno-39-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="o">&lt;?</span><span class="nx">php</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2"></a><a href="#__codelineno-39-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3"></a><a href="#__codelineno-39-3"><span class="linenos" data-linenos=" 3 "></span></a>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4"></a><a href="#__codelineno-39-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">class</span> <span class="nc">PilaTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5"></a><a href="#__codelineno-39-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="p">{</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6"></a><a href="#__codelineno-39-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testPushAndPop</span><span class="p">()</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7"></a><a href="#__codelineno-39-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="p">{</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8"></a><a href="#__codelineno-39-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="nv">$pila</span> <span class="o">=</span> <span class="p">[];</span>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9"></a><a href="#__codelineno-39-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$pila</span><span class="p">));</span>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10"></a><a href="#__codelineno-39-10"><span class="linenos" data-linenos="10 "></span></a>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11"></a><a href="#__codelineno-39-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="nb">array_push</span><span class="p">(</span><span class="nv">$pila</span><span class="p">,</span> <span class="s1">&#39;batman&#39;</span><span class="p">);</span>
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12"></a><a href="#__codelineno-39-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">&#39;batman&#39;</span><span class="p">,</span> <span class="nv">$pila</span><span class="p">[</span><span class="nb">count</span><span class="p">(</span><span class="nv">$pila</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13"></a><a href="#__codelineno-39-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$pila</span><span class="p">));</span>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14"></a><a href="#__codelineno-39-14"><span class="linenos" data-linenos="14 "></span></a>
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15"></a><a href="#__codelineno-39-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">&#39;batman&#39;</span><span class="p">,</span> <span class="nb">array_pop</span><span class="p">(</span><span class="nv">$pila</span><span class="p">));</span>
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16"></a><a href="#__codelineno-39-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$pila</span><span class="p">));</span>
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17"></a><a href="#__codelineno-39-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="p">}</span>
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18"></a><a href="#__codelineno-39-18"><span class="linenos" data-linenos="18 "></span></a><span class="p">}</span>
</span></code></pre></div>
<p>Tenemos diferentes formas de ejecutar una prueba:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1"></a><a href="#__codelineno-40-1"><span class="linenos" data-linenos="1 "></span></a>./vendor/bin/phpunit<span class="w"> </span>tests/PilaTest.php
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2"></a><a href="#__codelineno-40-2"><span class="linenos" data-linenos="2 "></span></a>./vendor/bin/phpunit<span class="w"> </span>tests
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3"></a><a href="#__codelineno-40-3"><span class="linenos" data-linenos="3 "></span></a>./vendor/bin/phpunit<span class="w"> </span>--testdox<span class="w"> </span>tests
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4"></a><a href="#__codelineno-40-4"><span class="linenos" data-linenos="4 "></span></a>./vendor/bin/phpunit<span class="w"> </span>--testdox<span class="w"> </span>--colors<span class="w"> </span>tests
</span></code></pre></div>
<div class="admonition danger">
<p class="admonition-title">Trabajando con Pest</p>
<p>Revisa el <a href="https://drive.google.com/file/d/1OHTVuOEU8rdN5k6RglQ641JShOk_KOeH/view?usp=sharing">capítulo</a> para ver cómo se instala Pest</p>
</div>
<h3 id="disenando-pruebas">Diseñando pruebas<a class="headerlink" href="#disenando-pruebas" title="Permanent link">&para;</a></h3>
<p>Tal como hemos visto en el ejemplo, la clase de prueba debe heredar de <code>TestCase</code>, y el nombre de la clase debe acabar en <code>Test</code>, de ahí que hayamos llamado la clase de prueba como <code>PilaTest</code>.</p>
<p>Una prueba implica un método de prueba (público) por cada funcionalidad a probar. Cada un de los métodos se les asocia un caso de prueba.</p>
<p>Los métodos deben nombrarse con el prefijo <code>test</code>, por ejemplo, <code>testPushAndPop</code>. Es muy importante que el nombre sea muy claro y descriptivo del propósito de la prueba. (<em>camelCase</em>).</p>
<p>En los casos de prueba prepararemos varias aserciones para toda la casuística: rangos de valores, tipos de datos, excepciones, etc...</p>
<h3 id="aserciones">Aserciones<a class="headerlink" href="#aserciones" title="Permanent link">&para;</a></h3>
<p>Las aserciones permiten comprobar el resultado de los métodos que queremos probar. Las aserciones esperan que el predicado siempre sea verdadero.</p>
<p>PHPUnit ofrece las siguiente aserciones:</p>
<ul>
<li><code>assertTrue</code> / <code>assertFalse</code>: Comprueba que la condición dada sea evaluada como true / false</li>
<li><code>assertEquals</code> / <code>assertSame</code>: Comprueba que dos variables sean iguales</li>
<li><code>assertNotEquals</code> / <code>assertNotSame</code>: Comprueba que dos variables NO sean iguales<ul>
<li><code>Same</code> → comprueba los tipos. Si no coinciden los tipos y los valores, la aserción fallará</li>
<li><code>Equals</code> → sin comprobación estricta</li>
</ul>
</li>
<li><code>assertArrayHasKey</code> / <code>assertArrayNotHasKey</code>: Comprueba que un array posea un <em>key</em> determinado / o NO lo posea</li>
<li><code>assertArraySubset</code>: Comprueba que un array posea otro array como subset del mismo</li>
<li><code>assertAttributeContains</code> / <code>assertAttributeNotContains</code>: Comprueba que un atributo de una clase contenga una variable determinada / o NO contenga una variable determinada</li>
<li><code>assertAttributeEquals</code>: Comprueba que un atributo de una clase sea igual a una variable determinada.</li>
</ul>
<p><strong>Pest</strong> ofrece las siguientes aserciones, que son equivalentes a las de PHPUnit:</p>
<ul>
<li><code>expect()-&gt;toBe(true)</code></li>
<li><code>expect()-&gt;toBeFalse()</code></li>
<li><code>expect()-&gt;toBeTrue()</code></li>
<li><code>expect()-&gt;toBeNull()</code></li>
<li><code>expect()-&gt;toBeEmpty()</code></li>
<li><code>expect()-&gt;toBeNotEmpty()</code></li>
<li><code>expect()-&gt;toBeInstanceOf(Clase::class)</code></li>
<li><code>expect()-&gt;toBeArray()</code></li>
</ul>
<p>para conocer todos los tipos de <a href="https://pestphp.com/docs/expectations">Expections</a> consulta la documentación de Pest.</p>
<h3 id="comparando-la-salida">Comparando la salida<a class="headerlink" href="#comparando-la-salida" title="Permanent link">&para;</a></h3>
<p>Si los métodos a probar generan contenido mediante <code>echo</code> o una instrucción similar, disponemos de las siguiente expectativas:</p>
<ul>
<li><code>expectOutputString(salidaEsperada)</code></li>
<li><code>expectOutputRegex(expresionRegularEsperada)</code></li>
</ul>
<p>Las expectativas difieren de las aserciones que informan del resultado que se espera antes de invocar al método. Tras definir la expectativa, se invoca al método que realiza el <code>echo</code>/<code>print</code>.</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1"></a><a href="#__codelineno-41-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="o">&lt;?</span><span class="nx">php</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2"></a><a href="#__codelineno-41-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="k">namespace</span> <span class="nx">Dwes\Videoclub\Model</span><span class="p">;</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3"></a><a href="#__codelineno-41-3"><span class="linenos" data-linenos=" 3 "></span></a>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4"></a><a href="#__codelineno-41-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5"></a><a href="#__codelineno-41-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">use</span> <span class="nx">Dwes\Videoclub\Model\CintaVideo</span><span class="p">;</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6"></a><a href="#__codelineno-41-6"><span class="linenos" data-linenos=" 6 "></span></a>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7"></a><a href="#__codelineno-41-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="k">class</span> <span class="nc">CintaVideoTest</span> <span class="k">extends</span> <span class="nx">TestCase</span> <span class="p">{</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8"></a><a href="#__codelineno-41-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testConstructor</span><span class="p">()</span>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9"></a><a href="#__codelineno-41-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="p">{</span>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10"></a><a href="#__codelineno-41-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="nv">$cinta</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CintaVideo</span><span class="p">(</span><span class="s2">&quot;Los cazafantasmas&quot;</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">107</span><span class="p">);</span> 
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11"></a><a href="#__codelineno-41-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span> <span class="nv">$cinta</span><span class="o">-&gt;</span><span class="na">getNumero</span><span class="p">(),</span> <span class="mi">23</span><span class="p">);</span>
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12"></a><a href="#__codelineno-41-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="p">}</span>
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13"></a><a href="#__codelineno-41-13"><span class="linenos" data-linenos="13 "></span></a>
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14"></a><a href="#__codelineno-41-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testMuestraResumen</span><span class="p">()</span>
</span><span id="__span-41-15"><a id="__codelineno-41-15" name="__codelineno-41-15"></a><a href="#__codelineno-41-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="p">{</span>
</span><span id="__span-41-16"><a id="__codelineno-41-16" name="__codelineno-41-16"></a><a href="#__codelineno-41-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="nv">$cinta</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CintaVideo</span><span class="p">(</span><span class="s2">&quot;Los cazafantasmas&quot;</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">107</span><span class="p">);</span>
</span><span id="__span-41-17"><a id="__codelineno-41-17" name="__codelineno-41-17"></a><a href="#__codelineno-41-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="nv">$resultado</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;Película en VHS:&quot;</span><span class="p">;</span>
</span><span id="__span-41-18"><a id="__codelineno-41-18" name="__codelineno-41-18"></a><a href="#__codelineno-41-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="nv">$resultado</span> <span class="o">.=</span> <span class="s2">&quot;&lt;br&gt;Los cazafantasmas&lt;br&gt;3.5 (IVA no incluido)&quot;</span><span class="p">;</span>
</span><span id="__span-41-19"><a id="__codelineno-41-19" name="__codelineno-41-19"></a><a href="#__codelineno-41-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="nv">$resultado</span> <span class="o">.=</span> <span class="s2">&quot;&lt;br&gt;Duración: 107 minutos&quot;</span><span class="p">;</span>
</span><span id="__span-41-20"><a id="__codelineno-41-20" name="__codelineno-41-20"></a><a href="#__codelineno-41-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="c1">// definimos la expectativa</span>
</span><span id="__span-41-21"><a id="__codelineno-41-21" name="__codelineno-41-21"></a><a href="#__codelineno-41-21"><span class="linenos" data-linenos="21 "></span></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectOutputString</span><span class="p">(</span><span class="nv">$resultado</span><span class="p">);</span>
</span><span id="__span-41-22"><a id="__codelineno-41-22" name="__codelineno-41-22"></a><a href="#__codelineno-41-22"><span class="linenos" data-linenos="22 "></span></a>        <span class="c1">// invocamos al método que hará echo</span>
</span><span id="__span-41-23"><a id="__codelineno-41-23" name="__codelineno-41-23"></a><a href="#__codelineno-41-23"><span class="linenos" data-linenos="23 "></span></a>        <span class="nv">$cinta</span><span class="o">-&gt;</span><span class="na">muestraResumen</span><span class="p">();</span>
</span><span id="__span-41-24"><a id="__codelineno-41-24" name="__codelineno-41-24"></a><a href="#__codelineno-41-24"><span class="linenos" data-linenos="24 "></span></a>    <span class="p">}</span>
</span><span id="__span-41-25"><a id="__codelineno-41-25" name="__codelineno-41-25"></a><a href="#__codelineno-41-25"><span class="linenos" data-linenos="25 "></span></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="proveedores-de-datos">Proveedores de datos<a class="headerlink" href="#proveedores-de-datos" title="Permanent link">&para;</a></h3>
<p>Cuando tenemos pruebas que solo cambian respecto a los datos de entrada y de salida, es útil utilizar proveedores de datos.</p>
<p>Se declaran en el docblock mediante <code>@dataProvider nombreMetodo</code>, donde se indica el nombre de un método público que devuelve un array de arrays, donde cada elemento es un caso de prueba.</p>
<p>La clase de prueba recibe como parámetros los datos a probar y el resultado de la prueba como último parámetro.</p>
<p>El siguiente ejemplo comprueba con diferentes datos el funcionamiento de <code>muestraResumen</code>:</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1"></a><a href="#__codelineno-42-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="o">&lt;?</span><span class="nx">php</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2"></a><a href="#__codelineno-42-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="sd">/**</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3"></a><a href="#__codelineno-42-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="sd"> * @dataProvider cintasProvider</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4"></a><a href="#__codelineno-42-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="sd"> */</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5"></a><a href="#__codelineno-42-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">public</span> <span class="k">function</span> <span class="nf">testMuestraResumenConProvider</span><span class="p">(</span><span class="nv">$titulo</span><span class="p">,</span> <span class="nv">$id</span><span class="p">,</span> <span class="nv">$precio</span><span class="p">,</span> <span class="nv">$duracion</span><span class="p">,</span> <span class="nv">$esperado</span><span class="p">)</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6"></a><a href="#__codelineno-42-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="p">{</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7"></a><a href="#__codelineno-42-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="nv">$cinta</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CintaVideo</span><span class="p">(</span><span class="nv">$titulo</span><span class="p">,</span> <span class="nv">$id</span><span class="p">,</span> <span class="nv">$precio</span><span class="p">,</span> <span class="nv">$duracion</span><span class="p">);</span>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8"></a><a href="#__codelineno-42-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectOutputString</span><span class="p">(</span><span class="nv">$esperado</span><span class="p">);</span>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9"></a><a href="#__codelineno-42-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="nv">$cinta</span><span class="o">-&gt;</span><span class="na">muestraResumen</span><span class="p">();</span>
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10"></a><a href="#__codelineno-42-10"><span class="linenos" data-linenos="10 "></span></a><span class="p">}</span>
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11"></a><a href="#__codelineno-42-11"><span class="linenos" data-linenos="11 "></span></a>
</span><span id="__span-42-12"><a id="__codelineno-42-12" name="__codelineno-42-12"></a><a href="#__codelineno-42-12"><span class="linenos" data-linenos="12 "></span></a><span class="k">public</span> <span class="k">function</span> <span class="nf">cintasProvider</span><span class="p">()</span> <span class="p">{</span>
</span><span id="__span-42-13"><a id="__codelineno-42-13" name="__codelineno-42-13"></a><a href="#__codelineno-42-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="k">return</span> <span class="p">[</span>
</span><span id="__span-42-14"><a id="__codelineno-42-14" name="__codelineno-42-14"></a><a href="#__codelineno-42-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="s2">&quot;cazafantasmas&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;Los cazafantasmas&quot;</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="s2">&quot;&lt;br&gt;Película en VHS:&lt;br&gt;Los cazafantasmas&lt;br&gt;3.5 €(IVA no incluido)&lt;br&gt;Duración: 107 minutos&quot;</span><span class="p">],</span>
</span><span id="__span-42-15"><a id="__codelineno-42-15" name="__codelineno-42-15"></a><a href="#__codelineno-42-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="s2">&quot;superman&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;Superman&quot;</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">188</span><span class="p">,</span> <span class="s2">&quot;&lt;br&gt;Película en VHS:&lt;br&gt;Superman&lt;br&gt;3 € (IVA no incluido)&lt;br&gt;Duración: 188 minutos&quot;</span><span class="p">],</span>
</span><span id="__span-42-16"><a id="__codelineno-42-16" name="__codelineno-42-16"></a><a href="#__codelineno-42-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="p">];</span>
</span><span id="__span-42-17"><a id="__codelineno-42-17" name="__codelineno-42-17"></a><a href="#__codelineno-42-17"><span class="linenos" data-linenos="17 "></span></a><span class="p">}</span>
</span></code></pre></div>
<p>En Pest esto se consigue con el método <code>with</code>:</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1"></a><a href="#__codelineno-43-1"><span class="linenos" data-linenos="1 "></span></a><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;muestra resumen con provider&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$titulo</span><span class="p">,</span> <span class="nv">$id</span><span class="p">,</span> <span class="nv">$precio</span><span class="p">,</span> <span class="nv">$duracion</span><span class="p">,</span> <span class="nv">$esperado</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2"></a><a href="#__codelineno-43-2"><span class="linenos" data-linenos="2 "></span></a>    <span class="nv">$cinta</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CintaVideo</span><span class="p">(</span><span class="nv">$titulo</span><span class="p">,</span> <span class="nv">$id</span><span class="p">,</span> <span class="nv">$precio</span><span class="p">,</span> <span class="nv">$duracion</span><span class="p">);</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3"></a><a href="#__codelineno-43-3"><span class="linenos" data-linenos="3 "></span></a>    <span class="nx">expect</span><span class="p">(</span><span class="nv">$cinta</span><span class="o">-&gt;</span><span class="na">muestraResumen</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">toBe</span><span class="p">(</span><span class="nv">$esperado</span><span class="p">);</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4"></a><a href="#__codelineno-43-4"><span class="linenos" data-linenos="4 "></span></a>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5"></a><a href="#__codelineno-43-5"><span class="linenos" data-linenos="5 "></span></a><span class="p">})</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">([</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6"></a><a href="#__codelineno-43-6"><span class="linenos" data-linenos="6 "></span></a>    <span class="p">[</span><span class="s2">&quot;Los cazafantasmas&quot;</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="s2">&quot;&lt;br&gt;Película en VHS:&lt;br&gt;Los cazafantasmas&lt;br&gt;3.5 €(IVA no incluido)&lt;br&gt;Duración: 107 minutos&quot;</span><span class="p">],</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7"></a><a href="#__codelineno-43-7"><span class="linenos" data-linenos="7 "></span></a>    <span class="p">[</span><span class="s2">&quot;Superman&quot;</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">188</span><span class="p">,</span> <span class="s2">&quot;&lt;br&gt;Película en VHS:&lt;br&gt;Superman&lt;br&gt;3 € (IVA no incluido)&lt;br&gt;Duración: 188 minutos&quot;</span><span class="p">],</span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8"></a><a href="#__codelineno-43-8"><span class="linenos" data-linenos="8 "></span></a><span class="p">]);</span>
</span></code></pre></div>
<h3 id="probando-excepciones">Probando excepciones<a class="headerlink" href="#probando-excepciones" title="Permanent link">&para;</a></h3>
<p>Las pruebas además de comprobar que las clases funcionan como se espera,  han de cubrir todos los casos posibles. Así pues, debemos poder hacer pruebas que esperen que se lance una excepción (y que el mensaje contenga cierta información):</p>
<p>Para ello, se utilizan las siguiente expectativas:</p>
<ul>
<li><code>expectException(Excepcion::class)</code></li>
<li><code>expectExceptionCode(codigoExcepcion)</code></li>
<li><code>expectExceptionMessage(mensaje)</code></li>
</ul>
<p>Del mismo modo que antes, primero se pone la expectativa, y luego se provoca que se lance la excepción:</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1"></a><a href="#__codelineno-44-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="o">&lt;?</span><span class="nx">php</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2"></a><a href="#__codelineno-44-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="k">public</span> <span class="k">function</span> <span class="nf">testAlquilarCupoLleno</span><span class="p">()</span> <span class="p">{</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3"></a><a href="#__codelineno-44-3"><span class="linenos" data-linenos=" 3 "></span></a>    <span class="nv">$soporte1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CintaVideo</span><span class="p">(</span><span class="s2">&quot;Los cazafantasmas&quot;</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">107</span><span class="p">);</span> 
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4"></a><a href="#__codelineno-44-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="nv">$soporte2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Juego</span><span class="p">(</span><span class="s2">&quot;The Last of Us Part II&quot;</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mf">49.99</span><span class="p">,</span> <span class="s2">&quot;PS4&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5"></a><a href="#__codelineno-44-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="nv">$soporte3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dvd</span><span class="p">(</span><span class="s2">&quot;Origen&quot;</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="s2">&quot;es,en,fr&quot;</span><span class="p">,</span> <span class="s2">&quot;16:9&quot;</span><span class="p">);</span> 
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6"></a><a href="#__codelineno-44-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="nv">$soporte4</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dvd</span><span class="p">(</span><span class="s2">&quot;El Imperio Contraataca&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;es,en&quot;</span><span class="p">,</span><span class="s2">&quot;16:9&quot;</span><span class="p">);</span> 
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7"></a><a href="#__codelineno-44-7"><span class="linenos" data-linenos=" 7 "></span></a>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8"></a><a href="#__codelineno-44-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="nv">$cliente1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cliente</span><span class="p">(</span><span class="s2">&quot;Bruce Wayne&quot;</span><span class="p">,</span> <span class="mi">23</span><span class="p">);</span> 
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9"></a><a href="#__codelineno-44-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="nv">$cliente1</span><span class="o">-&gt;</span><span class="na">alquilar</span><span class="p">(</span><span class="nv">$soporte1</span><span class="p">);</span> 
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10"></a><a href="#__codelineno-44-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="nv">$cliente1</span><span class="o">-&gt;</span><span class="na">alquilar</span><span class="p">(</span><span class="nv">$soporte2</span><span class="p">);</span> 
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11"></a><a href="#__codelineno-44-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="nv">$cliente1</span><span class="o">-&gt;</span><span class="na">alquilar</span><span class="p">(</span><span class="nv">$soporte3</span><span class="p">);</span> 
</span><span id="__span-44-12"><a id="__codelineno-44-12" name="__codelineno-44-12"></a><a href="#__codelineno-44-12"><span class="linenos" data-linenos="12 "></span></a>
</span><span id="__span-44-13"><a id="__codelineno-44-13" name="__codelineno-44-13"></a><a href="#__codelineno-44-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectException</span><span class="p">(</span><span class="nx">CupoSuperadoException</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-44-14"><a id="__codelineno-44-14" name="__codelineno-44-14"></a><a href="#__codelineno-44-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="nv">$cliente1</span><span class="o">-&gt;</span><span class="na">alquilar</span><span class="p">(</span><span class="nv">$soporte4</span><span class="p">);</span> 
</span><span id="__span-44-15"><a id="__codelineno-44-15" name="__codelineno-44-15"></a><a href="#__codelineno-44-15"><span class="linenos" data-linenos="15 "></span></a><span class="p">}</span>
</span></code></pre></div>
<p>Para <strong>Pest</strong>, la sintaxis es similar, pero con un estilo más limpio y moderno:</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1"></a><a href="#__codelineno-45-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;throws an exception when trying to divide by zero&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2"></a><a href="#__codelineno-45-2"><span class="linenos" data-linenos=" 2 "></span></a>    <span class="nx">expect</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3"></a><a href="#__codelineno-45-3"><span class="linenos" data-linenos=" 3 "></span></a>        <span class="nx">divide</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4"></a><a href="#__codelineno-45-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="p">})</span><span class="o">-&gt;</span><span class="na">toThrow</span><span class="p">(</span><span class="nx">DivideByZeroException</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5"></a><a href="#__codelineno-45-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="p">});</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6"></a><a href="#__codelineno-45-6"><span class="linenos" data-linenos=" 6 "></span></a>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7"></a><a href="#__codelineno-45-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;throws an exception when cliente cupo superado&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8"></a><a href="#__codelineno-45-8"><span class="linenos" data-linenos=" 8 "></span></a>
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9"></a><a href="#__codelineno-45-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="nv">$soporte1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CintaVideo</span><span class="p">(</span><span class="s2">&quot;Los cazafantasmas&quot;</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">107</span><span class="p">);</span> 
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10"></a><a href="#__codelineno-45-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="nv">$soporte2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Juego</span><span class="p">(</span><span class="s2">&quot;The Last of Us Part II&quot;</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mf">49.99</span><span class="p">,</span> <span class="s2">&quot;PS4&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11"></a><a href="#__codelineno-45-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="nv">$soporte3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dvd</span><span class="p">(</span><span class="s2">&quot;Origen&quot;</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="s2">&quot;es,en,fr&quot;</span><span class="p">,</span> <span class="s2">&quot;16:9&quot;</span><span class="p">);</span> 
</span><span id="__span-45-12"><a id="__codelineno-45-12" name="__codelineno-45-12"></a><a href="#__codelineno-45-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="nv">$soporte4</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dvd</span><span class="p">(</span><span class="s2">&quot;El Imperio Contraataca&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;es,en&quot;</span><span class="p">,</span><span class="s2">&quot;16:9&quot;</span><span class="p">);</span> 
</span><span id="__span-45-13"><a id="__codelineno-45-13" name="__codelineno-45-13"></a><a href="#__codelineno-45-13"><span class="linenos" data-linenos="13 "></span></a>
</span><span id="__span-45-14"><a id="__codelineno-45-14" name="__codelineno-45-14"></a><a href="#__codelineno-45-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="nv">$cliente1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cliente</span><span class="p">(</span><span class="s2">&quot;Bruce Wayne&quot;</span><span class="p">,</span> <span class="mi">23</span><span class="p">);</span> 
</span><span id="__span-45-15"><a id="__codelineno-45-15" name="__codelineno-45-15"></a><a href="#__codelineno-45-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="nv">$cliente1</span><span class="o">-&gt;</span><span class="na">alquilar</span><span class="p">(</span><span class="nv">$soporte1</span><span class="p">);</span> 
</span><span id="__span-45-16"><a id="__codelineno-45-16" name="__codelineno-45-16"></a><a href="#__codelineno-45-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="nv">$cliente1</span><span class="o">-&gt;</span><span class="na">alquilar</span><span class="p">(</span><span class="nv">$soporte2</span><span class="p">);</span> 
</span><span id="__span-45-17"><a id="__codelineno-45-17" name="__codelineno-45-17"></a><a href="#__codelineno-45-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="nv">$cliente1</span><span class="o">-&gt;</span><span class="na">alquilar</span><span class="p">(</span><span class="nv">$soporte3</span><span class="p">);</span> 
</span><span id="__span-45-18"><a id="__codelineno-45-18" name="__codelineno-45-18"></a><a href="#__codelineno-45-18"><span class="linenos" data-linenos="18 "></span></a>
</span><span id="__span-45-19"><a id="__codelineno-45-19" name="__codelineno-45-19"></a><a href="#__codelineno-45-19"><span class="linenos" data-linenos="19 "></span></a><span class="p">})</span><span class="o">-&gt;</span><span class="na">throws</span><span class="p">(</span><span class="nx">CupoSuperadoException</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Ver capítulo: Instalar 2 paquetes. Collections y Pest</p>
<p>En este <a href="https://drive.google.com/file/d/1OHTVuOEU8rdN5k6RglQ641JShOk_KOeH/view?usp=sharing">capítulo</a> del curso "Crear aplicación Web" vemos como instalar Pest y configurarlo para realizar nuestros primeros test.</p>
</div>
<h3 id="cobertura-de-codigo">Cobertura de código<a class="headerlink" href="#cobertura-de-codigo" title="Permanent link">&para;</a></h3>
<p>La cobertura de pruebas indica la cantidad de código que las pruebas cubren, siendo recomendable que cubran entre el 95 y el 100%.</p>
<p>Una de las métricas asociadas a los informes de cobertura es el CRAP (Análisis y Predicciones sobre el Riesgo en Cambios), el cual mide la cantidad de esfuerzo, dolor y tiempo requerido para mantener una porción de código. Esta métrica debe mantenerse con un valor inferior a 5.</p>
<div class="admonition warning">
<p class="admonition-title">Requisito xdebug</p>
<p>Aunque ya viene instalado dentro de PHPUnit, para que funcione la cobertura del código, es necesario que el código PHP se ejecute con XDEBUG, y e indicarle a Apache que así es (colocando en el archivo de configuración <code>php.ini</code>la directiva <code>xdebug.mode=coverage</code>).</p>
</div>
<p>Añadimos en <code>composer.json</code> un nuevo <em>script</em>:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1"></a><a href="#__codelineno-46-1"><span class="linenos" data-linenos="1 "></span></a><span class="nt">&quot;coverage&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;phpunit --coverage-html coverage --coverage-filter app tests&quot;</span>
</span></code></pre></div>
<p>Y posteriormente ejecutamos</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1"></a><a href="#__codelineno-47-1"><span class="linenos" data-linenos="1 "></span></a>composer<span class="w"> </span>coverage
</span></code></pre></div>
<p>Por ejemplo, si accedemos a la clase <code>CintaVideo</code> con la prueba que habíamos realizado anteriormente, podemos observar la cobertura que tiene al 100% y que su CRAP es 2.</p>
<figure style="align: center;">
    <a class="glightbox" href="imagenes/05/coverage.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img src="imagenes/05/coverage.png"></a>
    <figcaption>Informe de cobertura de la clase CintaVideo</figcaption>
</figure>

<h2 id="referencias">Referencias<a class="headerlink" href="#referencias" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://desarrolloweb.com/manuales/tutorial-composer.html">Tutorial de Composer</a></li>
<li><a href="https://zetcode.com/php/monolog/">PHP Monolog</a></li>
<li><a href="https://medium.com/@emilianozublena/unit-testing-con-phpunit-parte-1-148c6d73e822">Unit Testing con PHPUnit — Parte 1</a>, de Emiliano Zublena.</li>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2024-2025 Jesús García - Licencia CC BY-NC-SA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/aitormedrano" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.2 4.2 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.52 8.52 0 0 1-5.33 1.84q-.51 0-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<a.medrano@edu.gva.es>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 12.13c-.15.01-.29.06-.39.17l-1 1 2.05 2 1-1c.22-.21.22-.56 0-.77l-1.24-1.23a.56.56 0 0 0-.38-.17m-2 1.75L13 19.94V22h2.06l6.06-6.07M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h7v-.89l8.24-8.22c.47-.49 1.12-.76 1.8-.76.34 0 .68.06 1 .19V6c0-1.12-.92-2-2.04-2m0 4-8 5-8-5V6l8 5 8-5"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": ["header.autohide", "toc.integrate", "content.tabs.link", "content.code.copy", "content.code.select", "navigation.top", "content.code.annotate"], "search": "assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>