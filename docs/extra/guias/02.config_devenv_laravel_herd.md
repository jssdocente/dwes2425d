# Configuraci贸n entorno desarrollo PHP con Laravel Herd

Laravel Herd es una nueva opci贸n disponible (2024) para facilitarnos la configuraci贸n del entorno de desarrollo para PHP.

El nivel de sofisticaci贸n de la configuraci贸n grande, utilizando Docker o otras herramientas m谩s avanzadas, pero a un usuario principiante esto puede ser muy intimidante y dif铆cil de configurar.

Las herramientas existentes son:

- XAMP: Antigua, sin soporte y sin actualizaciones hace tiempo.
- DevilBox (Docker). Funciona sobre Docker y est谩 tambi茅n obsoleta.
- Laragon:  Alternativa muy buena sobre Windows, mejora mucho a XAMP.
- Valet (para MacOS)

**驴Qu茅 se necesita para desarrollar PHP?**

- PHP. Instalar el interprete de PHP (hay diferentes versiones).
- Servidor Web. (Apache, Nginx, ...) no es necesario al principio, pero para desarrollos m谩s grandes es necesario.
- Base de datos. (MySQL, MariaDB, SQLite, ...)
- Otros servicios: Mail, Redis, ...

Aparte de estos otras caracter铆sticas son deseables:

- Depuraci贸n e integraci贸n con los principales IDEs (PHPStorm, VSCode).
- Gesti贸n autom谩ticas de Sitios. (facilitad administraci贸n de m煤ltiples proyectos).
- Acceso con DNS. (nombre de dominio local), por ejemplo myproyecto.test. 
- Visualizaci贸n de Logs, monitorizaci贸n de peticiones, volcados con dump...

### Recursos

- [Laravel Herd](https://herd.laravel.com/windows)
- [XDebug](xdebug.org)
- [Depurando en PHPStrom 2024 con Laravel Herd sin ser PRO](https://blog.stackademic.com/debugging-in-phpstorm-2024-with-laravel-herd-you-dont-need-pro-e40ce131de21)


### Laravel Herd

[Laravel Herd](https://herd.laravel.com/windows)

Como su nombre indica `Laravel` ya nos dice para qu茅 est谩 principalmente pensado, y efectivamente, para trabajar con el framework Laravel, pero no por eso no lo podemos utilizar fuera de este framework, y en proyectos menores.

Herd es una herramienta que nos permite configurar un entorno de desarrollo para PHP, con las caracter铆sticas que hemos mencionado anteriormente.

Laravel Herd ofrece un interfaz muy completo, con una interfaz gr谩fica que nos permite gestionar los proyectos, las versiones de PHP, los servicios, etc. Todo desde un 煤nico lugar. Adem谩s tambi茅n ofrece un `sercicio` y una `CLI` para gestionar los proyectos. 

Sus principales caracter铆sticas son:

- **Configuraci贸n sencilla**: Se instala con un solo comando.
- **Gesti贸n de m煤ltiples proyectos**: Podemos tener varios proyectos y cambiar entre ellos.
- **Gesti贸n versiones de PHP**: Descarga, actualiza y cambia de versi贸n de PHP. Elige qu茅 versi贸n de PHP utilizar para cada proyecto.
- **Control de otros servicios con facilidad**: MySQL, Redis, ... desde su consola se puede gestionar la mayoria de los servios que incluye, y otros que podemos incorporar.
- **Ficheros de Log**: Visualizaci贸n de logs de los servicios.
- **Integraci贸n muy sencilla con XDebug**: Depuraci贸n con XDebug de forma muy sencilla.

Aunque es una herramienta de Pago, ofrece una capa gratuita muy importante y suficiente para utilizarla en proyectos peque帽os.


#### Instalaci贸n

Laravel Herd est谩 disponible para MacOS y Windows.

La instalaci贸n depende del SO, y se puede encontrar en la p谩gina oficial de Laravel Herd.

- [Instalaci贸n para Windows](https://herd.laravel.com/docs/windows/1/getting-started/installation)
- [Instalaci贸n para MacOS](https://herd.laravel.com/docs/1/getting-started/installation)


### Uso b谩sico

#### Sitios

Herd utiliza el concepto de rutas _aparcadas_ y directorios _vinculados_ para ofrecer servicios a los sitios. Puede acceder a todos los sitios en una ruta aparcada a trav茅s de `http://<directory-name>.test`. De forma predeterminada, Herd aparcar谩 autom谩ticamente el `%USERPROFILE%\Herd`directorio por usted. Cualquier aplicaci贸n PHP en este directorio est谩 disponible autom谩ticamente a trav茅s de su `.test`dominio. Si tiene otras ubicaciones para sus proyectos, puede agregarlas como rutas aparcadas en la configuraci贸n general o vincular proyectos individuales como un directorio vinculado.

Un sitio se puede crear bien a trav茅s de comandos, o m谩s f谩cil a trav茅s de su interfaz, donde paso a paso le indicamos:

- Nombre del proyecto.
- Directorio donde se encuentra.
- Versi贸n de PHP.

Y con esto nos crea un `sitio` que podemos acceder a trav茅s de un dominio local. `http://<nombre-proyecto>.test`.

#### Versiones de PHP

Desde su interfaz tambi茅n podemos revisar, instalar/actualizar, activar/desactivar, y eliminar las diferentes versiones de PHP.

Adem谩s de poder indicar a nivel de proyecto qu茅 versi贸n de PHP utilizar.

Todo en uno, y muy f谩cil de trabajar.

#### Control Servicios

Desde la interfaz, tambi茅nn podemos parar, iniciar y reiniciar los servicios, todos a la vez o de forma individual.


### Debug con XDebug en PHPStorm

Esto es una de las principales ventajas que nos permite y facilita Laravel Herd, pero es una opci贸n de pago. Pero se puede solucionar con algo de trabajo.

Puntos clave:

- Configurar XDebug en la versi贸n de PHP espec铆fica.
- Indicar a PHP qu茅 interprete utilizar y que conincida con el proyecto a depurar.
- Configurar PHPStorm para que escuche las peticiones de XDebug.
- Configurar el sitio en Laravel Herd con https (punto opcional pero importante).


En la siguiente [gu铆a](https://blog.stackademic.com/debugging-in-phpstorm-2024-with-laravel-herd-you-dont-need-pro-e40ce131de21), nos indica paso a paso, pero aqu铆 lo veremos de forma resumida.

#### Instalaci贸n de XDebug sin Laravel Herd

XDebug es un binario que se instala en la versi贸n de PHP que estamos utilizando. Laravel Herd ya lo tiene instalado, pero si no lo tuviera, se puede instalar con el siguiente comando:

```bash
herd php:install xdebug
```

En caso de que lo queramos instalar de forma independiente directamente descargandolo de su Web, depender谩 de la SO que estemos utilizando.

**Windows**

Si es Windows, es sencillo, descargamos el binario y lo copiamos en la carpeta de extensiones de PHP. La ubicaci贸n de esta carpeta depender谩 de la versi贸n de PHP que estemos utilizando.

Para saber qu茅 versi贸n de XDebug hay que descargar, podemos utilizar la herramienta que nos ofrece la p谩gina de XDebug, que nos indica qu茅 versi贸n de XDebug necesitamos para nuestra versi贸n de PHP.

1. Abrir la p谩gina de [XDebug](https://xdebug.org/wizard)
2. Copiar el contenido de `phpinfo()` en la p谩gina, o a trav茅s del comando `php -i` en la consola.
3. Pegar el contenido en la p谩gina y nos indicar谩 qu茅 versi贸n de XDebug necesitamos.

**Linux**

En Linux, la instalaci贸n es un poco m谩s complicada, pero no mucho. Se puede instalar a trav茅s de `pecl` o `apt-get` seg煤n la distribuci贸n que estemos utilizando.

```bash
sudo apt-get install php-xdebug
```

Para indicar una versi贸n espec铆fica, se puede indicar con el nombre del paquete.

```bash
sudo apt-get install php-xdebug-8.3
```

#### Configuraci贸n XDebug

XDebug es un binario, que es necesario descargar, pero que Laravel Herd ya lo tiene instalado por nosotros. 

**Configurar php.ini**

`php.ini` es el fichero donde se almacena la configuraci贸n de PHP, y tiene muchas, muchas.
Pero para nuestro caso, lo 煤nico que necesitamos es configurar las siguientes:

>  Consultala [documentaci贸n de XDebug](https://xdebug.org/docs/step_debug), referente a depuraci贸n paso a paso

Opciones:

- **zend_extension**= Ruta al binario de XDebug, en Herd est谩 ubicado en la siguiente carpeta."C:\Program Files\Herd\resources\app.asar.unpacked\resources\bin\xdebug\xdebug-8.3.dll"
<br>Cambiar a la versi贸n de php espec铆fica seg煤n el ini.

- **xdebug.mode**: debug,develop. Indica el modo de depuraci贸n. Debug es paso a paso.
- **xdebug.client_host**=127.0.0.1 (Direcci贸n de IP del IDE)
- **xdebug.client_port**=9003  (Puerto donde escucha el IDE)

Estas son opciones, pero importantes:

- **xdebug.idekey** = PHPSTORM  (Indicando el IDE que estamos utilizando).
- **xdebug.start_with_request**=yes (Indica que se inicie con cada petici贸n), si no se indica esto, se debe indicar en la URL `XDEBUG_SESSION_START=PHPSTORM`. Y esto es poco pr谩ctico. Existe un plugin para Chrome y Firefox que nos facilita esto, pero que no suele funcionar muy bien en las 煤ltimas versiones.<br> 
  MEjor soluci贸n. Activar esta opci贸n (yes), y controlar desde PHPStorm, si escuchamos las peticiones o no. Si la activamos cada petici贸n se iniciar谩 una sesi贸n de depuraci贸n, si no lo vamos a requerir o queremos desactivarlo, lo ponemos a `no`.
- **xdebug.start_upon_error**=yes  Si queremos que se activo o no sobre errores

>  Una vez aplicado este cambio, es necesario reiniciar PHP. Esto lo podemos hacer desde la consola de Laravel Herd.

Si no funciona, o no se activa, podemos indicar que xdebug nos muestra un log, indicando si se activa o no.

- xdebug.log = "~\.config\herd\Log\xdebug.log"  (La ruta puede ser cualquier y el nombre del fichero tambi茅n.)


**驴C贸mo funciona XDebug?**

XDebug debe comunicarse con el IDE en cuesti贸n, y lo hace a trav茅s de una IP y un puerto. Si estamos en la misma red, y mismo ordenador, es m谩s f谩cil.

Una vez hemos configurado todo, nos vamos a PHPStorm.


**Configurar PHPStorm**

Esta configuraci贸n es por proyecto, y se almacena dentro de la carpeta `.idea` que PHPStorm guarda en la carpeta del proyecto.

Puntos importantes:

- En Settins, PHP, indicar el Interprete de PHP. En el punto [Configuring PHPStorm](https://blog.stackademic.com/debugging-in-phpstorm-2024-with-laravel-herd-you-dont-need-pro-e40ce131de21) indica c贸mo hacerlo.
- Indicar `Start Listening for PHP Debug Connections`. Esto est谩 disponible en el menu `Run` y tambi茅n visible en la parte superior.
- Configurar el puerto, y las opciones de configuraci贸n.
  - Si parar en la primera l铆nea o no.
  - Si escuchar conexiones externas o no.
  

En nuestro caso, y con la configuraci贸n de Laravel Herd, que se basa en un Ngix, necesitamos indicar lo siguiente en Settings\PHP\Debug:

- Debug port: 9003 (configurado en pho.ini)
- (Quitar) Force break at first line when no path mapping specified. (Si ya funciona quitar, si no, dejarlo).
- (Quitar) Force breat at first line when a script is outside the proyecto (Muy importante, para no depurar script fuera del proyecto)

Tambi茅n quitar `Break at first line in PHP scripts` para que se detenga en los `breakpoints` que indiquemos. (Si no, se parar谩 en la primera l铆nea de nuestro Script.)<br>
Configurar esto seg煤n necesidad.






### Recursos

**Abrir PHPStorm desde Laravel Herd**

Para que funcione es necesario configurar un protocolo, es decir, que Windows conozca que un enlace prefijado con un protocolo est谩 enlzada a un programa espec铆fico.

Para ello, seguir esta gu铆a.

- [Abrir PHPStorm desde Laravel Herd](https://github.com/aik099/PhpStormProtocol)

**Rutas a Laravel Herd**

- ProgramFiles: C:\Program Files\Herd
- xUSuario: ~\Herd  (General)
- xUSuario avanzada: ~\.config\herd

En estas carpetas, estan las configuraciones de Herd, en la configuraci贸n avanzada podemos tocar y revisar configuraciones m谩s avanzadas que nos permiten configurar y revisar errores.