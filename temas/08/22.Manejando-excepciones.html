
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://jssdocente.github.io/dwes2425/temas/08/22.Manejando-excepciones.html">
      
      
        <link rel="prev" href="21.flash-messages.html">
      
      
        <link rel="next" href="../../extra/ArquitecturasWebExtendido.html">
      
      
      <link rel="icon" href="../../imagenes/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>22. Control y Gestión de excepciones - 2º DAW - Desarrollo Web en Entorno Servidor - Curso 24/25</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a40c8224.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      

  
  
  
  
  <style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 13h-4v4h-2v-4H7v-2h4V7h2v4h4m-5-9A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2"/></svg>');}</style>


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="Teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#22-manejando-excepciones" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../../index.html" title="2º DAW - Desarrollo Web en Entorno Servidor - Curso 24/25" class="md-header__button md-logo" aria-label="2º DAW - Desarrollo Web en Entorno Servidor - Curso 24/25" data-md-component="logo">
      
  <img src="../../imagenes/logofp.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            2º DAW - Desarrollo Web en Entorno Servidor - Curso 24/25
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              22. Control y Gestión de excepciones
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="Teal"  aria-label="Cambiar a modo noche"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo noche" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="light-blue" data-md-color-accent="Teal"  aria-label="Cambiar a modo día"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo día" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="2º DAW - Desarrollo Web en Entorno Servidor - Curso 24/25" class="md-nav__button md-logo" aria-label="2º DAW - Desarrollo Web en Entorno Servidor - Curso 24/25" data-md-component="logo">
      
  <img src="../../imagenes/logofp.png" alt="logo">

    </a>
    2º DAW - Desarrollo Web en Entorno Servidor - Curso 24/25
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inicio
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01arquitecturas.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.- Arquitecturas Web
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    2.- El lenguaje PHP
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            2.- El lenguaje PHP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introducción
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02.1_php_basico.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PHP Básico
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02.2_php_avanzado.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PHP Avanzado
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02.3_php_versiones_evolucion.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PHP evolución
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03phpoo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. PHP Orientado a Objetos
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04web.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.- Programación Web
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05herramientas.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.- Herramientas Web
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../06accesoDatos.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.- Acceso a Datos
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    7.- Frameworks PHP - Laravel
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            7.- Frameworks PHP - Laravel
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introducción
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07/01.instalar-laravel.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Instalar Laravel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07/02.configurar-tailwind.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Configurar Tailwind
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07/03.layouts-con-blade.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Layouts con Blade
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07/04.primer-componente.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Primer componente
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07/05.estilando-nav-link.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. Estilando componente
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07/06.pasar-datos-vista-y-rutas.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Pasar datos a las vistas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07/07.autoloading-namespaces-y-models.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7. Autloading y namespaces
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07/08.intro-migraciones.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8. Introducción a las migraciones
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07/09.intro-eloquent.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9. Introducción a Eloquent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07/10.eloquent-factories.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10. Eloquent: Factorias
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07/11.eloquent-relations-basic.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    11. Eloquent: relaciones básicas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07/12.eloquent-relations-many-to-many.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    12. Eloquent: relación many-to-many
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07/13.eloquent-relations-has-many-throught.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    13. Eloquent: relación many-has-many-throught
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" checked>
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    8.- Frameworks PHP - Laravel avanzado
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            8.- Frameworks PHP - Laravel avanzado
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introducción
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="14.database-seeders.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    14. Database Seeders
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="15.forms-csrf.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    15. Formularios con Laravel y CRSF
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="16.forms-always-validate.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    16. Validación
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="17.forms-edit-update-delete.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    17. Formularios CRUD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="18.mejorar-rutas.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    18. Mejorando las rutas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="19.create-login-register-system.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    19. Autenticación: crear sistema
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="20.proteger-rutas-middleware.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    20. Autorización: proteger rutas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="21.flash-messages.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    21. Informando al usuario
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    22. Control y Gestión de excepciones
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="22.Manejando-excepciones.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    22. Control y Gestión de excepciones
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#recursos" class="md-nav__link">
    <span class="md-ellipsis">
      Recursos
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracion" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tipos-de-errores" class="md-nav__link">
    <span class="md-ellipsis">
      Tipos de errores
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manejando-excepciones" class="md-nav__link">
    <span class="md-ellipsis">
      Manejando excepciones
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Manejando excepciones">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-capturar-excepciones" class="md-nav__link">
    <span class="md-ellipsis">
      1. Capturar excepciones
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#informacion-de-la-excepcion" class="md-nav__link">
    <span class="md-ellipsis">
      Información de la excepción
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-devolver-un-codigo-de-estado-http" class="md-nav__link">
    <span class="md-ellipsis">
      2. Devolver un código de estado HTTP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-renderizar-la-excepcion-o-mostrar-un-mensaje" class="md-nav__link">
    <span class="md-ellipsis">
      3. Renderizar la excepción o mostrar un mensaje
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-todas-las-excepciones-deben-ser-guardadas-en-un-log" class="md-nav__link">
    <span class="md-ellipsis">
      4. Todas las excepciones deben ser guardadas en un log
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementando-excepciones-de-forma-correcta" class="md-nav__link">
    <span class="md-ellipsis">
      Implementando excepciones de forma correcta
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementando excepciones de forma correcta">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#excepciones-vs-errores" class="md-nav__link">
    <span class="md-ellipsis">
      Excepciones vs Errores
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crear-excepciones-personalizadas" class="md-nav__link">
    <span class="md-ellipsis">
      Crear excepciones personalizadas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crear-codigo-numericos-para-las-excepciones" class="md-nav__link">
    <span class="md-ellipsis">
      Crear código numéricos para las excepciones
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#descripcion-de-la-excepcion" class="md-nav__link">
    <span class="md-ellipsis">
      Descripción de la excepción
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#excepciones-personalizadas" class="md-nav__link">
    <span class="md-ellipsis">
      Excepciones personalizadas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agregar-excepcion-para-el-modulo-de-notas" class="md-nav__link">
    <span class="md-ellipsis">
      Agregar Excepción para el módulo de Notas
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manejador-de-excepciones-global" class="md-nav__link">
    <span class="md-ellipsis">
      Manejador de excepciones global
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Manejador de excepciones global">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#personalizar-paginas-de-error" class="md-nav__link">
    <span class="md-ellipsis">
      Personalizar páginas de error.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusión
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Anexo
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Anexo
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extra/ArquitecturasWebExtendido.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Anexo I. Arquitecturas Web
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Guias
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Guias
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extra/guias/02.config_devenv_laravel_herd.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuración entorno desarrollo PHP con Laravel Herd
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="22-manejando-excepciones">22. Manejando Excepciones<a class="headerlink" href="#22-manejando-excepciones" title="Permanent link">&para;</a></h1>
<p>En esta 23ª lección, vamos a ver cómo manejar las excepciones en Laravel. Las excepciones son errores que se producen durante la ejecución de un programa, y que pueden ser capturados y tratados para evitar que el programa se detenga.</p>
<h3 id="recursos">Recursos<a class="headerlink" href="#recursos" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://laravel.com/docs/11.x/errors">Manear errores en Laravel</a></li>
<li><a href="https://laravel.com/docs/11.x/localization">Soporte multilenguaje en Laravel documentación</a></li>
<li><a href="https://youtu.be/4cFtky9GlbU?list=PLpKWS6gp0jd8wsN5wSDwEFcvkD6nQ66yM">Video: soporte multi-lenguaje</a></li>
</ul>
<h2 id="configuracion">Configuración<a class="headerlink" href="#configuracion" title="Permanent link">&para;</a></h2>
<p>La primera configuración que debemos tener en cuenta, es la forma en la que los errores son mostrados al usuario y qué información se muestra al mismo.
Por defecto esta opción se configura en el archivo <code>config\app.php</code> en la clave <code>APP_DEBUG</code>. Si está en <code>true</code>, se mostrará toda la información del error, si está en <code>false</code>, se mostrará un error genérico.</p>
<p>Toda la información de config\app.php es obtenida del fichero de configuración <code>.env</code>. Por lo que si queremos cambiar esta opción, debemos hacerlo en el fichero <code>.env</code>.</p>
<p>Si estamos en producción, los errores se deben mostrsr en un log, y no al usuario. El usuario debería ver una página de error adecuada, y no la información del error.</p>
<h2 id="tipos-de-errores">Tipos de errores<a class="headerlink" href="#tipos-de-errores" title="Permanent link">&para;</a></h2>
<p>Los errores que entiende un navegador y concretamente el protocolo HTTP son los <code>status code</code>. Los más comunes son:</p>
<ul>
<li>401 Unauthorized: No autorizado.</li>
<li>403 Forbidden: No se tiene permiso para acceder a la página.</li>
<li>404 Not Found: No se ha encontrado la página.</li>
<li>500 Internal Server Error: Error interno del servidor.</li>
<li>503 Service Unavailable: Servicio no disponible.</li>
<li>504 Gateway Timeout: Tiempo de espera agotado.</li>
</ul>
<p>Para estos errores, lo más adecuado es presentar una página de error personalizada, y no mostrar el error como tal al usuario. 
Pero además, tendremos que guardar esta información del error en un log, para poder analizarlo y consultarlo más adelante.</p>
<h2 id="manejando-excepciones">Manejando excepciones<a class="headerlink" href="#manejando-excepciones" title="Permanent link">&para;</a></h2>
<p>Las excepciones son errores que se producen durante la ejecución de un programa, y que pueden ser capturados y tratados para evitar que el programa se detenga. 
Todas estas excepciones tienen que tener una traducción a código de estado <code>HTTP</code> para que el navegador pueda entenderlo, 
pero algunos errores se deben presentar al usuario en forma de página, y otros simplemente con un mensaje. Es un tema que tendremos que decidir en función del error.</p>
<p>Los puntos clave para manejar excepciones son:</p>
<ol>
<li>Siempre capturar la excepción en algún punto de la aplicación, es neceario tener un capturar de excepciones global.</li>
<li>Devolver un código de estado <code>HTTP</code> adecuado al tipo de excepción (si es neceario, depende del tipo de respuesta, es una página de error, o un mensaje).</li>
<li>Conocer si la excepción se debe renderizar en una página o simplemente mostrar un mensaje.</li>
<li>Todas las expceciones o al menos las más importantes, deben ser guardadas en un log.</li>
</ol>
<p>Las excepciones se pueden capturar directamente en el momento en que se producen o dejar que continuen hacia arriba en la pila de llamadas hasta que se capturen en un punto más alto.</p>
<p>Vamos a tratar cada uno de estos puntos por separado.</p>
<h3 id="1-capturar-excepciones">1. Capturar excepciones<a class="headerlink" href="#1-capturar-excepciones" title="Permanent link">&para;</a></h3>
<p>Para capturar una excepción en Laravel, podemos hacerlo de dos formas:</p>
<ul>
<li>Capturar la excepción en el momento en que se produce.</li>
<li>Capturar la excepción en un punto más alto de la pila de llamadas, en un manejador de excepciones global.</li>
</ul>
<p>Para capturar la excepción en el momento en que se produce, simplemente tenemos que envolver el código que puede lanzar la excepción en un bloque <code>try-catch</code>.</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><a href="#__codelineno-0-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">try</span> <span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><a href="#__codelineno-0-2"><span class="linenos" data-linenos="2 "></span></a>    <span class="c1">// Código que puede lanzar una excepción</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><a href="#__codelineno-0-3"><span class="linenos" data-linenos="3 "></span></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><a href="#__codelineno-0-4"><span class="linenos" data-linenos="4 "></span></a><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><a href="#__codelineno-0-5"><span class="linenos" data-linenos="5 "></span></a>    <span class="c1">// Código que se ejecuta si se lanza una excepción</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><a href="#__codelineno-0-6"><span class="linenos" data-linenos="6 "></span></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><a href="#__codelineno-0-7"><span class="linenos" data-linenos="7 "></span></a><span class="p">}</span>
</span></code></pre></div>
<p>Dentro de la cláusula <code>catch</code>, podemos hacer lo que queramos con la excepción, como mostrar un mensaje de error, guardar la excepción en un log, o lanzar otra excepción.
También dentro del bloque <code>catch</code>, tendremos que saber si lanzar otra excepción de otro tipo más genérica, y esta fluya hasta un manejador de excepciones global,
y renderize una página de error, o redireccionar a otra página directamente desde la cláusula <code>catch</code>. Algo que prácticamente siempre se debe hacer es enviar la excepción a un log,
y para ello se deberá llamar a algún método de la excepción que nos devuelva la información de la excepción.</p>
<p><strong>Registrar/Reportar una excepción en el Log, sin mostrar página de error</strong> </p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><a href="#__codelineno-1-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">try</span> <span class="p">{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a><a href="#__codelineno-1-2"><span class="linenos" data-linenos=" 2 "></span></a>    <span class="c1">// Código que puede lanzar una excepción</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a><a href="#__codelineno-1-3"><span class="linenos" data-linenos=" 3 "></span></a>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a><a href="#__codelineno-1-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5"></a><a href="#__codelineno-1-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="c1">// Guardar la excepción en un log</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6"></a><a href="#__codelineno-1-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="nx">report</span><span class="p">(</span><span class="nv">$e</span><span class="p">);</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7"></a><a href="#__codelineno-1-7"><span class="linenos" data-linenos=" 7 "></span></a>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8"></a><a href="#__codelineno-1-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="c1">//Vuelve a la página anterior, mostrando un error</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9"></a><a href="#__codelineno-1-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="nx">back</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;Ha ocurrido un error&#39;</span><span class="p">);</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10"></a><a href="#__codelineno-1-10"><span class="linenos" data-linenos="10 "></span></a>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11"></a><a href="#__codelineno-1-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12"></a><a href="#__codelineno-1-12"><span class="linenos" data-linenos="12 "></span></a>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13"></a><a href="#__codelineno-1-13"><span class="linenos" data-linenos="13 "></span></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Capturar excepciones en un manejador de excepciones global</strong></p>
<p>Para capturar excepciones no capturadas antes, en un manejador de excepciones global, en la versión 11 de Laravel, tenemos que hacerlo en el fichero <code>bootstrap/app.php</code>, dentro del método <code>withExceptions()</code>.</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a><a href="#__codelineno-2-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">return</span> <span class="nx">Application</span><span class="o">::</span><span class="na">configure</span><span class="p">(</span><span class="nx">basePath</span><span class="o">:</span> <span class="nb">dirname</span><span class="p">(</span><span class="no">__DIR__</span><span class="p">))</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a><a href="#__codelineno-2-2"><span class="linenos" data-linenos=" 2 "></span></a>    <span class="o">-&gt;</span><span class="na">withRouting</span><span class="p">(</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a><a href="#__codelineno-2-3"><span class="linenos" data-linenos=" 3 "></span></a>        <span class="nx">web</span><span class="o">:</span> <span class="no">__DIR__</span><span class="o">.</span><span class="s1">&#39;/../routes/web.php&#39;</span><span class="p">,</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4"></a><a href="#__codelineno-2-4"><span class="linenos" data-linenos=" 4 "></span></a>        <span class="nx">commands</span><span class="o">:</span> <span class="no">__DIR__</span><span class="o">.</span><span class="s1">&#39;/../routes/console.php&#39;</span><span class="p">,</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5"></a><a href="#__codelineno-2-5"><span class="linenos" data-linenos=" 5 "></span></a>        <span class="nx">health</span><span class="o">:</span> <span class="s1">&#39;/up&#39;</span><span class="p">,</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6"></a><a href="#__codelineno-2-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="p">)</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7"></a><a href="#__codelineno-2-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="o">-&gt;</span><span class="na">withMiddleware</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Middleware</span> <span class="nv">$middleware</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8"></a><a href="#__codelineno-2-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="c1">//</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9"></a><a href="#__codelineno-2-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="p">})</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10"></a><a href="#__codelineno-2-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="o">-&gt;</span><span class="na">withExceptions</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Exceptions</span> <span class="nv">$exceptions</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11"></a><a href="#__codelineno-2-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="c1">//Manejador de excepciones global</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12"></a><a href="#__codelineno-2-12"><span class="linenos" data-linenos="12 "></span></a>         <span class="nv">$exceptions</span><span class="o">-&gt;</span><span class="na">report</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13"></a><a href="#__codelineno-2-13"><span class="linenos" data-linenos="13 "></span></a>            <span class="c1">// ...</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14"></a><a href="#__codelineno-2-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="p">});</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15"></a><a href="#__codelineno-2-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="p">})</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>
</span></code></pre></div>
<h3 id="informacion-de-la-excepcion">Información de la excepción<a class="headerlink" href="#informacion-de-la-excepcion" title="Permanent link">&para;</a></h3>
<p>Todas las excepciones en Laravel parten de una excepción base <code>Exception</code>, y esta clase tiene un método <code>report()</code> que se llama cuando se lanza la excepción. Este método se encarga de guardar la excepción en un log. La información almacenada en el log es la siguiente:</p>
<ul>
<li>Fecha y hora en que se produjo la excepción.</li>
<li>Mensaje de error.</li>
<li>Archivo y línea de código donde se produjo la excepción.</li>
<li>Pila de llamadas, que es la lista de funciones que se han llamado hasta llegar al punto donde se produjo la excepción.</li>
</ul>
<p><strong>Información de contexto</strong></p>
<p>Pero qué pasa si queremos guardar más información en el log, como información de contexto o información de la petición que ha lanzado la excepción. Para ello, podemos utilizar el método <code>context()</code> de la excepción, y implementar este método en nuestra excepción personalizada. También esto es posible hacerlo en el manejador de excepciones global, y añadir la información de contexto en todas las excepciones.</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a><a href="#__codelineno-3-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">class</span> <span class="nc">InvalidOrderException</span> <span class="k">extends</span> <span class="nx">Exception</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2"></a><a href="#__codelineno-3-2"><span class="linenos" data-linenos="2 "></span></a><span class="p">{</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3"></a><a href="#__codelineno-3-3"><span class="linenos" data-linenos="3 "></span></a>    <span class="c1">// ...</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4"></a><a href="#__codelineno-3-4"><span class="linenos" data-linenos="4 "></span></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">context</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5"></a><a href="#__codelineno-3-5"><span class="linenos" data-linenos="5 "></span></a>    <span class="p">{</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6"></a><a href="#__codelineno-3-6"><span class="linenos" data-linenos="6 "></span></a>        <span class="c1">//Agrega el id de la orden a la información de la excepción</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7"></a><a href="#__codelineno-3-7"><span class="linenos" data-linenos="7 "></span></a>        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;order_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">orderId</span><span class="p">];</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8"></a><a href="#__codelineno-3-8"><span class="linenos" data-linenos="8 "></span></a>    <span class="p">}</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9"></a><a href="#__codelineno-3-9"><span class="linenos" data-linenos="9 "></span></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="2-devolver-un-codigo-de-estado-http">2. Devolver un código de estado HTTP<a class="headerlink" href="#2-devolver-un-codigo-de-estado-http" title="Permanent link">&para;</a></h3>
<p>Cualquier excepción que ocurre del lado del servidor, será un error 500 (Internal Server Error) si no se captura. Pero podemos devolver un código de estado <code>HTTP</code> adecuado al tipo de excepción, y si esta excepción se debe renderizar en una página de error, o simplemente mostrar un mensaje.</p>
<p>Si la excepción se debe renderizar en una página de error, la mejor forma es utilizar el método <code>abort()</code> de Laravel, donde le indicamos el código de estado <code>HTTP</code>y Laravel automáticamente renderiza una página de error adecuada.</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a><a href="#__codelineno-4-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">class</span> <span class="nc">InternalException</span> <span class="k">extends</span> <span class="nx">Exception</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2"></a><a href="#__codelineno-4-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="p">{</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3"></a><a href="#__codelineno-4-3"><span class="linenos" data-linenos=" 3 "></span></a>    <span class="c1">// ...</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4"></a><a href="#__codelineno-4-4"><span class="linenos" data-linenos=" 4 "></span></a>  <span class="k">public</span> <span class="k">function</span> <span class="nf">render</span><span class="p">(</span><span class="nv">$request</span><span class="p">)</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5"></a><a href="#__codelineno-4-5"><span class="linenos" data-linenos=" 5 "></span></a>  <span class="p">{</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6"></a><a href="#__codelineno-4-6"><span class="linenos" data-linenos=" 6 "></span></a>      <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isNeedRenderToPage</span><span class="p">())</span> <span class="p">{</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7"></a><a href="#__codelineno-4-7"><span class="linenos" data-linenos=" 7 "></span></a>          <span class="nx">abort</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">(),</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">());</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8"></a><a href="#__codelineno-4-8"><span class="linenos" data-linenos=" 8 "></span></a>          <span class="k">return</span><span class="p">;</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9"></a><a href="#__codelineno-4-9"><span class="linenos" data-linenos=" 9 "></span></a>      <span class="p">}</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10"></a><a href="#__codelineno-4-10"><span class="linenos" data-linenos="10 "></span></a>  <span class="p">}</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11"></a><a href="#__codelineno-4-11"><span class="linenos" data-linenos="11 "></span></a><span class="p">}</span>
</span></code></pre></div>
<p>o si no se debe renderizar en una página, simplemente devolvemos un código de estado <code>HTTP</code> y un mensaje de error (principalmente para peticiones <code>API</code>).</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a><a href="#__codelineno-5-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">class</span> <span class="nc">InternalException</span> <span class="k">extends</span> <span class="nx">Exception</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2"></a><a href="#__codelineno-5-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="p">{</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3"></a><a href="#__codelineno-5-3"><span class="linenos" data-linenos=" 3 "></span></a>    <span class="c1">// ...</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4"></a><a href="#__codelineno-5-4"><span class="linenos" data-linenos=" 4 "></span></a>  <span class="k">public</span> <span class="k">function</span> <span class="nf">render</span><span class="p">(</span><span class="nv">$request</span><span class="p">)</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5"></a><a href="#__codelineno-5-5"><span class="linenos" data-linenos=" 5 "></span></a>  <span class="p">{</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6"></a><a href="#__codelineno-5-6"><span class="linenos" data-linenos=" 6 "></span></a>      <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isNeedRenderToPage</span><span class="p">())</span> <span class="p">{</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7"></a><a href="#__codelineno-5-7"><span class="linenos" data-linenos=" 7 "></span></a>          <span class="nx">abort</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">(),</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">());</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8"></a><a href="#__codelineno-5-8"><span class="linenos" data-linenos=" 8 "></span></a>          <span class="k">return</span><span class="p">;</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9"></a><a href="#__codelineno-5-9"><span class="linenos" data-linenos=" 9 "></span></a>      <span class="p">}</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10"></a><a href="#__codelineno-5-10"><span class="linenos" data-linenos="10 "></span></a>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11"></a><a href="#__codelineno-5-11"><span class="linenos" data-linenos="11 "></span></a>      <span class="c1">//Devuelve una repuesta JSON con el mensaje de error, si la petición es una API</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12"></a><a href="#__codelineno-5-12"><span class="linenos" data-linenos="12 "></span></a>      <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">is</span><span class="p">(</span><span class="s1">&#39;api/*&#39;</span><span class="p">))</span> <span class="p">{</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13"></a><a href="#__codelineno-5-13"><span class="linenos" data-linenos="13 "></span></a>            <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14"></a><a href="#__codelineno-5-14"><span class="linenos" data-linenos="14 "></span></a>                <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Record not found.&#39;</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15"></a><a href="#__codelineno-5-15"><span class="linenos" data-linenos="15 "></span></a>            <span class="p">],</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">());</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16"></a><a href="#__codelineno-5-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="p">}</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17"></a><a href="#__codelineno-5-17"><span class="linenos" data-linenos="17 "></span></a>  <span class="p">}</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18"></a><a href="#__codelineno-5-18"><span class="linenos" data-linenos="18 "></span></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="3-renderizar-la-excepcion-o-mostrar-un-mensaje">3. Renderizar la excepción o mostrar un mensaje<a class="headerlink" href="#3-renderizar-la-excepcion-o-mostrar-un-mensaje" title="Permanent link">&para;</a></h3>
<p>En función del tipo de excepción, se debe renderizar una página de error, o simplemente mostrar un mensaje, o ambas cosas, una página con un mensaje personalizado. Pero esto depende mucho del tipo de proyecto, y será responsabilidad del desarrollador decidir qué hacer en cada caso.</p>
<p>Ejemplos de casos de uso:</p>
<ul>
<li><strong>Recurso que no existe: 404</strong></li>
</ul>
<p>Este es un caso claro para mostrar una página, indicando que el recurso no está disponible.</p>
<ul>
<li><strong>No permitido acceder a un recurso: 403</strong></li>
</ul>
<p>Si un usuario no tiene permitido acceder a un recurso, pero el usuario ha conseguido llegar a la página, una opción muy adecuada es mostrar una página indicando que no tiene permisos para acceder a la página. Lo ideal sería evitar esto, es decir, no permitir que el usuario llegue a la página, pero si llega, mostrar una página de error.</p>
<ul>
<li><strong>Error interno del servidor: 500</strong></li>
</ul>
<p>Si se ha producido un error inesperado, error en el acceso a la BD, problemas internos del servidor, etc... lo más adecuado es mostrar una página de error, y no mostrar el error al usuario, ya que el usuario no puede hacer nada para solucionar el problema. Por eso es muy importante separar las excepciones propias de la aplicación, de las excepciones propias del sistema.</p>
<ul>
<li><strong>Error de validación: 422</strong></li>
</ul>
<p>Si se produce errores de validación, lo más normal es indicar al usuario los errores producidos, bien de forma conjunta, o si es en un formulario los errores sobre los campos que los han producido.</p>
<p>Por supuesto que existen más casos de uso, pero estos son los más comunes. En general las excepciones personalizadas, no deberían mostrar una página de error, sino un mensaje indicando el error, pero esto dependerá del tipo de proyecto y de la decisiones que se tomen en el mismo.</p>
<h3 id="4-todas-las-excepciones-deben-ser-guardadas-en-un-log">4. Todas las excepciones deben ser guardadas en un log<a class="headerlink" href="#4-todas-las-excepciones-deben-ser-guardadas-en-un-log" title="Permanent link">&para;</a></h3>
<p>Todas las excepciones que se produzcan en la aplicación, deben ser guardadas en un log, para poder analizarlas y consultarlas más adelante. Laravel tiene un sistema de logs muy potente, y podemos guardar las excepciones en un log, y consultarlas más adelante.</p>
<p>Para poder guardar alguna información en un log, simplemente tenemos que llamar al método <code>Log::debug()</code>, <code>Log::info()</code>, <code>Log::warning()</code>, <code>Log::error()</code>, <code>Log::critical()</code>, <code>Log::alert()</code>, <code>Log::emergency()</code>, y pasarle el mensaje que queremos guardar en el log. Esta información se guardará en el canal de logs configurado en base al nivel de log que hayamos indicado.</p>
<p>Por defecto, en el fichero <code>.env</code> a través de la entrada <code>LOG_CHANNEL</code>, se indica el canal de logs que se va a utilizar. Por defecto, Laravel utiliza el canal <code>stack</code>, que es un canal que mezcla varios canales de logs, como el canal <code>single</code>, que guarda los logs en un fichero, el canal <code>daily</code>, que guarda los logs en un fichero diario, el canal <code>syslog</code>, que guarda los logs en el sistema de logs del sistema operativo, y el canal <code>stderr</code>, que guarda los logs en la salida estándar del sistema.</p>
<p>Todas estas configuraciones se pueden cambiar en el fichero <code>config/logging.php</code>, donde se configuran los canales de logs, y los niveles de logs que se van a guardar en cada canal.</p>
<h2 id="implementando-excepciones-de-forma-correcta">Implementando excepciones de forma correcta<a class="headerlink" href="#implementando-excepciones-de-forma-correcta" title="Permanent link">&para;</a></h2>
<h3 id="excepciones-vs-errores">Excepciones vs Errores<a class="headerlink" href="#excepciones-vs-errores" title="Permanent link">&para;</a></h3>
<p>Además de las Excepciones en PHP también pueden provocar fallos los llamados <code>PHP errors</code>, que suelen ser provocados por errores de sintaxis o llamadas inválidas (por ejemplo, llamar a una función que no existe). Estos errores se pueden capturar también en un bloque <code>try-catch</code>, pero no son excepciones, es decir que no se pueden capturar de igual forma.</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a><a href="#__codelineno-6-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">try</span> <span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a><a href="#__codelineno-6-2"><span class="linenos" data-linenos=" 2 "></span></a>    <span class="c1">// Código que puede lanzar una excepción</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3"></a><a href="#__codelineno-6-3"><span class="linenos" data-linenos=" 3 "></span></a>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4"></a><a href="#__codelineno-6-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$ex</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5"></a><a href="#__codelineno-6-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="c1">// Código que se ejecuta si se lanza una excepción</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6"></a><a href="#__codelineno-6-6"><span class="linenos" data-linenos=" 6 "></span></a>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7"></a><a href="#__codelineno-6-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="p">}</span>  
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8"></a><a href="#__codelineno-6-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="k">catch</span> <span class="p">(</span><span class="nx">Error</span> <span class="nv">$er</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9"></a><a href="#__codelineno-6-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="c1">// Código que se ejecuta si se lanza un error</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10"></a><a href="#__codelineno-6-10"><span class="linenos" data-linenos="10 "></span></a>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11"></a><a href="#__codelineno-6-11"><span class="linenos" data-linenos="11 "></span></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Interface Throwable</strong></p>
<p>En PHP 7, se introdujo la interfaz <code>Throwable</code>, que es la interfaz base para todas las excepciones y errores en PHP. Esta interfaz extiende de la interfaz <code>Exception</code>, y por tanto, todas las excepciones y errores en PHP implementan la interfaz <code>Throwable</code>. Por tanto, si queremos capturar tanto excepciones como errores, simplemente tenemos que capturar la interfaz <code>Throwable</code>.</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a><a href="#__codelineno-7-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">try</span> <span class="p">{</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2"></a><a href="#__codelineno-7-2"><span class="linenos" data-linenos="2 "></span></a>    <span class="c1">// Código que puede lanzar una excepción</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3"></a><a href="#__codelineno-7-3"><span class="linenos" data-linenos="3 "></span></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4"></a><a href="#__codelineno-7-4"><span class="linenos" data-linenos="4 "></span></a><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Throwable</span> <span class="nv">$er</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5"></a><a href="#__codelineno-7-5"><span class="linenos" data-linenos="5 "></span></a>    <span class="c1">// Código que se ejecuta si se lanza una excepción o un error</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6"></a><a href="#__codelineno-7-6"><span class="linenos" data-linenos="6 "></span></a>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7"></a><a href="#__codelineno-7-7"><span class="linenos" data-linenos="7 "></span></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="crear-excepciones-personalizadas">Crear excepciones personalizadas<a class="headerlink" href="#crear-excepciones-personalizadas" title="Permanent link">&para;</a></h3>
<p>La mejor forma siempre es tener todo bajo control, y reutilizar la mayoría del código, a través de excepciones personalizadas propias de la aplicación y no de Laravel.</p>
<p>Para ello, lo mejor es tener una jerarquía de excepciones, donde las excepciones más genéricas estén en la parte más alta de la jerarquía, y las excepciones más específicas estén en la parte más baja de la jerarquía.</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a><a href="#__codelineno-8-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">class</span> <span class="nc">AppException</span> <span class="k">extends</span> <span class="nx">\Exception</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2"></a><a href="#__codelineno-8-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="p">{</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3"></a><a href="#__codelineno-8-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="p">}</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4"></a><a href="#__codelineno-8-4"><span class="linenos" data-linenos=" 4 "></span></a>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5"></a><a href="#__codelineno-8-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">class</span> <span class="nc">AuthAppExcepcion</span> <span class="k">extends</span> <span class="nx">AppException</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6"></a><a href="#__codelineno-8-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="p">{</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7"></a><a href="#__codelineno-8-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="c1">// ...</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8"></a><a href="#__codelineno-8-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="p">}</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9"></a><a href="#__codelineno-8-9"><span class="linenos" data-linenos=" 9 "></span></a>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10"></a><a href="#__codelineno-8-10"><span class="linenos" data-linenos="10 "></span></a><span class="k">class</span> <span class="nc">UserNotFoundException</span> <span class="k">extends</span> <span class="nx">AuthAppExcepcion</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11"></a><a href="#__codelineno-8-11"><span class="linenos" data-linenos="11 "></span></a><span class="p">{</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12"></a><a href="#__codelineno-8-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="c1">// ...</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13"></a><a href="#__codelineno-8-13"><span class="linenos" data-linenos="13 "></span></a><span class="p">}</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14"></a><a href="#__codelineno-8-14"><span class="linenos" data-linenos="14 "></span></a>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15"></a><a href="#__codelineno-8-15"><span class="linenos" data-linenos="15 "></span></a><span class="k">class</span> <span class="nc">StoreException</span> <span class="k">extends</span> <span class="nx">AppException</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16"></a><a href="#__codelineno-8-16"><span class="linenos" data-linenos="16 "></span></a><span class="p">{</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17"></a><a href="#__codelineno-8-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="c1">// ...</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18"></a><a href="#__codelineno-8-18"><span class="linenos" data-linenos="18 "></span></a><span class="p">}</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19"></a><a href="#__codelineno-8-19"><span class="linenos" data-linenos="19 "></span></a>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20"></a><a href="#__codelineno-8-20"><span class="linenos" data-linenos="20 "></span></a><span class="k">class</span> <span class="nc">OrderNotFoundException</span> <span class="k">extends</span> <span class="nx">StoreException</span>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21"></a><a href="#__codelineno-8-21"><span class="linenos" data-linenos="21 "></span></a><span class="p">{</span>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22"></a><a href="#__codelineno-8-22"><span class="linenos" data-linenos="22 "></span></a>    <span class="c1">// ...</span>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23"></a><a href="#__codelineno-8-23"><span class="linenos" data-linenos="23 "></span></a><span class="p">}</span>
</span></code></pre></div>
<p>En este ejemplo tenemos una jerarquía de excepciones, donde <code>AppException</code> es la excepción más genérica, y vamos creando excepciones por caracteristicas, como <code>AuthAppExcepcion</code>, <code>StoreException</code>, etc... y dentro de cada una de estas excepciones, vamos creando excepciones más específicas, como <code>UserNotFoundException</code>, <code>OrderNotFoundException</code>, etc...</p>
<p>Esto nos permite definir comportamientos especificos para cada tipo de caracteristica, y reutilizar mucho código, y si una excepción debe tener un comportamiento específico, simplemente sobreescribimos en esa excepción el método o comportamiento que queremos cambiar.</p>
<h3 id="crear-codigo-numericos-para-las-excepciones">Crear código numéricos para las excepciones<a class="headerlink" href="#crear-codigo-numericos-para-las-excepciones" title="Permanent link">&para;</a></h3>
<p>Los códigos numéricos son muy útiles para identificar las excepciones, y poder hacer un seguimiento de las mismas. Laravel no tiene un sistema de códigos numéricos para las excepciones, pero podemos implementarlo nosotros mismos.</p>
<p>Una opción muy útil para esto es utilizar un enumerado, donde podemos definir los código de las excepciones, y una serie de métodos de utilidad para realizar tareas en función de cada código. Además podemos agrupar los códigos por rangos, para tener una mejor organización de los códigos. Por ejemplo, los códigos de 100 a 199 son para excepciones de autenticación, los códigos de 200 a 299 son para excepciones del módulo 1, y así sucesivamente.</p>
<p>Para crear un enumerado utilizando <code>php artisan make:enum ExceptionCode</code>, y definir los códigos de las excepciones.</p>
<p>Una posible implementación sería esta:</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1"></a><a href="#__codelineno-9-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="o">&lt;?</span><span class="nx">php</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2"></a><a href="#__codelineno-9-2"><span class="linenos" data-linenos=" 2 "></span></a>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3"></a><a href="#__codelineno-9-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4"></a><a href="#__codelineno-9-4"><span class="linenos" data-linenos=" 4 "></span></a>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5"></a><a href="#__codelineno-9-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="nx">enum</span> <span class="nx">ExceptionCode</span><span class="o">:</span> <span class="nx">int</span> <span class="p">{</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6"></a><a href="#__codelineno-9-6"><span class="linenos" data-linenos=" 6 "></span></a>  <span class="c1">//Códigos para autenticación</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7"></a><a href="#__codelineno-9-7"><span class="linenos" data-linenos=" 7 "></span></a>  <span class="k">case</span> <span class="nx">USER_NOT_EXITS</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8"></a><a href="#__codelineno-9-8"><span class="linenos" data-linenos=" 8 "></span></a>  <span class="k">case</span> <span class="nx">USER_EXISTS</span><span class="o">=</span> <span class="mi">102</span><span class="p">;</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9"></a><a href="#__codelineno-9-9"><span class="linenos" data-linenos=" 9 "></span></a>  <span class="k">case</span> <span class="nx">INVALID_CREDENTIALS</span> <span class="o">=</span> <span class="mi">103</span><span class="p">;</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10"></a><a href="#__codelineno-9-10"><span class="linenos" data-linenos="10 "></span></a>  <span class="k">case</span> <span class="nx">UNAUTHORIZED</span> <span class="o">=</span> <span class="mi">101</span><span class="p">;</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11"></a><a href="#__codelineno-9-11"><span class="linenos" data-linenos="11 "></span></a>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12"></a><a href="#__codelineno-9-12"><span class="linenos" data-linenos="12 "></span></a>  <span class="c1">//Código para Modulo1</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13"></a><a href="#__codelineno-9-13"><span class="linenos" data-linenos="13 "></span></a>  <span class="k">case</span> <span class="nx">ERROR1</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14"></a><a href="#__codelineno-9-14"><span class="linenos" data-linenos="14 "></span></a>  <span class="k">case</span> <span class="nx">ERROR2</span> <span class="o">=</span> <span class="mi">201</span><span class="p">;</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15"></a><a href="#__codelineno-9-15"><span class="linenos" data-linenos="15 "></span></a>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16"></a><a href="#__codelineno-9-16"><span class="linenos" data-linenos="16 "></span></a>  <span class="c1">//Código para Modulo2</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17"></a><a href="#__codelineno-9-17"><span class="linenos" data-linenos="17 "></span></a>  <span class="k">case</span> <span class="nx">ERROR3</span> <span class="o">=</span> <span class="mi">300</span><span class="p">;</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18"></a><a href="#__codelineno-9-18"><span class="linenos" data-linenos="18 "></span></a>  <span class="k">case</span> <span class="nx">ERROR4</span> <span class="o">=</span> <span class="mi">301</span><span class="p">;</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19"></a><a href="#__codelineno-9-19"><span class="linenos" data-linenos="19 "></span></a>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20"></a><a href="#__codelineno-9-20"><span class="linenos" data-linenos="20 "></span></a>  <span class="c1">//Funciones</span>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21"></a><a href="#__codelineno-9-21"><span class="linenos" data-linenos="21 "></span></a>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22"></a><a href="#__codelineno-9-22"><span class="linenos" data-linenos="22 "></span></a>  <span class="c1">//Obtener el HTTP status code a patir de la excepción</span>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23"></a><a href="#__codelineno-9-23"><span class="linenos" data-linenos="23 "></span></a>  <span class="k">public</span> <span class="k">function</span> <span class="nf">getStatusCode</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span> <span class="p">{</span>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24"></a><a href="#__codelineno-9-24"><span class="linenos" data-linenos="24 "></span></a>    <span class="nv">$value</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">;</span>
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25"></a><a href="#__codelineno-9-25"><span class="linenos" data-linenos="25 "></span></a>
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26"></a><a href="#__codelineno-9-26"><span class="linenos" data-linenos="26 "></span></a>    <span class="k">return</span> <span class="k">match</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27"></a><a href="#__codelineno-9-27"><span class="linenos" data-linenos="27 "></span></a>      <span class="nv">$value</span> <span class="o">&gt;=</span> <span class="mi">100</span> <span class="o">&amp;&amp;</span> <span class="nv">$value</span> <span class="o">&lt;=</span> <span class="mi">199</span> <span class="o">=&gt;</span> <span class="mi">403</span><span class="p">,</span>  <span class="c1">//Forbidden</span>
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28"></a><a href="#__codelineno-9-28"><span class="linenos" data-linenos="28 "></span></a>      <span class="nv">$value</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="nv">$value</span> <span class="o">&lt;=</span> <span class="mi">1000</span> <span class="o">=&gt;</span> <span class="mi">400</span><span class="p">,</span>  <span class="c1">//Error genérico del lado del cliente</span>
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29"></a><a href="#__codelineno-9-29"><span class="linenos" data-linenos="29 "></span></a>
</span><span id="__span-9-30"><a id="__codelineno-9-30" name="__codelineno-9-30"></a><a href="#__codelineno-9-30"><span class="linenos" data-linenos="30 "></span></a>      <span class="k">default</span> <span class="o">=&gt;</span> <span class="mi">500</span><span class="p">,</span> <span class="c1">//Error genérico del lado del servidor</span>
</span><span id="__span-9-31"><a id="__codelineno-9-31" name="__codelineno-9-31"></a><a href="#__codelineno-9-31"><span class="linenos" data-linenos="31 "></span></a>    <span class="p">};</span>
</span><span id="__span-9-32"><a id="__codelineno-9-32" name="__codelineno-9-32"></a><a href="#__codelineno-9-32"><span class="linenos" data-linenos="32 "></span></a>  <span class="p">}</span>
</span><span id="__span-9-33"><a id="__codelineno-9-33" name="__codelineno-9-33"></a><a href="#__codelineno-9-33"><span class="linenos" data-linenos="33 "></span></a>
</span><span id="__span-9-34"><a id="__codelineno-9-34" name="__codelineno-9-34"></a><a href="#__codelineno-9-34"><span class="linenos" data-linenos="34 "></span></a>  <span class="c1">//Obtener la descripción de la excepción en función del código de error</span>
</span><span id="__span-9-35"><a id="__codelineno-9-35" name="__codelineno-9-35"></a><a href="#__codelineno-9-35"><span class="linenos" data-linenos="35 "></span></a>  <span class="k">public</span> <span class="k">function</span> <span class="nf">getMessage</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
</span><span id="__span-9-36"><a id="__codelineno-9-36" name="__codelineno-9-36"></a><a href="#__codelineno-9-36"><span class="linenos" data-linenos="36 "></span></a>  <span class="p">{</span>
</span><span id="__span-9-37"><a id="__codelineno-9-37" name="__codelineno-9-37"></a><a href="#__codelineno-9-37"><span class="linenos" data-linenos="37 "></span></a>    <span class="nv">$key</span> <span class="o">=</span> <span class="s2">&quot;exceptions.</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">value</span><span class="si">}</span><span class="s2">.message&quot;</span><span class="p">;</span>
</span><span id="__span-9-38"><a id="__codelineno-9-38" name="__codelineno-9-38"></a><a href="#__codelineno-9-38"><span class="linenos" data-linenos="38 "></span></a>    <span class="nv">$translation</span> <span class="o">=</span> <span class="nx">__</span><span class="p">(</span><span class="nv">$key</span><span class="p">);</span>
</span><span id="__span-9-39"><a id="__codelineno-9-39" name="__codelineno-9-39"></a><a href="#__codelineno-9-39"><span class="linenos" data-linenos="39 "></span></a>
</span><span id="__span-9-40"><a id="__codelineno-9-40" name="__codelineno-9-40"></a><a href="#__codelineno-9-40"><span class="linenos" data-linenos="40 "></span></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$key</span> <span class="o">===</span> <span class="nv">$translation</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-9-41"><a id="__codelineno-9-41" name="__codelineno-9-41"></a><a href="#__codelineno-9-41"><span class="linenos" data-linenos="41 "></span></a>      <span class="k">return</span> <span class="s2">&quot;Something went wrong&quot;</span><span class="p">;</span>
</span><span id="__span-9-42"><a id="__codelineno-9-42" name="__codelineno-9-42"></a><a href="#__codelineno-9-42"><span class="linenos" data-linenos="42 "></span></a>    <span class="p">}</span>
</span><span id="__span-9-43"><a id="__codelineno-9-43" name="__codelineno-9-43"></a><a href="#__codelineno-9-43"><span class="linenos" data-linenos="43 "></span></a>
</span><span id="__span-9-44"><a id="__codelineno-9-44" name="__codelineno-9-44"></a><a href="#__codelineno-9-44"><span class="linenos" data-linenos="44 "></span></a>    <span class="k">return</span> <span class="nv">$translation</span><span class="p">;</span>
</span><span id="__span-9-45"><a id="__codelineno-9-45" name="__codelineno-9-45"></a><a href="#__codelineno-9-45"><span class="linenos" data-linenos="45 "></span></a>  <span class="p">}</span>
</span><span id="__span-9-46"><a id="__codelineno-9-46" name="__codelineno-9-46"></a><a href="#__codelineno-9-46"><span class="linenos" data-linenos="46 "></span></a>
</span><span id="__span-9-47"><a id="__codelineno-9-47" name="__codelineno-9-47"></a><a href="#__codelineno-9-47"><span class="linenos" data-linenos="47 "></span></a>  <span class="k">public</span> <span class="k">function</span> <span class="nf">getDescription</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
</span><span id="__span-9-48"><a id="__codelineno-9-48" name="__codelineno-9-48"></a><a href="#__codelineno-9-48"><span class="linenos" data-linenos="48 "></span></a>  <span class="p">{</span>
</span><span id="__span-9-49"><a id="__codelineno-9-49" name="__codelineno-9-49"></a><a href="#__codelineno-9-49"><span class="linenos" data-linenos="49 "></span></a>    <span class="nv">$key</span> <span class="o">=</span> <span class="s2">&quot;exceptions.</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">value</span><span class="si">}</span><span class="s2">.description&quot;</span><span class="p">;</span>
</span><span id="__span-9-50"><a id="__codelineno-9-50" name="__codelineno-9-50"></a><a href="#__codelineno-9-50"><span class="linenos" data-linenos="50 "></span></a>    <span class="nv">$translation</span> <span class="o">=</span> <span class="nx">__</span><span class="p">(</span><span class="nv">$key</span><span class="p">);</span>
</span><span id="__span-9-51"><a id="__codelineno-9-51" name="__codelineno-9-51"></a><a href="#__codelineno-9-51"><span class="linenos" data-linenos="51 "></span></a>
</span><span id="__span-9-52"><a id="__codelineno-9-52" name="__codelineno-9-52"></a><a href="#__codelineno-9-52"><span class="linenos" data-linenos="52 "></span></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$key</span> <span class="o">===</span> <span class="nv">$translation</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-9-53"><a id="__codelineno-9-53" name="__codelineno-9-53"></a><a href="#__codelineno-9-53"><span class="linenos" data-linenos="53 "></span></a>      <span class="k">return</span> <span class="s2">&quot;No additional description provided&quot;</span><span class="p">;</span>
</span><span id="__span-9-54"><a id="__codelineno-9-54" name="__codelineno-9-54"></a><a href="#__codelineno-9-54"><span class="linenos" data-linenos="54 "></span></a>    <span class="p">}</span>
</span><span id="__span-9-55"><a id="__codelineno-9-55" name="__codelineno-9-55"></a><a href="#__codelineno-9-55"><span class="linenos" data-linenos="55 "></span></a>
</span><span id="__span-9-56"><a id="__codelineno-9-56" name="__codelineno-9-56"></a><a href="#__codelineno-9-56"><span class="linenos" data-linenos="56 "></span></a>    <span class="k">return</span> <span class="nv">$translation</span><span class="p">;</span>
</span><span id="__span-9-57"><a id="__codelineno-9-57" name="__codelineno-9-57"></a><a href="#__codelineno-9-57"><span class="linenos" data-linenos="57 "></span></a>  <span class="p">}</span>
</span><span id="__span-9-58"><a id="__codelineno-9-58" name="__codelineno-9-58"></a><a href="#__codelineno-9-58"><span class="linenos" data-linenos="58 "></span></a>
</span><span id="__span-9-59"><a id="__codelineno-9-59" name="__codelineno-9-59"></a><a href="#__codelineno-9-59"><span class="linenos" data-linenos="59 "></span></a><span class="p">}</span>
</span></code></pre></div>
<p>Y ahora tendremos que crear la clase base para todas las excepciones de nuestra aplicación, a la que llamaremos <code>AppException</code>, y que extenderá de <code>Exception</code>. Para crear esta clase, vamos a crearla con el comando <code>php artisan make:exception AppException</code>. A la pregunta de si queremos crear método de renderiazado y método para reportar, le decimos que sí.</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a><a href="#__codelineno-10-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">namespace</span> <span class="nx">App\Exceptions</span><span class="p">;</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2"></a><a href="#__codelineno-10-2"><span class="linenos" data-linenos=" 2 "></span></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3"></a><a href="#__codelineno-10-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="k">use</span> <span class="nx">App\ExceptionCode</span><span class="p">;</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4"></a><a href="#__codelineno-10-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">use</span> <span class="nx">Exception</span><span class="p">;</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5"></a><a href="#__codelineno-10-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6"></a><a href="#__codelineno-10-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="k">use</span> <span class="nx">Illuminate\Http\Response</span><span class="p">;</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7"></a><a href="#__codelineno-10-7"><span class="linenos" data-linenos=" 7 "></span></a>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8"></a><a href="#__codelineno-10-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="k">class</span> <span class="nc">AppException</span> <span class="k">extends</span> <span class="nx">Exception</span> <span class="p">{</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9"></a><a href="#__codelineno-10-9"><span class="linenos" data-linenos=" 9 "></span></a>  <span class="k">protected</span> <span class="nx">string</span> <span class="nv">$description</span><span class="p">;</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10"></a><a href="#__codelineno-10-10"><span class="linenos" data-linenos="10 "></span></a>  <span class="k">protected</span> <span class="nx">ExceptionCode</span> <span class="nv">$internalCode</span><span class="p">;</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11"></a><a href="#__codelineno-10-11"><span class="linenos" data-linenos="11 "></span></a>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12"></a><a href="#__codelineno-10-12"><span class="linenos" data-linenos="12 "></span></a>  <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">new</span><span class="p">(</span><span class="nx">ExceptionCode</span> <span class="nv">$code</span><span class="p">,</span> <span class="o">?</span><span class="nx">string</span> <span class="nv">$message</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="o">?</span><span class="nx">string</span> <span class="nv">$description</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="o">?</span><span class="nx">int</span> <span class="nv">$statusCode</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13"></a><a href="#__codelineno-10-13"><span class="linenos" data-linenos="13 "></span></a>                             <span class="o">?</span><span class="nx">Throwable</span>    <span class="nv">$internalError</span><span class="o">=</span><span class="k">null</span><span class="p">)</span><span class="o">:</span> <span class="nx">AppException</span> <span class="p">{</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14"></a><a href="#__codelineno-10-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="nv">$exception</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">self</span><span class="p">();</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15"></a><a href="#__codelineno-10-15"><span class="linenos" data-linenos="15 "></span></a>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16"></a><a href="#__codelineno-10-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">code</span> <span class="o">=</span> <span class="nv">$statusCode</span> <span class="o">??</span> <span class="nv">$code</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">();</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17"></a><a href="#__codelineno-10-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">internalCode</span> <span class="o">=</span> <span class="nv">$code</span><span class="p">;</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18"></a><a href="#__codelineno-10-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">message</span> <span class="o">=</span> <span class="nv">$message</span> <span class="o">??</span> <span class="nv">$code</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19"></a><a href="#__codelineno-10-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">description</span> <span class="o">=</span> <span class="nv">$description</span> <span class="o">??</span> <span class="nv">$code</span><span class="o">-&gt;</span><span class="na">getDescription</span><span class="p">();</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20"></a><a href="#__codelineno-10-20"><span class="linenos" data-linenos="20 "></span></a>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21"></a><a href="#__codelineno-10-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">internalError</span> <span class="o">=</span> <span class="nv">$internalError</span><span class="p">;</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22"></a><a href="#__codelineno-10-22"><span class="linenos" data-linenos="22 "></span></a>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23"></a><a href="#__codelineno-10-23"><span class="linenos" data-linenos="23 "></span></a>    <span class="k">return</span> <span class="nv">$exception</span><span class="p">;</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24"></a><a href="#__codelineno-10-24"><span class="linenos" data-linenos="24 "></span></a>  <span class="p">}</span>
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25"></a><a href="#__codelineno-10-25"><span class="linenos" data-linenos="25 "></span></a>
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26"></a><a href="#__codelineno-10-26"><span class="linenos" data-linenos="26 "></span></a>  <span class="k">public</span> <span class="k">function</span> <span class="nf">getDescription</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span> <span class="p">{</span>
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27"></a><a href="#__codelineno-10-27"><span class="linenos" data-linenos="27 "></span></a>    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">description</span><span class="p">;</span>
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28"></a><a href="#__codelineno-10-28"><span class="linenos" data-linenos="28 "></span></a>  <span class="p">}</span>
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29"></a><a href="#__codelineno-10-29"><span class="linenos" data-linenos="29 "></span></a>
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30"></a><a href="#__codelineno-10-30"><span class="linenos" data-linenos="30 "></span></a>  <span class="k">public</span> <span class="k">function</span> <span class="nf">getInternalCode</span><span class="p">()</span><span class="o">:</span> <span class="nx">ExceptionCode</span> <span class="p">{</span>
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31"></a><a href="#__codelineno-10-31"><span class="linenos" data-linenos="31 "></span></a>    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">internalCode</span><span class="p">;</span>
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32"></a><a href="#__codelineno-10-32"><span class="linenos" data-linenos="32 "></span></a>  <span class="p">}</span>
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33"></a><a href="#__codelineno-10-33"><span class="linenos" data-linenos="33 "></span></a>
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34"></a><a href="#__codelineno-10-34"><span class="linenos" data-linenos="34 "></span></a>  <span class="sd">/**</span>
</span><span id="__span-10-35"><a id="__codelineno-10-35" name="__codelineno-10-35"></a><a href="#__codelineno-10-35"><span class="linenos" data-linenos="35 "></span></a><span class="sd">   * Report the exception.</span>
</span><span id="__span-10-36"><a id="__codelineno-10-36" name="__codelineno-10-36"></a><a href="#__codelineno-10-36"><span class="linenos" data-linenos="36 "></span></a><span class="sd">   */</span>
</span><span id="__span-10-37"><a id="__codelineno-10-37" name="__codelineno-10-37"></a><a href="#__codelineno-10-37"><span class="linenos" data-linenos="37 "></span></a>  <span class="k">public</span> <span class="k">function</span> <span class="nf">report</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span> <span class="p">{</span>
</span><span id="__span-10-38"><a id="__codelineno-10-38" name="__codelineno-10-38"></a><a href="#__codelineno-10-38"><span class="linenos" data-linenos="38 "></span></a>    <span class="c1">//</span>
</span><span id="__span-10-39"><a id="__codelineno-10-39" name="__codelineno-10-39"></a><a href="#__codelineno-10-39"><span class="linenos" data-linenos="39 "></span></a>  <span class="p">}</span>
</span><span id="__span-10-40"><a id="__codelineno-10-40" name="__codelineno-10-40"></a><a href="#__codelineno-10-40"><span class="linenos" data-linenos="40 "></span></a>
</span><span id="__span-10-41"><a id="__codelineno-10-41" name="__codelineno-10-41"></a><a href="#__codelineno-10-41"><span class="linenos" data-linenos="41 "></span></a>  <span class="sd">/**</span>
</span><span id="__span-10-42"><a id="__codelineno-10-42" name="__codelineno-10-42"></a><a href="#__codelineno-10-42"><span class="linenos" data-linenos="42 "></span></a><span class="sd">   * Render the exception as an HTTP response.</span>
</span><span id="__span-10-43"><a id="__codelineno-10-43" name="__codelineno-10-43"></a><a href="#__codelineno-10-43"><span class="linenos" data-linenos="43 "></span></a><span class="sd">   */</span>
</span><span id="__span-10-44"><a id="__codelineno-10-44" name="__codelineno-10-44"></a><a href="#__codelineno-10-44"><span class="linenos" data-linenos="44 "></span></a>  <span class="k">public</span> <span class="k">function</span> <span class="nf">render</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span> <span class="p">{</span>
</span><span id="__span-10-45"><a id="__codelineno-10-45" name="__codelineno-10-45"></a><a href="#__codelineno-10-45"><span class="linenos" data-linenos="45 "></span></a>    <span class="c1">//</span>
</span><span id="__span-10-46"><a id="__codelineno-10-46" name="__codelineno-10-46"></a><a href="#__codelineno-10-46"><span class="linenos" data-linenos="46 "></span></a>  <span class="p">}</span>
</span><span id="__span-10-47"><a id="__codelineno-10-47" name="__codelineno-10-47"></a><a href="#__codelineno-10-47"><span class="linenos" data-linenos="47 "></span></a><span class="p">}</span>
</span></code></pre></div>
<p>Hemos utilizado una aproximación un poco diferente, ya que vamos a instanciar esta clase de forma indirecta, a través de un método estático <code>new()</code>, que nos permite crear una excepción con un código de error, un mensaje, una descripción y un código de estado <code>HTTP</code>. Además, hemos añadido un método <code>getDescription()</code> que nos devuelve la descripción de la excepción, y un método <code>getInternalCode()</code> que nos devuelve el código de la excepción.</p>
<p>También hemos incluido un parámetro opcional para pasar la excepción o el error que la provocó (si fuera el caso). De esta forma, podemos tener el contexto de porqué se lanzó esta expepción.</p>
<p>Ahora podemos mejorar la clase <code>AppException</code> incluyendo un método para indicar si es necesario renderizar la excepción en una página de error, o simplemente mostrar un mensaje.</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1"></a><a href="#__codelineno-11-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">class</span> <span class="nc">AppException</span> <span class="k">extends</span> <span class="nx">Exception</span> <span class="p">{</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2"></a><a href="#__codelineno-11-2"><span class="linenos" data-linenos=" 2 "></span></a>  <span class="k">protected</span> <span class="nx">string</span> <span class="nv">$description</span><span class="p">;</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3"></a><a href="#__codelineno-11-3"><span class="linenos" data-linenos=" 3 "></span></a>  <span class="k">protected</span> <span class="o">?</span><span class="nx">Throwable</span> <span class="nv">$internalError</span><span class="p">;</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4"></a><a href="#__codelineno-11-4"><span class="linenos" data-linenos=" 4 "></span></a>  <span class="k">protected</span> <span class="nx">ExceptionCode</span> <span class="nv">$internalCode</span><span class="p">;</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5"></a><a href="#__codelineno-11-5"><span class="linenos" data-linenos=" 5 "></span></a>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6"></a><a href="#__codelineno-11-6"><span class="linenos" data-linenos=" 6 "></span></a>  <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">new</span><span class="p">(</span><span class="nx">ExceptionCode</span> <span class="nv">$code</span><span class="p">,</span> <span class="o">?</span><span class="nx">string</span> <span class="nv">$message</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="o">?</span><span class="nx">string</span> <span class="nv">$description</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="o">?</span><span class="nx">int</span> <span class="nv">$statusCode</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7"></a><a href="#__codelineno-11-7"><span class="linenos" data-linenos=" 7 "></span></a>                             <span class="o">?</span><span class="nx">Throwable</span>    <span class="nv">$internalError</span><span class="o">=</span><span class="k">null</span><span class="p">)</span><span class="o">:</span> <span class="nx">AppException</span> <span class="p">{</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8"></a><a href="#__codelineno-11-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="nv">$exception</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">self</span><span class="p">();</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9"></a><a href="#__codelineno-11-9"><span class="linenos" data-linenos=" 9 "></span></a>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10"></a><a href="#__codelineno-11-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">code</span> <span class="o">=</span> <span class="nv">$statusCode</span> <span class="o">??</span> <span class="nv">$code</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">();</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11"></a><a href="#__codelineno-11-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">internalCode</span> <span class="o">=</span> <span class="nv">$code</span><span class="p">;</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12"></a><a href="#__codelineno-11-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">message</span> <span class="o">=</span> <span class="nv">$message</span> <span class="o">??</span> <span class="nv">$code</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13"></a><a href="#__codelineno-11-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">description</span> <span class="o">=</span> <span class="nv">$description</span> <span class="o">??</span> <span class="nv">$code</span><span class="o">-&gt;</span><span class="na">getDescription</span><span class="p">();</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14"></a><a href="#__codelineno-11-14"><span class="linenos" data-linenos="14 "></span></a>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15"></a><a href="#__codelineno-11-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">internalError</span> <span class="o">=</span> <span class="nv">$internalError</span><span class="p">;</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16"></a><a href="#__codelineno-11-16"><span class="linenos" data-linenos="16 "></span></a>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17"></a><a href="#__codelineno-11-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="k">return</span> <span class="nv">$exception</span><span class="p">;</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18"></a><a href="#__codelineno-11-18"><span class="linenos" data-linenos="18 "></span></a>  <span class="p">}</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19"></a><a href="#__codelineno-11-19"><span class="linenos" data-linenos="19 "></span></a>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20"></a><a href="#__codelineno-11-20"><span class="linenos" data-linenos="20 "></span></a>  <span class="sd">/**</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21"></a><a href="#__codelineno-11-21"><span class="linenos" data-linenos="21 "></span></a><span class="sd">   * Get the previous exception.</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22"></a><a href="#__codelineno-11-22"><span class="linenos" data-linenos="22 "></span></a><span class="sd">   */</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23"></a><a href="#__codelineno-11-23"><span class="linenos" data-linenos="23 "></span></a>  <span class="k">public</span> <span class="k">function</span> <span class="nf">getInnerException</span><span class="p">()</span><span class="o">:</span> <span class="o">?</span><span class="nx">Throwable</span> <span class="p">{</span>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24"></a><a href="#__codelineno-11-24"><span class="linenos" data-linenos="24 "></span></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">internalError</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25"></a><a href="#__codelineno-11-25"><span class="linenos" data-linenos="25 "></span></a>      <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">internalError</span><span class="p">;</span>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26"></a><a href="#__codelineno-11-26"><span class="linenos" data-linenos="26 "></span></a>    <span class="p">}</span>
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27"></a><a href="#__codelineno-11-27"><span class="linenos" data-linenos="27 "></span></a>    <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
</span><span id="__span-11-28"><a id="__codelineno-11-28" name="__codelineno-11-28"></a><a href="#__codelineno-11-28"><span class="linenos" data-linenos="28 "></span></a>  <span class="p">}</span>
</span><span id="__span-11-29"><a id="__codelineno-11-29" name="__codelineno-11-29"></a><a href="#__codelineno-11-29"><span class="linenos" data-linenos="29 "></span></a>
</span><span id="__span-11-30"><a id="__codelineno-11-30" name="__codelineno-11-30"></a><a href="#__codelineno-11-30"><span class="linenos" data-linenos="30 "></span></a>  <span class="k">public</span> <span class="k">function</span> <span class="nf">getInternalCode</span><span class="p">()</span><span class="o">:</span> <span class="nx">ExceptionCode</span> <span class="p">{</span>
</span><span id="__span-11-31"><a id="__codelineno-11-31" name="__codelineno-11-31"></a><a href="#__codelineno-11-31"><span class="linenos" data-linenos="31 "></span></a>    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">internalCode</span><span class="p">;</span>
</span><span id="__span-11-32"><a id="__codelineno-11-32" name="__codelineno-11-32"></a><a href="#__codelineno-11-32"><span class="linenos" data-linenos="32 "></span></a>  <span class="p">}</span>
</span><span id="__span-11-33"><a id="__codelineno-11-33" name="__codelineno-11-33"></a><a href="#__codelineno-11-33"><span class="linenos" data-linenos="33 "></span></a>
</span><span id="__span-11-34"><a id="__codelineno-11-34" name="__codelineno-11-34"></a><a href="#__codelineno-11-34"><span class="linenos" data-linenos="34 "></span></a>  <span class="k">public</span> <span class="k">function</span> <span class="nf">getDescription</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span> <span class="p">{</span>
</span><span id="__span-11-35"><a id="__codelineno-11-35" name="__codelineno-11-35"></a><a href="#__codelineno-11-35"><span class="linenos" data-linenos="35 "></span></a>    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">description</span><span class="p">;</span>
</span><span id="__span-11-36"><a id="__codelineno-11-36" name="__codelineno-11-36"></a><a href="#__codelineno-11-36"><span class="linenos" data-linenos="36 "></span></a>  <span class="p">}</span>
</span><span id="__span-11-37"><a id="__codelineno-11-37" name="__codelineno-11-37"></a><a href="#__codelineno-11-37"><span class="linenos" data-linenos="37 "></span></a>
</span><span id="__span-11-38"><a id="__codelineno-11-38" name="__codelineno-11-38"></a><a href="#__codelineno-11-38"><span class="linenos" data-linenos="38 "></span></a>  <span class="k">protected</span> <span class="k">function</span> <span class="nf">isNeedRenderToPage</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span><span class="o">:</span> <span class="nx">bool</span> <span class="p">{</span>
</span><span id="__span-11-39"><a id="__codelineno-11-39" name="__codelineno-11-39"></a><a href="#__codelineno-11-39"><span class="linenos" data-linenos="39 "></span></a>
</span><span id="__span-11-40"><a id="__codelineno-11-40" name="__codelineno-11-40"></a><a href="#__codelineno-11-40"><span class="linenos" data-linenos="40 "></span></a>    <span class="nv">$statusCode</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">internalCode</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">();</span>
</span><span id="__span-11-41"><a id="__codelineno-11-41" name="__codelineno-11-41"></a><a href="#__codelineno-11-41"><span class="linenos" data-linenos="41 "></span></a>
</span><span id="__span-11-42"><a id="__codelineno-11-42" name="__codelineno-11-42"></a><a href="#__codelineno-11-42"><span class="linenos" data-linenos="42 "></span></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$statusCode</span> <span class="o">&gt;=</span> <span class="mi">500</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-11-43"><a id="__codelineno-11-43" name="__codelineno-11-43"></a><a href="#__codelineno-11-43"><span class="linenos" data-linenos="43 "></span></a>      <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span id="__span-11-44"><a id="__codelineno-11-44" name="__codelineno-11-44"></a><a href="#__codelineno-11-44"><span class="linenos" data-linenos="44 "></span></a>    <span class="p">}</span>
</span><span id="__span-11-45"><a id="__codelineno-11-45" name="__codelineno-11-45"></a><a href="#__codelineno-11-45"><span class="linenos" data-linenos="45 "></span></a>
</span><span id="__span-11-46"><a id="__codelineno-11-46" name="__codelineno-11-46"></a><a href="#__codelineno-11-46"><span class="linenos" data-linenos="46 "></span></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$statusCode</span> <span class="o">==</span> <span class="mi">403</span> <span class="o">||</span> <span class="nv">$statusCode</span> <span class="o">==</span> <span class="mi">404</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-11-47"><a id="__codelineno-11-47" name="__codelineno-11-47"></a><a href="#__codelineno-11-47"><span class="linenos" data-linenos="47 "></span></a>      <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span><span id="__span-11-48"><a id="__codelineno-11-48" name="__codelineno-11-48"></a><a href="#__codelineno-11-48"><span class="linenos" data-linenos="48 "></span></a>    <span class="p">}</span>
</span><span id="__span-11-49"><a id="__codelineno-11-49" name="__codelineno-11-49"></a><a href="#__codelineno-11-49"><span class="linenos" data-linenos="49 "></span></a>
</span><span id="__span-11-50"><a id="__codelineno-11-50" name="__codelineno-11-50"></a><a href="#__codelineno-11-50"><span class="linenos" data-linenos="50 "></span></a>    <span class="k">return</span> <span class="k">match</span><span class="p">(</span><span class="k">true</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-11-51"><a id="__codelineno-11-51" name="__codelineno-11-51"></a><a href="#__codelineno-11-51"><span class="linenos" data-linenos="51 "></span></a>      <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">is</span><span class="p">(</span><span class="s1">&#39;api/*&#39;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
</span><span id="__span-11-52"><a id="__codelineno-11-52" name="__codelineno-11-52"></a><a href="#__codelineno-11-52"><span class="linenos" data-linenos="52 "></span></a>      <span class="c1">//Incluir otras opciones</span>
</span><span id="__span-11-53"><a id="__codelineno-11-53" name="__codelineno-11-53"></a><a href="#__codelineno-11-53"><span class="linenos" data-linenos="53 "></span></a>      <span class="k">default</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
</span><span id="__span-11-54"><a id="__codelineno-11-54" name="__codelineno-11-54"></a><a href="#__codelineno-11-54"><span class="linenos" data-linenos="54 "></span></a>    <span class="p">};</span>
</span><span id="__span-11-55"><a id="__codelineno-11-55" name="__codelineno-11-55"></a><a href="#__codelineno-11-55"><span class="linenos" data-linenos="55 "></span></a>  <span class="p">}</span>
</span><span id="__span-11-56"><a id="__codelineno-11-56" name="__codelineno-11-56"></a><a href="#__codelineno-11-56"><span class="linenos" data-linenos="56 "></span></a>  <span class="sd">/**</span>
</span><span id="__span-11-57"><a id="__codelineno-11-57" name="__codelineno-11-57"></a><a href="#__codelineno-11-57"><span class="linenos" data-linenos="57 "></span></a><span class="sd">   * Report the exception.</span>
</span><span id="__span-11-58"><a id="__codelineno-11-58" name="__codelineno-11-58"></a><a href="#__codelineno-11-58"><span class="linenos" data-linenos="58 "></span></a><span class="sd">   */</span>
</span><span id="__span-11-59"><a id="__codelineno-11-59" name="__codelineno-11-59"></a><a href="#__codelineno-11-59"><span class="linenos" data-linenos="59 "></span></a>  <span class="k">public</span> <span class="k">function</span> <span class="nf">report</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span> <span class="p">{</span>
</span><span id="__span-11-60"><a id="__codelineno-11-60" name="__codelineno-11-60"></a><a href="#__codelineno-11-60"><span class="linenos" data-linenos="60 "></span></a>    <span class="c1">//</span>
</span><span id="__span-11-61"><a id="__codelineno-11-61" name="__codelineno-11-61"></a><a href="#__codelineno-11-61"><span class="linenos" data-linenos="61 "></span></a>    <span class="nv">$context</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-11-62"><a id="__codelineno-11-62" name="__codelineno-11-62"></a><a href="#__codelineno-11-62"><span class="linenos" data-linenos="62 "></span></a>      <span class="s1">&#39;code&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">internalCode</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">,</span>
</span><span id="__span-11-63"><a id="__codelineno-11-63" name="__codelineno-11-63"></a><a href="#__codelineno-11-63"><span class="linenos" data-linenos="63 "></span></a>      <span class="s1">&#39;statusCode&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">internalCode</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">()</span>
</span><span id="__span-11-64"><a id="__codelineno-11-64" name="__codelineno-11-64"></a><a href="#__codelineno-11-64"><span class="linenos" data-linenos="64 "></span></a>    <span class="p">];</span>
</span><span id="__span-11-65"><a id="__codelineno-11-65" name="__codelineno-11-65"></a><a href="#__codelineno-11-65"><span class="linenos" data-linenos="65 "></span></a>
</span><span id="__span-11-66"><a id="__codelineno-11-66" name="__codelineno-11-66"></a><a href="#__codelineno-11-66"><span class="linenos" data-linenos="66 "></span></a>    <span class="nx">Log</span><span class="o">::</span><span class="na">error</span><span class="p">(</span><span class="nb">implode</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getAllExceptionMessages</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">internalError</span><span class="p">)),</span><span class="nv">$context</span><span class="p">);</span>
</span><span id="__span-11-67"><a id="__codelineno-11-67" name="__codelineno-11-67"></a><a href="#__codelineno-11-67"><span class="linenos" data-linenos="67 "></span></a>
</span><span id="__span-11-68"><a id="__codelineno-11-68" name="__codelineno-11-68"></a><a href="#__codelineno-11-68"><span class="linenos" data-linenos="68 "></span></a>  <span class="p">}</span>
</span><span id="__span-11-69"><a id="__codelineno-11-69" name="__codelineno-11-69"></a><a href="#__codelineno-11-69"><span class="linenos" data-linenos="69 "></span></a>
</span><span id="__span-11-70"><a id="__codelineno-11-70" name="__codelineno-11-70"></a><a href="#__codelineno-11-70"><span class="linenos" data-linenos="70 "></span></a>  <span class="sd">/**</span>
</span><span id="__span-11-71"><a id="__codelineno-11-71" name="__codelineno-11-71"></a><a href="#__codelineno-11-71"><span class="linenos" data-linenos="71 "></span></a><span class="sd">   * Render the exception as an HTTP response.</span>
</span><span id="__span-11-72"><a id="__codelineno-11-72" name="__codelineno-11-72"></a><a href="#__codelineno-11-72"><span class="linenos" data-linenos="72 "></span></a><span class="sd">   */</span>
</span><span id="__span-11-73"><a id="__codelineno-11-73" name="__codelineno-11-73"></a><a href="#__codelineno-11-73"><span class="linenos" data-linenos="73 "></span></a>  <span class="k">public</span> <span class="k">function</span> <span class="nf">render</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span><span class="o">|</span><span class="nx">bool</span> <span class="p">{</span>
</span><span id="__span-11-74"><a id="__codelineno-11-74" name="__codelineno-11-74"></a><a href="#__codelineno-11-74"><span class="linenos" data-linenos="74 "></span></a>    <span class="c1">//</span>
</span><span id="__span-11-75"><a id="__codelineno-11-75" name="__codelineno-11-75"></a><a href="#__codelineno-11-75"><span class="linenos" data-linenos="75 "></span></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isNeedRenderToPage</span><span class="p">(</span><span class="nv">$request</span><span class="p">))</span> <span class="p">{</span>
</span><span id="__span-11-76"><a id="__codelineno-11-76" name="__codelineno-11-76"></a><a href="#__codelineno-11-76"><span class="linenos" data-linenos="76 "></span></a>      <span class="c1">// Renderiza la vista de error, debe haber una vista con el nombre del código de estadso</span>
</span><span id="__span-11-77"><a id="__codelineno-11-77" name="__codelineno-11-77"></a><a href="#__codelineno-11-77"><span class="linenos" data-linenos="77 "></span></a>      <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">view</span><span class="p">(</span><span class="s2">&quot;errors.</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">internalCode</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">[],</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">internalCode</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">());</span>
</span><span id="__span-11-78"><a id="__codelineno-11-78" name="__codelineno-11-78"></a><a href="#__codelineno-11-78"><span class="linenos" data-linenos="78 "></span></a>    <span class="p">}</span>
</span><span id="__span-11-79"><a id="__codelineno-11-79" name="__codelineno-11-79"></a><a href="#__codelineno-11-79"><span class="linenos" data-linenos="79 "></span></a>
</span><span id="__span-11-80"><a id="__codelineno-11-80" name="__codelineno-11-80"></a><a href="#__codelineno-11-80"><span class="linenos" data-linenos="80 "></span></a>    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span id="__span-11-81"><a id="__codelineno-11-81" name="__codelineno-11-81"></a><a href="#__codelineno-11-81"><span class="linenos" data-linenos="81 "></span></a>  <span class="p">}</span>
</span><span id="__span-11-82"><a id="__codelineno-11-82" name="__codelineno-11-82"></a><a href="#__codelineno-11-82"><span class="linenos" data-linenos="82 "></span></a>
</span><span id="__span-11-83"><a id="__codelineno-11-83" name="__codelineno-11-83"></a><a href="#__codelineno-11-83"><span class="linenos" data-linenos="83 "></span></a>  <span class="sd">/**</span>
</span><span id="__span-11-84"><a id="__codelineno-11-84" name="__codelineno-11-84"></a><a href="#__codelineno-11-84"><span class="linenos" data-linenos="84 "></span></a><span class="sd">   * Get all exception messages.</span>
</span><span id="__span-11-85"><a id="__codelineno-11-85" name="__codelineno-11-85"></a><a href="#__codelineno-11-85"><span class="linenos" data-linenos="85 "></span></a><span class="sd">   */</span>
</span><span id="__span-11-86"><a id="__codelineno-11-86" name="__codelineno-11-86"></a><a href="#__codelineno-11-86"><span class="linenos" data-linenos="86 "></span></a>  <span class="k">private</span> <span class="k">function</span> <span class="nf">getAllExceptionMessages</span><span class="p">(</span><span class="nx">\Throwable</span> <span class="nv">$exception</span><span class="p">)</span><span class="o">:</span> <span class="k">array</span>
</span><span id="__span-11-87"><a id="__codelineno-11-87" name="__codelineno-11-87"></a><a href="#__codelineno-11-87"><span class="linenos" data-linenos="87 "></span></a>  <span class="p">{</span>
</span><span id="__span-11-88"><a id="__codelineno-11-88" name="__codelineno-11-88"></a><a href="#__codelineno-11-88"><span class="linenos" data-linenos="88 "></span></a>    <span class="nv">$messages</span><span class="p">[]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getDescription</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span id="__span-11-89"><a id="__codelineno-11-89" name="__codelineno-11-89"></a><a href="#__codelineno-11-89"><span class="linenos" data-linenos="89 "></span></a>
</span><span id="__span-11-90"><a id="__codelineno-11-90" name="__codelineno-11-90"></a><a href="#__codelineno-11-90"><span class="linenos" data-linenos="90 "></span></a>    <span class="k">while</span> <span class="p">(</span><span class="nv">$exception</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-11-91"><a id="__codelineno-11-91" name="__codelineno-11-91"></a><a href="#__codelineno-11-91"><span class="linenos" data-linenos="91 "></span></a>      <span class="nv">$messages</span><span class="p">[]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">()</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">getFile</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">getLine</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span id="__span-11-92"><a id="__codelineno-11-92" name="__codelineno-11-92"></a><a href="#__codelineno-11-92"><span class="linenos" data-linenos="92 "></span></a>      <span class="nv">$exception</span> <span class="o">=</span> <span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">getPrevious</span><span class="p">();</span>
</span><span id="__span-11-93"><a id="__codelineno-11-93" name="__codelineno-11-93"></a><a href="#__codelineno-11-93"><span class="linenos" data-linenos="93 "></span></a>    <span class="p">};</span>
</span><span id="__span-11-94"><a id="__codelineno-11-94" name="__codelineno-11-94"></a><a href="#__codelineno-11-94"><span class="linenos" data-linenos="94 "></span></a>
</span><span id="__span-11-95"><a id="__codelineno-11-95" name="__codelineno-11-95"></a><a href="#__codelineno-11-95"><span class="linenos" data-linenos="95 "></span></a>    <span class="k">return</span> <span class="nv">$messages</span><span class="p">;</span>
</span><span id="__span-11-96"><a id="__codelineno-11-96" name="__codelineno-11-96"></a><a href="#__codelineno-11-96"><span class="linenos" data-linenos="96 "></span></a>  <span class="p">}</span>
</span><span id="__span-11-97"><a id="__codelineno-11-97" name="__codelineno-11-97"></a><a href="#__codelineno-11-97"><span class="linenos" data-linenos="97 "></span></a>
</span><span id="__span-11-98"><a id="__codelineno-11-98" name="__codelineno-11-98"></a><a href="#__codelineno-11-98"><span class="linenos" data-linenos="98 "></span></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="descripcion-de-la-excepcion">Descripción de la excepción<a class="headerlink" href="#descripcion-de-la-excepcion" title="Permanent link">&para;</a></h3>
<p>Los textos son siempre un problema es las aplicaciones, ya que deben ser muchas veces requisitos de que sean traducidos a varios idiomás, y por tanto, esto implica que los textos no estén en el código, sino en ficheros de configuración. Laravel tiene un sistema de traducción muy potente, y podemos utilizarlo para traducir los textos de las excepciones.</p>
<p>Para traducir los textos de las excepciones, vamos a utilizar los códigos numéricos dentro del enumerado. Para ello, vamos a crear un fichero de traducción en <code>lang/en/exceptions.php</code>, donde vamos a definir los textos de las excepciones.</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1"></a><a href="#__codelineno-12-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="o">&lt;?</span><span class="nx">php</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2"></a><a href="#__codelineno-12-2"><span class="linenos" data-linenos=" 2 "></span></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3"></a><a href="#__codelineno-12-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="k">return</span> <span class="p">[</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4"></a><a href="#__codelineno-12-4"><span class="linenos" data-linenos=" 4 "></span></a>  <span class="s1">&#39;100&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5"></a><a href="#__codelineno-12-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;User not found&#39;</span><span class="p">,</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6"></a><a href="#__codelineno-12-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;The user with the given email does not exist.&#39;</span><span class="p">,</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7"></a><a href="#__codelineno-12-7"><span class="linenos" data-linenos=" 7 "></span></a>  <span class="p">],</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8"></a><a href="#__codelineno-12-8"><span class="linenos" data-linenos=" 8 "></span></a>  <span class="s1">&#39;101&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9"></a><a href="#__codelineno-12-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Unauthorized&#39;</span><span class="p">,</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10"></a><a href="#__codelineno-12-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;You are not authorized to access this resource.&#39;</span><span class="p">,</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11"></a><a href="#__codelineno-12-11"><span class="linenos" data-linenos="11 "></span></a>  <span class="p">],</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12"></a><a href="#__codelineno-12-12"><span class="linenos" data-linenos="12 "></span></a>  <span class="s1">&#39;102&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13"></a><a href="#__codelineno-12-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;User already exists&#39;</span><span class="p">,</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14"></a><a href="#__codelineno-12-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;A user with this email has already been created. You cannot create duplicates.&#39;</span><span class="p">,</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15"></a><a href="#__codelineno-12-15"><span class="linenos" data-linenos="15 "></span></a>  <span class="p">],</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16"></a><a href="#__codelineno-12-16"><span class="linenos" data-linenos="16 "></span></a>  <span class="s1">&#39;103&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17"></a><a href="#__codelineno-12-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Invalid credentials&#39;</span><span class="p">,</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18"></a><a href="#__codelineno-12-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;The email or password you entered is incorrect.&#39;</span><span class="p">,</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19"></a><a href="#__codelineno-12-19"><span class="linenos" data-linenos="19 "></span></a>  <span class="p">],</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20"></a><a href="#__codelineno-12-20"><span class="linenos" data-linenos="20 "></span></a>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21"></a><a href="#__codelineno-12-21"><span class="linenos" data-linenos="21 "></span></a><span class="p">];</span>
</span></code></pre></div>
<p>Para acceder a este fichero, desde nuestro enumerado hemos utilizado los métodos <code>getMessage()</code> y <code>getDescription()</code>, que nos devuelven el mensaje y la descripción de la excepción en función del código de error, utilizando para ello, la clave <code>exceptions.{$this-&gt;value}.message</code> y <code>exceptions.{$this-&gt;value}.description</code> respectivamente. Separamos por <code>.</code>, para poder tener una estructura de directorios en el fichero de traducción, y poder tener una mejor organización de los textos.</p>
<h3 id="excepciones-personalizadas">Excepciones personalizadas<a class="headerlink" href="#excepciones-personalizadas" title="Permanent link">&para;</a></h3>
<p>Ahora podemos crear una serie de excepciones personalizadas, pero en lugar de crear todas las excepciones, podemos utilizar una técnica muy potente, y es utilizar métodos numéricos para lanzar las excepciones, y estos métodos tienen mucha semántica, ya que se llaman con el nombre de las excepción que queremos lanzar, pero dejando toda la lógica dentro del método que llama a la excepción, de esta forma no tenemos que repartir el código por toda nuestra aplicación</p>
<p>Vamos a crear una clase <code>AuthAppException</code> que extiende de <code>AppException</code>, y vamos a crear una serie de métodos estáticos que lanzan excepciones para los distintos códigos numéricos.</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1"></a><a href="#__codelineno-13-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">namespace</span> <span class="nx">App\Exceptions</span><span class="p">;</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2"></a><a href="#__codelineno-13-2"><span class="linenos" data-linenos=" 2 "></span></a>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3"></a><a href="#__codelineno-13-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="k">use</span> <span class="nx">App\ExceptionCode</span><span class="p">;</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4"></a><a href="#__codelineno-13-4"><span class="linenos" data-linenos=" 4 "></span></a>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5"></a><a href="#__codelineno-13-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">class</span> <span class="nc">AuthException</span> <span class="k">extends</span> <span class="nx">AppException</span> <span class="p">{</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6"></a><a href="#__codelineno-13-6"><span class="linenos" data-linenos=" 6 "></span></a>  <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">userExists</span><span class="p">(</span><span class="nx">Throwable</span> <span class="nv">$exception</span><span class="o">=</span><span class="k">null</span><span class="p">)</span><span class="o">:</span> <span class="nx">AppException</span> <span class="p">{</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7"></a><a href="#__codelineno-13-7"><span class="linenos" data-linenos=" 7 "></span></a>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8"></a><a href="#__codelineno-13-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">new</span><span class="p">(</span><span class="nx">ExceptionCode</span><span class="o">::</span><span class="na">USER_EXISTS</span><span class="p">,</span> <span class="nx">internalError</span><span class="o">:</span> <span class="nv">$exception</span><span class="p">);</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9"></a><a href="#__codelineno-13-9"><span class="linenos" data-linenos=" 9 "></span></a>  <span class="p">}</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10"></a><a href="#__codelineno-13-10"><span class="linenos" data-linenos="10 "></span></a>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11"></a><a href="#__codelineno-13-11"><span class="linenos" data-linenos="11 "></span></a>  <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">userNotExits</span><span class="p">(</span><span class="nx">Throwable</span> <span class="nv">$exception</span><span class="o">=</span><span class="k">null</span><span class="p">)</span><span class="o">:</span> <span class="nx">AppException</span> <span class="p">{</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12"></a><a href="#__codelineno-13-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">new</span><span class="p">(</span><span class="nx">ExceptionCode</span><span class="o">::</span><span class="na">USER_NOT_EXITS</span><span class="p">,</span> <span class="nx">internalError</span><span class="o">:</span> <span class="nv">$exception</span><span class="p">);</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13"></a><a href="#__codelineno-13-13"><span class="linenos" data-linenos="13 "></span></a>  <span class="p">}</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14"></a><a href="#__codelineno-13-14"><span class="linenos" data-linenos="14 "></span></a>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15"></a><a href="#__codelineno-13-15"><span class="linenos" data-linenos="15 "></span></a>  <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">invalidCredentials</span><span class="p">(</span><span class="nx">Throwable</span> <span class="nv">$exception</span><span class="o">=</span><span class="k">null</span><span class="p">)</span><span class="o">:</span> <span class="nx">AppException</span> <span class="p">{</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16"></a><a href="#__codelineno-13-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">new</span><span class="p">(</span><span class="nx">ExceptionCode</span><span class="o">::</span><span class="na">INVALID_CREDENTIALS</span><span class="p">,</span> <span class="nx">internalError</span><span class="o">:</span> <span class="nv">$exception</span><span class="p">);</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17"></a><a href="#__codelineno-13-17"><span class="linenos" data-linenos="17 "></span></a>  <span class="p">}</span>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18"></a><a href="#__codelineno-13-18"><span class="linenos" data-linenos="18 "></span></a>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19"></a><a href="#__codelineno-13-19"><span class="linenos" data-linenos="19 "></span></a><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>⚡ Observa como hemos agregado un parámetro opcional <code>$exception</code> a los métodos, para poder pasar la excepción que ha provocado esta excepción, y poder tener un contexto de porqué se ha lanzado esta excepción.</p>
</blockquote>
<p>Así por ejemplo para lanzar la excepción <code>UserNotFound</code>, simplemente tenemos que llamar al método <code>AuthException::userNotFound()</code>, y la excepción se lanzará con el código de error correspondiente, y el mensaje y descripción dentro del fichero de traducción.</p>
<h2 id="agregar-excepcion-para-el-modulo-de-notas">Agregar Excepción para el módulo de Notas<a class="headerlink" href="#agregar-excepcion-para-el-modulo-de-notas" title="Permanent link">&para;</a></h2>
<p>Vamos a crear una excepción para el módulo de notas, aunque podríamos incluir otros recursos dentro de este módulo, como por ejemplo, las categorías de las notas, las etiquetas, etc...</p>
<p>Para ello, vamos a crear una excepción <code>ResourceAppException</code> que extiende de <code>AppException</code>, y vamos a crear una serie de métodos estáticos que lanzan excepciones para los distintos códigos numéricos. También tendremos que crear los códigos numéricos para estas excepciones, en principio vamos a crear una excepción para agrear, actualizar, eliminar una nota.</p>
<p>Como esta clase, lanzará excepciones para cualquier recurso, hemos utilizado una aproximación para que todos los mensajes sobre un recurso tengan un token <code>:resource:</code> que será sustituido por el nombre del recurso. Esto se hará a través de los métodos <code>generateMesage()</code> y <code>generateDescription()</code>. </p>
<p>Se han creado 3 métodos específicos para crear excepciones, <code>errorCreateResource()</code>, <code>errorUpdateResource()</code>, <code>errorDeleteResource()</code>, para cada tipo de operación que se puede realizar sobre un recurso.</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1"></a><a href="#__codelineno-14-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">namespace</span> <span class="nx">App\Exceptions</span><span class="p">;</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2"></a><a href="#__codelineno-14-2"><span class="linenos" data-linenos=" 2 "></span></a>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3"></a><a href="#__codelineno-14-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="k">use</span> <span class="nx">App\ExceptionCode</span><span class="p">;</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4"></a><a href="#__codelineno-14-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">use</span> <span class="nx">Exception</span><span class="p">;</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5"></a><a href="#__codelineno-14-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">use</span> <span class="nx">Throwable</span><span class="p">;</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6"></a><a href="#__codelineno-14-6"><span class="linenos" data-linenos=" 6 "></span></a>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7"></a><a href="#__codelineno-14-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="k">class</span> <span class="nc">ResourceException</span> <span class="k">extends</span> <span class="nx">AppException</span> <span class="p">{</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8"></a><a href="#__codelineno-14-8"><span class="linenos" data-linenos=" 8 "></span></a>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9"></a><a href="#__codelineno-14-9"><span class="linenos" data-linenos=" 9 "></span></a>  <span class="k">private</span> <span class="k">CONST</span> <span class="no">RESOURCE_TOKEN</span> <span class="o">=</span> <span class="s2">&quot;:resource:&quot;</span><span class="p">;</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10"></a><a href="#__codelineno-14-10"><span class="linenos" data-linenos="10 "></span></a>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11"></a><a href="#__codelineno-14-11"><span class="linenos" data-linenos="11 "></span></a>  <span class="k">protected</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">generateMesage</span><span class="p">(</span><span class="nx">ExceptionCode</span> <span class="nv">$code</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$resourceName</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span> <span class="p">{</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12"></a><a href="#__codelineno-14-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="k">return</span> <span class="nb">str_replace</span><span class="p">(</span><span class="nx">ResourceException</span><span class="o">::</span><span class="na">RESOURCE_TOKEN</span><span class="p">,</span><span class="nv">$resourceName</span><span class="p">,</span> <span class="nv">$code</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">());</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13"></a><a href="#__codelineno-14-13"><span class="linenos" data-linenos="13 "></span></a>  <span class="p">}</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14"></a><a href="#__codelineno-14-14"><span class="linenos" data-linenos="14 "></span></a>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15"></a><a href="#__codelineno-14-15"><span class="linenos" data-linenos="15 "></span></a>  <span class="k">protected</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">generateDescription</span><span class="p">(</span><span class="nx">ExceptionCode</span> <span class="nv">$code</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$resourceName</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span> <span class="p">{</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16"></a><a href="#__codelineno-14-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="k">return</span> <span class="nb">str_replace</span><span class="p">(</span><span class="nx">ResourceException</span><span class="o">::</span><span class="na">RESOURCE_TOKEN</span><span class="p">,</span><span class="nv">$resourceName</span><span class="p">,</span> <span class="nv">$code</span><span class="o">-&gt;</span><span class="na">getDescription</span><span class="p">());</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17"></a><a href="#__codelineno-14-17"><span class="linenos" data-linenos="17 "></span></a>  <span class="p">}</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18"></a><a href="#__codelineno-14-18"><span class="linenos" data-linenos="18 "></span></a>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19"></a><a href="#__codelineno-14-19"><span class="linenos" data-linenos="19 "></span></a>  <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">errorCreateResource</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$resourceName</span><span class="p">,</span><span class="nx">Throwable</span> <span class="nv">$exception</span><span class="o">=</span><span class="k">null</span><span class="p">)</span><span class="o">:</span> <span class="nx">AppException</span>  <span class="p">{</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20"></a><a href="#__codelineno-14-20"><span class="linenos" data-linenos="20 "></span></a>    <span class="nv">$code</span> <span class="o">=</span> <span class="nx">ExceptionCode</span><span class="o">::</span><span class="na">RESOURCE_ERROR_CREATE</span><span class="p">;</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21"></a><a href="#__codelineno-14-21"><span class="linenos" data-linenos="21 "></span></a>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22"></a><a href="#__codelineno-14-22"><span class="linenos" data-linenos="22 "></span></a>     <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">new</span><span class="p">(</span><span class="nx">ExceptionCode</span><span class="o">::</span><span class="na">RESOURCE_ERROR_CREATE</span><span class="p">,</span> <span class="nx">self</span><span class="o">::</span><span class="na">generateMesage</span><span class="p">(</span><span class="nv">$code</span><span class="p">,</span> <span class="nv">$resourceName</span><span class="p">),</span> <span class="nx">self</span><span class="o">::</span><span class="na">generateDescription</span><span class="p">(</span><span class="nv">$code</span><span class="p">,</span> <span class="nv">$resourceName</span><span class="p">),</span> <span class="nx">internalError</span><span class="o">:</span> <span class="nv">$exception</span><span class="p">);</span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23"></a><a href="#__codelineno-14-23"><span class="linenos" data-linenos="23 "></span></a>  <span class="p">}</span>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24"></a><a href="#__codelineno-14-24"><span class="linenos" data-linenos="24 "></span></a>
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25"></a><a href="#__codelineno-14-25"><span class="linenos" data-linenos="25 "></span></a>  <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">errorUpdateResource</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$resourceName</span><span class="p">,</span><span class="nx">Throwable</span> <span class="nv">$exception</span><span class="o">=</span><span class="k">null</span><span class="p">)</span><span class="o">:</span> <span class="nx">AppException</span> <span class="p">{</span>
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26"></a><a href="#__codelineno-14-26"><span class="linenos" data-linenos="26 "></span></a>    <span class="nv">$code</span> <span class="o">=</span> <span class="nx">ExceptionCode</span><span class="o">::</span><span class="na">RESOURCE_ERROR_UPDATE</span><span class="p">;</span>
</span><span id="__span-14-27"><a id="__codelineno-14-27" name="__codelineno-14-27"></a><a href="#__codelineno-14-27"><span class="linenos" data-linenos="27 "></span></a>
</span><span id="__span-14-28"><a id="__codelineno-14-28" name="__codelineno-14-28"></a><a href="#__codelineno-14-28"><span class="linenos" data-linenos="28 "></span></a>    <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">new</span><span class="p">(</span><span class="nx">ExceptionCode</span><span class="o">::</span><span class="na">RESOURCE_ERROR_UPDATE</span><span class="p">,</span> <span class="nx">self</span><span class="o">::</span><span class="na">generateMesage</span><span class="p">(</span><span class="nv">$code</span><span class="p">,</span> <span class="nv">$resourceName</span><span class="p">),</span> <span class="nx">self</span><span class="o">::</span><span class="na">generateDescription</span><span class="p">(</span><span class="nv">$code</span><span class="p">,</span> <span class="nv">$resourceName</span><span class="p">),</span> <span class="nx">internalError</span><span class="o">:</span> <span class="nv">$exception</span><span class="p">);</span>
</span><span id="__span-14-29"><a id="__codelineno-14-29" name="__codelineno-14-29"></a><a href="#__codelineno-14-29"><span class="linenos" data-linenos="29 "></span></a>  <span class="p">}</span>
</span><span id="__span-14-30"><a id="__codelineno-14-30" name="__codelineno-14-30"></a><a href="#__codelineno-14-30"><span class="linenos" data-linenos="30 "></span></a>
</span><span id="__span-14-31"><a id="__codelineno-14-31" name="__codelineno-14-31"></a><a href="#__codelineno-14-31"><span class="linenos" data-linenos="31 "></span></a>  <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">errorDeleteResource</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$resourceName</span><span class="p">,</span><span class="nx">Throwable</span> <span class="nv">$exception</span><span class="o">=</span><span class="k">null</span><span class="p">)</span><span class="o">:</span> <span class="nx">AppException</span> <span class="p">{</span>
</span><span id="__span-14-32"><a id="__codelineno-14-32" name="__codelineno-14-32"></a><a href="#__codelineno-14-32"><span class="linenos" data-linenos="32 "></span></a>    <span class="nv">$code</span> <span class="o">=</span> <span class="nx">ExceptionCode</span><span class="o">::</span><span class="na">RESOURCE_ERROR_DELETE</span><span class="p">;</span>
</span><span id="__span-14-33"><a id="__codelineno-14-33" name="__codelineno-14-33"></a><a href="#__codelineno-14-33"><span class="linenos" data-linenos="33 "></span></a>
</span><span id="__span-14-34"><a id="__codelineno-14-34" name="__codelineno-14-34"></a><a href="#__codelineno-14-34"><span class="linenos" data-linenos="34 "></span></a>    <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">new</span><span class="p">(</span><span class="nx">ExceptionCode</span><span class="o">::</span><span class="na">RESOURCE_ERROR_DELETE</span><span class="p">,</span> <span class="nx">self</span><span class="o">::</span><span class="na">generateMesage</span><span class="p">(</span><span class="nv">$code</span><span class="p">,</span> <span class="nv">$resourceName</span><span class="p">),</span> <span class="nx">self</span><span class="o">::</span><span class="na">generateDescription</span><span class="p">(</span><span class="nv">$code</span><span class="p">,</span> <span class="nv">$resourceName</span><span class="p">),</span> <span class="nx">internalError</span><span class="o">:</span> <span class="nv">$exception</span><span class="p">);</span>
</span><span id="__span-14-35"><a id="__codelineno-14-35" name="__codelineno-14-35"></a><a href="#__codelineno-14-35"><span class="linenos" data-linenos="35 "></span></a>  <span class="p">}</span>
</span><span id="__span-14-36"><a id="__codelineno-14-36" name="__codelineno-14-36"></a><a href="#__codelineno-14-36"><span class="linenos" data-linenos="36 "></span></a>
</span><span id="__span-14-37"><a id="__codelineno-14-37" name="__codelineno-14-37"></a><a href="#__codelineno-14-37"><span class="linenos" data-linenos="37 "></span></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Uso en el controlador de Notas</strong></p>
<p>Ahora vamos a utilizar estas excepciones en el controlador de notas, y vamos a lanzar excepciones en función de si se produce un error al crear, actualizar o eliminar una nota.</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1"></a><a href="#__codelineno-15-1"><span class="linenos" data-linenos=" 1 "></span></a>  <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Note</span> <span class="nv">$note</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2"></a><a href="#__codelineno-15-2"><span class="linenos" data-linenos=" 2 "></span></a>    <span class="c1">//2. Validar los datos</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3"></a><a href="#__codelineno-15-3"><span class="linenos" data-linenos=" 3 "></span></a>    <span class="nx">request</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4"></a><a href="#__codelineno-15-4"><span class="linenos" data-linenos=" 4 "></span></a>      <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="s1">&#39;min:5&#39;</span><span class="p">],</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5"></a><a href="#__codelineno-15-5"><span class="linenos" data-linenos=" 5 "></span></a>      <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="s1">&#39;max:255&#39;</span><span class="p">]</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6"></a><a href="#__codelineno-15-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="p">]);</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7"></a><a href="#__codelineno-15-7"><span class="linenos" data-linenos=" 7 "></span></a>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8"></a><a href="#__codelineno-15-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="c1">//3. Autorizar (próximamente)</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9"></a><a href="#__codelineno-15-9"><span class="linenos" data-linenos=" 9 "></span></a>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10"></a><a href="#__codelineno-15-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="c1">//4. Obtener y actualizar la nota</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11"></a><a href="#__codelineno-15-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="k">try</span> <span class="p">{</span>  
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12"></a><a href="#__codelineno-15-12"><span class="linenos" data-linenos="12 "></span></a>      <span class="nv">$note</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">([</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13"></a><a href="#__codelineno-15-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="nx">request</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">),</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14"></a><a href="#__codelineno-15-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="nx">request</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">),</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15"></a><a href="#__codelineno-15-15"><span class="linenos" data-linenos="15 "></span></a>      <span class="p">]);</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16"></a><a href="#__codelineno-15-16"><span class="linenos" data-linenos="16 "></span></a>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17"></a><a href="#__codelineno-15-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\Throwable</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18"></a><a href="#__codelineno-15-18"><span class="linenos" data-linenos="18 "></span></a>      <span class="nv">$ex</span> <span class="o">=</span> <span class="nx">ResourceException</span><span class="o">::</span><span class="na">errorDeleteResource</span><span class="p">(</span><span class="s2">&quot;Note&quot;</span><span class="p">,</span><span class="nx">exception</span><span class="o">:</span> <span class="nv">$e</span><span class="p">);</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19"></a><a href="#__codelineno-15-19"><span class="linenos" data-linenos="19 "></span></a>      <span class="c1">//Guardar la excepción en el log</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20"></a><a href="#__codelineno-15-20"><span class="linenos" data-linenos="20 "></span></a>      <span class="nv">$ex</span><span class="o">-&gt;</span><span class="na">report</span><span class="p">();</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21"></a><a href="#__codelineno-15-21"><span class="linenos" data-linenos="21 "></span></a>      <span class="c1">//Devolver un mensaje de error</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22"></a><a href="#__codelineno-15-22"><span class="linenos" data-linenos="22 "></span></a>      <span class="k">return</span> <span class="nx">back</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nv">$ex</span><span class="o">-&gt;</span><span class="na">getDescription</span><span class="p">());</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23"></a><a href="#__codelineno-15-23"><span class="linenos" data-linenos="23 "></span></a>    <span class="p">}</span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24"></a><a href="#__codelineno-15-24"><span class="linenos" data-linenos="24 "></span></a>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25"></a><a href="#__codelineno-15-25"><span class="linenos" data-linenos="25 "></span></a>    <span class="c1">//5. Retornar la vista de la lista de notas</span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26"></a><a href="#__codelineno-15-26"><span class="linenos" data-linenos="26 "></span></a>    <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/notes&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;Nota actualizada con éxito&#39;</span><span class="p">);</span>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27"></a><a href="#__codelineno-15-27"><span class="linenos" data-linenos="27 "></span></a>  <span class="p">}</span>
</span></code></pre></div>
<p>Explicación del proceso:</p>
<ul>
<li>Hemos envuelto el proceso de actualización de la nota en un bloque <code>try-catch</code>, y si se produce una excepción o un error, lanzamos una excepción de tipo <code>ResourceException</code> con el código de error correspondiente, y el mensaje y descripción correspondiente al código de error, y la excepción que ha provocado esta excepción</li>
<li>Despúes guardamos la excepción en el log.</li>
<li>y finalmente devolvemos un mensaje de error al usuario.</li>
</ul>
<p><strong>De esta forma por una parte avisamos al usuario del error, sin informar de datos que el usuario no debería conocer, y por otra parte, guardamos la excepción en el log, para poder analizarla más adelante.</strong></p>
<h2 id="manejador-de-excepciones-global">Manejador de excepciones global<a class="headerlink" href="#manejador-de-excepciones-global" title="Permanent link">&para;</a></h2>
<p>Como vimos en uno de los primeros puntos de esta lección, es muy recomendable definir un manejador de excepciones global, que se encargue de capturar todas las excepciones que no se han capturado en ningún punto de la aplicación, y que se encargue de renderizar una página de error adecuada, y de guardar la excepción en un log.</p>
<p>Pero ahora, además, vamos a utilizar nuestra excepción personalizada <code>AppException</code> y vamos a aplicar la lógica de renderizado de la lógica de negocio de nuestra aplicación, es decir, que si para nuestra aplicación un código-error-http se tiene que mostrar como página lo hará y si no, simplemente mostrará un mensaje de error.</p>
<p>Vamos a aplicarlo. En el fichero <code>bootstrap/app.php</code>, actulizamos el controlador global de esta forma:</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1"></a><a href="#__codelineno-16-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">return</span> <span class="nx">Application</span><span class="o">::</span><span class="na">configure</span><span class="p">(</span><span class="nx">basePath</span><span class="o">:</span> <span class="nb">dirname</span><span class="p">(</span><span class="no">__DIR__</span><span class="p">))</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2"></a><a href="#__codelineno-16-2"><span class="linenos" data-linenos=" 2 "></span></a>    <span class="o">-&gt;</span><span class="na">withRouting</span><span class="p">(</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3"></a><a href="#__codelineno-16-3"><span class="linenos" data-linenos=" 3 "></span></a>        <span class="nx">web</span><span class="o">:</span> <span class="no">__DIR__</span><span class="o">.</span><span class="s1">&#39;/../routes/web.php&#39;</span><span class="p">,</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4"></a><a href="#__codelineno-16-4"><span class="linenos" data-linenos=" 4 "></span></a>        <span class="nx">commands</span><span class="o">:</span> <span class="no">__DIR__</span><span class="o">.</span><span class="s1">&#39;/../routes/console.php&#39;</span><span class="p">,</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5"></a><a href="#__codelineno-16-5"><span class="linenos" data-linenos=" 5 "></span></a>        <span class="nx">health</span><span class="o">:</span> <span class="s1">&#39;/up&#39;</span><span class="p">,</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6"></a><a href="#__codelineno-16-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="p">)</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7"></a><a href="#__codelineno-16-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="o">-&gt;</span><span class="na">withMiddleware</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Middleware</span> <span class="nv">$middleware</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8"></a><a href="#__codelineno-16-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="c1">//</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9"></a><a href="#__codelineno-16-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="p">})</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10"></a><a href="#__codelineno-16-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="o">-&gt;</span><span class="na">withExceptions</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Exceptions</span> <span class="nv">$exceptions</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11"></a><a href="#__codelineno-16-11"><span class="linenos" data-linenos="11 "></span></a>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12"></a><a href="#__codelineno-16-12"><span class="linenos" data-linenos="12 "></span></a>      <span class="c1">//**Controlar excepciones tipo AppException**</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13"></a><a href="#__codelineno-16-13"><span class="linenos" data-linenos="13 "></span></a>      <span class="nv">$exceptions</span><span class="o">-&gt;</span><span class="na">report</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">AppException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14"></a><a href="#__codelineno-16-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="c1">// ...</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15"></a><a href="#__codelineno-16-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">report</span><span class="p">();</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16"></a><a href="#__codelineno-16-16"><span class="linenos" data-linenos="16 "></span></a>      <span class="p">});</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17"></a><a href="#__codelineno-16-17"><span class="linenos" data-linenos="17 "></span></a>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18"></a><a href="#__codelineno-16-18"><span class="linenos" data-linenos="18 "></span></a>      <span class="nv">$exceptions</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">AppException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19"></a><a href="#__codelineno-16-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="c1">// ...</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20"></a><a href="#__codelineno-16-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21"></a><a href="#__codelineno-16-21"><span class="linenos" data-linenos="21 "></span></a>      <span class="p">});</span>
</span><span id="__span-16-22"><a id="__codelineno-16-22" name="__codelineno-16-22"></a><a href="#__codelineno-16-22"><span class="linenos" data-linenos="22 "></span></a>
</span><span id="__span-16-23"><a id="__codelineno-16-23" name="__codelineno-16-23"></a><a href="#__codelineno-16-23"><span class="linenos" data-linenos="23 "></span></a>      <span class="c1">// **Controlar excepciones genéricas***</span>
</span><span id="__span-16-24"><a id="__codelineno-16-24" name="__codelineno-16-24"></a><a href="#__codelineno-16-24"><span class="linenos" data-linenos="24 "></span></a>      <span class="nv">$exceptions</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-16-25"><a id="__codelineno-16-25" name="__codelineno-16-25"></a><a href="#__codelineno-16-25"><span class="linenos" data-linenos="25 "></span></a>        <span class="c1">// ...</span>
</span><span id="__span-16-26"><a id="__codelineno-16-26" name="__codelineno-16-26"></a><a href="#__codelineno-16-26"><span class="linenos" data-linenos="26 "></span></a>      <span class="p">});</span>
</span><span id="__span-16-27"><a id="__codelineno-16-27" name="__codelineno-16-27"></a><a href="#__codelineno-16-27"><span class="linenos" data-linenos="27 "></span></a>    <span class="p">})</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>
</span></code></pre></div>
<p>Y dentro de la clase <code>AppException</code> como hemos visto anteriormente, decidimos si hay que renderizar la página en base al <code>http-status-code</code>.</p>
<p><div class="language-php highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1"></a><a href="#__codelineno-17-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1">//app/Exceptions/AppException.php</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2"></a><a href="#__codelineno-17-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="k">class</span> <span class="nc">AppException</span> <span class="k">extends</span> <span class="nx">Exception</span> <span class="p">{</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3"></a><a href="#__codelineno-17-3"><span class="linenos" data-linenos=" 3 "></span></a>  <span class="c1">//...</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4"></a><a href="#__codelineno-17-4"><span class="linenos" data-linenos=" 4 "></span></a>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5"></a><a href="#__codelineno-17-5"><span class="linenos" data-linenos=" 5 "></span></a> <span class="sd">/**</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6"></a><a href="#__codelineno-17-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="sd">   * Render the exception as an HTTP response.</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7"></a><a href="#__codelineno-17-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="sd">   */</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8"></a><a href="#__codelineno-17-8"><span class="linenos" data-linenos=" 8 "></span></a>  <span class="k">public</span> <span class="k">function</span> <span class="nf">render</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span><span class="o">|</span><span class="nx">bool</span> <span class="p">{</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9"></a><a href="#__codelineno-17-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="c1">//</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10"></a><a href="#__codelineno-17-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isNeedRenderToPage</span><span class="p">(</span><span class="nv">$request</span><span class="p">))</span> <span class="p">{</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11"></a><a href="#__codelineno-17-11"><span class="linenos" data-linenos="11 "></span></a>      <span class="c1">// Renderiza la vista de error, debe haber una vista con el nombre del código de estadso</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12"></a><a href="#__codelineno-17-12"><span class="linenos" data-linenos="12 "></span></a>      <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">view</span><span class="p">(</span><span class="s2">&quot;errors.</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">internalCode</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;exception&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="p">],</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">internalCode</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">());</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13"></a><a href="#__codelineno-17-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="p">}</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14"></a><a href="#__codelineno-17-14"><span class="linenos" data-linenos="14 "></span></a>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15"></a><a href="#__codelineno-17-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16"></a><a href="#__codelineno-17-16"><span class="linenos" data-linenos="16 "></span></a>  <span class="p">}</span>
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17"></a><a href="#__codelineno-17-17"><span class="linenos" data-linenos="17 "></span></a>
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18"></a><a href="#__codelineno-17-18"><span class="linenos" data-linenos="18 "></span></a>
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19"></a><a href="#__codelineno-17-19"><span class="linenos" data-linenos="19 "></span></a>  <span class="c1">//...</span>
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20"></a><a href="#__codelineno-17-20"><span class="linenos" data-linenos="20 "></span></a><span class="p">}</span>
</span></code></pre></div>
También vamos a crear un nuevo método dentro de la excepción <code>AuthException</code> para lanzar excepciones de tipo <code>Unauthorized</code>.</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1"></a><a href="#__codelineno-18-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1">//app/Exceptions/AuthException.php</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2"></a><a href="#__codelineno-18-2"><span class="linenos" data-linenos="2 "></span></a>  <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">userNotAuthorized</span><span class="p">(</span><span class="nx">Throwable</span> <span class="nv">$exception</span><span class="o">=</span><span class="k">null</span><span class="p">)</span><span class="o">:</span> <span class="nx">AppException</span> <span class="p">{</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3"></a><a href="#__codelineno-18-3"><span class="linenos" data-linenos="3 "></span></a>    <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">new</span><span class="p">(</span><span class="nx">ExceptionCode</span><span class="o">::</span><span class="na">UNAUTHORIZED</span><span class="p">,</span> <span class="nx">internalError</span><span class="o">:</span> <span class="nv">$exception</span><span class="p">);</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4"></a><a href="#__codelineno-18-4"><span class="linenos" data-linenos="4 "></span></a>  <span class="p">}</span>
</span></code></pre></div>
<p>Ahora vamos a aplicarlo a un ejemplo real. Supongamos que al actualizar una nota, comprobamos si el usuario tiene permiso sobre esa nota, y si no, lanzamos una excepción del tipo <code>Unathorized</code>.</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1"></a><a href="#__codelineno-19-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1">//app/http/controllers/NoteController</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2"></a><a href="#__codelineno-19-2"><span class="linenos" data-linenos=" 2 "></span></a> <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Note</span> <span class="nv">$note</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3"></a><a href="#__codelineno-19-3"><span class="linenos" data-linenos=" 3 "></span></a>    <span class="c1">//2. Validar los datos</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4"></a><a href="#__codelineno-19-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="nx">request</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5"></a><a href="#__codelineno-19-5"><span class="linenos" data-linenos=" 5 "></span></a>      <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="s1">&#39;min:5&#39;</span><span class="p">],</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6"></a><a href="#__codelineno-19-6"><span class="linenos" data-linenos=" 6 "></span></a>      <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="s1">&#39;max:255&#39;</span><span class="p">]</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7"></a><a href="#__codelineno-19-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="p">]);</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8"></a><a href="#__codelineno-19-8"><span class="linenos" data-linenos=" 8 "></span></a>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9"></a><a href="#__codelineno-19-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="c1">//3. Autorizar (próximamente)</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10"></a><a href="#__codelineno-19-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="c1">//**SIMULAMOS QUE EL USUARIO DE LA NOTA ES DISTINTO AL USUARIO LOGADO**</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11"></a><a href="#__codelineno-19-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$note</span><span class="o">-&gt;</span><span class="na">user_id</span> <span class="o">!==</span> <span class="mi">20</span><span class="p">)</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12"></a><a href="#__codelineno-19-12"><span class="linenos" data-linenos="12 "></span></a>      <span class="k">throw</span> <span class="nx">AuthException</span><span class="o">::</span><span class="na">userNotAuthorized</span><span class="p">();</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13"></a><a href="#__codelineno-19-13"><span class="linenos" data-linenos="13 "></span></a>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14"></a><a href="#__codelineno-19-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="c1">//4. Obtener y actualizar la nota</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15"></a><a href="#__codelineno-19-15"><span class="linenos" data-linenos="15 "></span></a>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16"></a><a href="#__codelineno-19-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="k">try</span> <span class="p">{</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17"></a><a href="#__codelineno-19-17"><span class="linenos" data-linenos="17 "></span></a>      <span class="nv">$note</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">([</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18"></a><a href="#__codelineno-19-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="nx">request</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">),</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19"></a><a href="#__codelineno-19-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="nx">request</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">),</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20"></a><a href="#__codelineno-19-20"><span class="linenos" data-linenos="20 "></span></a>      <span class="p">]);</span>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21"></a><a href="#__codelineno-19-21"><span class="linenos" data-linenos="21 "></span></a>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22"></a><a href="#__codelineno-19-22"><span class="linenos" data-linenos="22 "></span></a>    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\Throwable</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23"></a><a href="#__codelineno-19-23"><span class="linenos" data-linenos="23 "></span></a>      <span class="nv">$ex</span> <span class="o">=</span> <span class="nx">ResourceException</span><span class="o">::</span><span class="na">errorDeleteResource</span><span class="p">(</span><span class="s2">&quot;Note&quot;</span><span class="p">,</span><span class="nx">exception</span><span class="o">:</span> <span class="nv">$e</span><span class="p">);</span>
</span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24"></a><a href="#__codelineno-19-24"><span class="linenos" data-linenos="24 "></span></a>      <span class="nv">$ex</span><span class="o">-&gt;</span><span class="na">report</span><span class="p">();</span>
</span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25"></a><a href="#__codelineno-19-25"><span class="linenos" data-linenos="25 "></span></a>
</span><span id="__span-19-26"><a id="__codelineno-19-26" name="__codelineno-19-26"></a><a href="#__codelineno-19-26"><span class="linenos" data-linenos="26 "></span></a>      <span class="k">return</span> <span class="nx">back</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nv">$ex</span><span class="o">-&gt;</span><span class="na">getDescription</span><span class="p">());</span>
</span><span id="__span-19-27"><a id="__codelineno-19-27" name="__codelineno-19-27"></a><a href="#__codelineno-19-27"><span class="linenos" data-linenos="27 "></span></a>    <span class="p">}</span>
</span><span id="__span-19-28"><a id="__codelineno-19-28" name="__codelineno-19-28"></a><a href="#__codelineno-19-28"><span class="linenos" data-linenos="28 "></span></a>
</span><span id="__span-19-29"><a id="__codelineno-19-29" name="__codelineno-19-29"></a><a href="#__codelineno-19-29"><span class="linenos" data-linenos="29 "></span></a>    <span class="c1">//5. Retornar la vista de la lista de notas</span>
</span><span id="__span-19-30"><a id="__codelineno-19-30" name="__codelineno-19-30"></a><a href="#__codelineno-19-30"><span class="linenos" data-linenos="30 "></span></a>    <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/notes&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;Nota actualizada con éxito&#39;</span><span class="p">);</span>
</span><span id="__span-19-31"><a id="__codelineno-19-31" name="__codelineno-19-31"></a><a href="#__codelineno-19-31"><span class="linenos" data-linenos="31 "></span></a>  <span class="p">}</span>
</span></code></pre></div>
<p>Ahora si ejecutamos el código, la excepcion <code>Unauthorized</code> será capturada por el manejador de excepciones global, y se renderizará la página de error 403 y el mensaje de error se guardará en el log.</p>
<h3 id="personalizar-paginas-de-error">Personalizar páginas de error.<a class="headerlink" href="#personalizar-paginas-de-error" title="Permanent link">&para;</a></h3>
<p>Laravel nos ha dado un error, al intentar mostrar la página de error 403, ya que no encuentra la ruta <code>errors.403.blade.php</code>. Y esto es totalmente lógico, ya que no tenemos ninguna carpeta <code>errors</code> en la carpeta <code>resources/views</code>. ¿Cómo podemos solucionar esto? Creando una serie de vistas para los distintos códigos de error.</p>
<ol>
<li>Crear la carpeta <code>errors</code> en la carpeta <code>resources/views</code>.</li>
<li>Crear una vista para cada código de error, por ejemplo, <code>403.blade.php</code>, <code>404.blade.php</code>, <code>500.blade.php</code>, etc...</li>
</ol>
<p><strong>Crear páginas de errores</strong></p>
<p>Para ello vamos a seguir la misma aproximación que seguimos para el resto de páginas, y vamos a utilizar la plantilla que tenemos <code>layout.blade.php</code> y vamos a crear una vista para cada código de error dentro de la carpeta, <code>errors</code>.</p>
<p>Vamos a utilizar para ello, las páginas que utilizamos en la aplicación WebApp anterior. De esta forma, la página 403 quedaría así:</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1"></a><a href="#__codelineno-20-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">layout</span> <span class="nx">heading</span><span class="o">=</span><span class="s2">&quot;{{ </span><span class="si">$title</span><span class="s2"> ?? __(&#39;Forbidden&#39;) }}&quot;</span><span class="o">&gt;</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2"></a><a href="#__codelineno-20-2"><span class="linenos" data-linenos=" 2 "></span></a>  <span class="o">&lt;</span><span class="nx">main</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;grid min-h-full place-items-center bg-white px-6 py-24 sm:py-32 lg:px-8&quot;</span><span class="o">&gt;</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3"></a><a href="#__codelineno-20-3"><span class="linenos" data-linenos=" 3 "></span></a>    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;text-center&quot;</span><span class="o">&gt;</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4"></a><a href="#__codelineno-20-4"><span class="linenos" data-linenos=" 4 "></span></a>      <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;text-base font-semibold text-indigo-600&quot;</span><span class="o">&gt;</span><span class="mi">403</span><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5"></a><a href="#__codelineno-20-5"><span class="linenos" data-linenos=" 5 "></span></a>      <span class="o">&lt;</span><span class="nx">h1</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;mt-4 text-balance text-5xl font-semibold tracking-tight text-gray-900 sm:text-7xl&quot;</span><span class="o">&gt;</span><span class="p">{{</span><span class="nv">$title</span> <span class="o">??</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;Forbidden&#39;</span><span class="p">)}}</span><span class="o">&lt;/</span><span class="nx">h1</span><span class="o">&gt;</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6"></a><a href="#__codelineno-20-6"><span class="linenos" data-linenos=" 6 "></span></a>      <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;mt-6 text-pretty text-lg font-medium text-gray-500 sm:text-xl/8&quot;</span><span class="o">&gt;</span><span class="p">{{</span><span class="nv">$message</span> <span class="o">??</span> <span class="s1">&#39;Access not authorized&#39;</span><span class="p">}}</span><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7"></a><a href="#__codelineno-20-7"><span class="linenos" data-linenos=" 7 "></span></a>      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;mt-10 flex items-center justify-center gap-x-6&quot;</span><span class="o">&gt;</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8"></a><a href="#__codelineno-20-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;{{ </span><span class="si">$redirect</span><span class="s2"> ?? &#39;/&#39; }}&quot;</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9"></a><a href="#__codelineno-20-9"><span class="linenos" data-linenos=" 9 "></span></a>           <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;rounded-md bg-indigo-600 px-3.5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600&quot;</span><span class="o">&gt;</span><span class="nx">Go</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10"></a><a href="#__codelineno-20-10"><span class="linenos" data-linenos="10 "></span></a>          <span class="nx">back</span> <span class="nx">home</span><span class="o">&lt;/</span><span class="nx">a</span><span class="o">&gt;</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11"></a><a href="#__codelineno-20-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;#&quot;</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;text-sm font-semibold text-gray-900&quot;</span><span class="o">&gt;</span><span class="nx">Contact</span> <span class="nx">support</span> <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">aria</span><span class="o">-</span><span class="nx">hidden</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="o">&gt;&amp;</span><span class="nx">rarr</span><span class="p">;</span><span class="o">&lt;/</span><span class="nx">span</span><span class="o">&gt;&lt;/</span><span class="nx">a</span><span class="o">&gt;</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12"></a><a href="#__codelineno-20-12"><span class="linenos" data-linenos="12 "></span></a>      <span class="o">&lt;/</span><span class="nx">div</span><span class="o">&gt;</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13"></a><a href="#__codelineno-20-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="o">&lt;/</span><span class="nx">div</span><span class="o">&gt;</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14"></a><a href="#__codelineno-20-14"><span class="linenos" data-linenos="14 "></span></a>  <span class="o">&lt;/</span><span class="nx">main</span><span class="o">&gt;</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15"></a><a href="#__codelineno-20-15"><span class="linenos" data-linenos="15 "></span></a><span class="o">&lt;/</span><span class="nx">x</span><span class="o">-</span><span class="nx">layout</span><span class="o">&gt;</span>
</span></code></pre></div>
<p>Para esta página se requieren de una serie de variables, como el título de la página, el mensaje de error, y la ruta a la que se debe redirigir el usuario. Por defecto, el título de la página tendrá un valor por defecto para cada página, y la redirección será por defecto la página de inicio.</p>
<p>El resto de páginas serán igual, pero con el código de error correspondiente, y el mensaje de error correspondiente. Es conveniente poner un valor por defecto para todas las variables utilizadas en las diferentes vistas.</p>
<p>Página error 500:</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1"></a><a href="#__codelineno-21-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">layout</span> <span class="nx">heading</span><span class="o">=</span><span class="s2">&quot;{{ </span><span class="si">$title</span><span class="s2"> ?? __(&#39;Server Error&#39;) }}&quot;</span><span class="o">&gt;</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2"></a><a href="#__codelineno-21-2"><span class="linenos" data-linenos=" 2 "></span></a>  <span class="o">&lt;</span><span class="nx">main</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;grid min-h-full place-items-center bg-white px-6 py-24 sm:py-32 lg:px-8&quot;</span><span class="o">&gt;</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3"></a><a href="#__codelineno-21-3"><span class="linenos" data-linenos=" 3 "></span></a>    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;text-center&quot;</span><span class="o">&gt;</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4"></a><a href="#__codelineno-21-4"><span class="linenos" data-linenos=" 4 "></span></a>      <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;text-base font-semibold text-indigo-600&quot;</span><span class="o">&gt;</span><span class="mi">500</span><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5"></a><a href="#__codelineno-21-5"><span class="linenos" data-linenos=" 5 "></span></a>      <span class="o">&lt;</span><span class="nx">h1</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;mt-4 text-balance text-5xl font-semibold tracking-tight text-gray-900 sm:text-7xl&quot;</span><span class="o">&gt;</span><span class="p">{{</span><span class="nv">$title</span> <span class="o">??</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;Server Error&#39;</span><span class="p">)}}</span><span class="o">&lt;/</span><span class="nx">h1</span><span class="o">&gt;</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6"></a><a href="#__codelineno-21-6"><span class="linenos" data-linenos=" 6 "></span></a>      <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;mt-6 text-pretty text-lg font-medium text-gray-500 sm:text-xl/8&quot;</span><span class="o">&gt;</span><span class="p">{{</span><span class="nv">$message</span> <span class="o">??</span> <span class="s1">&#39;error occurred on the server&#39;</span><span class="p">}}</span><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7"></a><a href="#__codelineno-21-7"><span class="linenos" data-linenos=" 7 "></span></a>      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;mt-10 flex items-center justify-center gap-x-6&quot;</span><span class="o">&gt;</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8"></a><a href="#__codelineno-21-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;{{ </span><span class="si">$redirect</span><span class="s2"> ?? &#39;/&#39; }}&quot;</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9"></a><a href="#__codelineno-21-9"><span class="linenos" data-linenos=" 9 "></span></a>           <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;rounded-md bg-indigo-600 px-3.5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600&quot;</span><span class="o">&gt;</span><span class="nx">Go</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10"></a><a href="#__codelineno-21-10"><span class="linenos" data-linenos="10 "></span></a>          <span class="nx">back</span> <span class="nx">home</span><span class="o">&lt;/</span><span class="nx">a</span><span class="o">&gt;</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11"></a><a href="#__codelineno-21-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;#&quot;</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;text-sm font-semibold text-gray-900&quot;</span><span class="o">&gt;</span><span class="nx">Contact</span> <span class="nx">support</span> <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">aria</span><span class="o">-</span><span class="nx">hidden</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="o">&gt;&amp;</span><span class="nx">rarr</span><span class="p">;</span><span class="o">&lt;/</span><span class="nx">span</span><span class="o">&gt;&lt;/</span><span class="nx">a</span><span class="o">&gt;</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12"></a><a href="#__codelineno-21-12"><span class="linenos" data-linenos="12 "></span></a>      <span class="o">&lt;/</span><span class="nx">div</span><span class="o">&gt;</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13"></a><a href="#__codelineno-21-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="o">&lt;/</span><span class="nx">div</span><span class="o">&gt;</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14"></a><a href="#__codelineno-21-14"><span class="linenos" data-linenos="14 "></span></a>  <span class="o">&lt;/</span><span class="nx">main</span><span class="o">&gt;</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15"></a><a href="#__codelineno-21-15"><span class="linenos" data-linenos="15 "></span></a><span class="o">&lt;/</span><span class="nx">x</span><span class="o">-</span><span class="nx">layout</span><span class="o">&gt;</span>
</span></code></pre></div>
<h2 id="conclusion">Conclusión<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h2>
<p>Este ha sido realmente una lección muy densa donde tratamos un tema complejo pero realmente fundamental en cualquier aplicación web, como son las excepciones y su manejo. Hemos visto cómo crear excepciones personalizadas, cómo lanzar excepciones, cómo capturar excepciones, cómo guardar excepciones en un log, cómo renderizar excepciones, cómo personalizar páginas de error, etc...</p>
<p>Y lo más importante, hemos sentado las bases de una implementación utilizando buenas prácticas, a través de excepciones personalizadas y todo el código encapsulado dentro de una jerarquía de clases.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2024-2025 Jesús García - Licencia CC BY-NC-SA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/aitormedrano" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.2 4.2 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.52 8.52 0 0 1-5.33 1.84q-.51 0-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<a.medrano@edu.gva.es>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 12.13c-.15.01-.29.06-.39.17l-1 1 2.05 2 1-1c.22-.21.22-.56 0-.77l-1.24-1.23a.56.56 0 0 0-.38-.17m-2 1.75L13 19.94V22h2.06l6.06-6.07M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h7v-.89l8.24-8.22c.47-.49 1.12-.76 1.8-.76.34 0 .68.06 1 .19V6c0-1.12-.92-2-2.04-2m0 4-8 5-8-5V6l8 5 8-5"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["header.autohide", "toc.integrate", "content.tabs.link", "content.code.copy", "content.code.select", "navigation.top", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.60a45f97.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>